import{Q as jl,T as Gl,W as je,Y as $l,_ as ye,bb as Kl,c as Do,cb as Oo,da as ki,h as Bl,i as zl,jb as Mo,k as ko,l as No,na as Ni,qa as Ge,wa as Fo}from"./chunk-V3WOVX3B.js";import{Wa as jo,Xa as vn,b as Ql,d as Wl,e as Rr,ia as qo,j as Lo,ja as Bo,k as Hl,l as Jl,n as Uo,p as _t,q as Yl,r as $t,s as Xl,t as Zl,u as th,ua as zo,v as eh,w as nh,x as Fi,y as Oi,z as zt}from"./chunk-4Z4LLCYD.js";import{f as xo,g as V}from"./chunk-BBVEFKYK.js";var Cm="firebase",xm="10.14.0";zt(Cm,xm,"app");var Pr=new Kl("ANGULARFIRE2_VERSION");function rh(r,t,e){if(t){if(t.length===1)return t[0];let s=t.filter(a=>a.app===e);if(s.length===1)return s[0]}return e.container.getProvider(r).getImmediate({optional:!0})}var $o=(r,t)=>{let e=t?[t]:Oi(),n=[];return e.forEach(i=>{i.container.getProvider(r).instances.forEach(a=>{n.includes(a)||n.push(a)})}),n},Mi=class{constructor(){return $o(Dm)}},Dm="app-check";function In(){}var Li=class{zone;delegate;constructor(t,e=zl){this.zone=t,this.delegate=e}now(){return this.delegate.now()}schedule(t,e,n){let i=this.zone,s=function(a){i.runGuarded(()=>{t.apply(this,[a])})};return this.delegate.schedule(s,e,n)}},Go=class{zone;task=null;constructor(t){this.zone=t}call(t,e){let n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",In,{},In,In)),e.pipe(jl({next:n,complete:n,error:n})).subscribe(t).add(n)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Ui=(()=>{class r{ngZone;outsideAngular;insideAngular;constructor(e){this.ngZone=e,this.outsideAngular=e.runOutsideAngular(()=>new Li(Zone.current)),this.insideAngular=e.run(()=>new Li(Zone.current,Bl)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(n){return new(n||r)($l(Ge))};static \u0275prov=Gl({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function qi(){let r=globalThis.\u0275AngularFireScheduler;if(!r)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return r}function km(r){return qi().ngZone.runOutsideAngular(()=>r())}function $e(r){return qi().ngZone.run(()=>r())}function Nm(r){return Fm(qi())(r)}function Fm(r){return function(e){return e=e.lift(new Go(r.ngZone)),e.pipe(No(r.outsideAngular),ko(r.insideAngular))}}var Om=(r,t)=>function(){let n=arguments;return t&&setTimeout(()=>{t.state==="scheduled"&&t.invoke()},10),$e(()=>r.apply(void 0,n))},Ke=(r,t)=>function(){let e,n=arguments;for(let s=0;s<arguments.length;s++)typeof n[s]=="function"&&(t&&(e||=$e(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",In,{},In,In))),n[s]=Om(n[s],e));let i=km(()=>r.apply(this,n));if(!t)if(i instanceof Do){let s=qi();return i.pipe(No(s.outsideAngular),ko(s.insideAngular))}else return $e(()=>i);return i instanceof Do?i.pipe(Nm):i instanceof Promise?$e(()=>new Promise((s,a)=>i.then(u=>$e(()=>s(u)),u=>$e(()=>a(u))))):typeof i=="function"&&e?function(){return setTimeout(()=>{e&&e.state==="scheduled"&&e.invoke()},10),i.apply(this,arguments)}:$e(()=>i)};var Qe=class{constructor(t){return t}},br=class{constructor(){return Oi()}};function Mm(r){return r&&r.length===1?r[0]:new Qe(Fi())}var Ko=new je("angularfire2._apps"),Lm={provide:Qe,useFactory:Mm,deps:[[new ye,Ko]]},Um={provide:br,deps:[[new ye,Ko]]};function qm(r){return(t,e)=>{let n=e.get(Fo);zt("angularfire",Pr.full,"core"),zt("angularfire",Pr.full,"app"),zt("angular",Oo.full,n.toString());let i=t.runOutsideAngular(()=>r(e));return new Qe(i)}}function d_(r,...t){return ki([Lm,Um,{provide:Ko,useFactory:qm(r),multi:!0,deps:[Ge,Ni,Ui,...t]}])}var f_=Ke(nh,!0);var ih="auth",Vr=class{constructor(t){return t}},Qo=class{constructor(){return $o(ih)}};var Wo=new je("angularfire2.auth-instances");function Mg(r,t){let e=rh(ih,r,t);return e&&new Vr(e)}function Lg(r){return(t,e)=>{let n=t.runOutsideAngular(()=>r(e));return new Vr(n)}}var Ug={provide:Qo,deps:[[new ye,Wo]]},qg={provide:Vr,useFactory:Mg,deps:[[new ye,Wo],Qe]};function ow(r,...t){return zt("angularfire",Pr.full,"auth"),ki([qg,Ug,{provide:Wo,useFactory:Lg(r),multi:!0,deps:[Ge,Ni,Ui,br,[new ye,Mi],...t]}])}var aw=Ke(qo,!0);var uw=Ke(jo,!0);var cw=Ke(Bo,!0);var lw=Ke(zo,!0);var Bg="firebase",zg="10.14.0";vn.registerVersion(Bg,zg,"app-compat");var jg=["ngOnDestroy"],vw=(r,t,e,n={})=>new Proxy(r,{get:(i,s)=>e.runOutsideAngular(()=>{if(r[s])return n?.spy?.get&&n.spy.get(s,r[s]),r[s];if(jg.indexOf(s)>-1)return()=>{};let a=t.toPromise().then(u=>{let c=u?.[s];return typeof c=="function"?c.bind(u):c?.then?c.then(d=>e.run(()=>d)):e.run(()=>c)});return new Proxy(()=>{},{get:(u,c)=>a[c],apply:(u,c,d)=>a.then(f=>{let g=f?.(...d);return n?.spy?.apply&&n.spy.apply(s,d,g),g})})})});var Ho=class{constructor(t){return t}},Iw=new je("angularfire2.app.options"),Tw=new je("angularfire2.app.name");function Ew(r,t,e){let n=typeof e=="string"&&e||"[DEFAULT]",i=typeof e=="object"&&e||{};i.name=i.name||n;let a=vn.apps.filter(u=>u&&u.name===i.name)[0]||t.runOutsideAngular(()=>vn.initializeApp(r,i));try{if(JSON.stringify(r)!==JSON.stringify(a.options)){let u=!!module.hot;Gg("error",`${a.name} Firebase App already initialized with different options${u?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Ho(a)}var Gg=(r,...t)=>{Mo()&&typeof console<"u"&&console[r](...t)};function Aw(r,t,e,n,i){let[,s,a]=globalThis.\u0275AngularfireInstanceCache.find(u=>u[0]===r)||[];if(s)return $g(i,a)||(sh("error",`${t} was already initialized on the ${e} Firebase App with different settings.${Kg?" You may need to reload as Firebase is not HMR aware.":""}`),sh("warn",{is:i,was:a})),s;{let u=n();return globalThis.\u0275AngularfireInstanceCache.push([r,u,i]),u}}function $g(r,t){try{return r.toString()===t.toString()}catch{return r===t}}var Kg=typeof module<"u"&&!!module.hot,sh=(r,...t)=>{Mo()&&typeof console<"u"&&console[r](...t)};globalThis.\u0275AngularfireInstanceCache||=[];var oh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ah={};var _e,Jo;(function(){var r;function t(v,p){function w(){}w.prototype=p.prototype,v.D=p.prototype,v.prototype=new w,v.prototype.constructor=v,v.C=function(I,T,A){for(var y=Array(arguments.length-2),te=2;te<arguments.length;te++)y[te-2]=arguments[te];return p.prototype[T].apply(I,y)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,p,w){w||(w=0);var I=Array(16);if(typeof p=="string")for(var T=0;16>T;++T)I[T]=p.charCodeAt(w++)|p.charCodeAt(w++)<<8|p.charCodeAt(w++)<<16|p.charCodeAt(w++)<<24;else for(T=0;16>T;++T)I[T]=p[w++]|p[w++]<<8|p[w++]<<16|p[w++]<<24;p=v.g[0],w=v.g[1],T=v.g[2];var A=v.g[3],y=p+(A^w&(T^A))+I[0]+3614090360&4294967295;p=w+(y<<7&4294967295|y>>>25),y=A+(T^p&(w^T))+I[1]+3905402710&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(w^A&(p^w))+I[2]+606105819&4294967295,T=A+(y<<17&4294967295|y>>>15),y=w+(p^T&(A^p))+I[3]+3250441966&4294967295,w=T+(y<<22&4294967295|y>>>10),y=p+(A^w&(T^A))+I[4]+4118548399&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(T^p&(w^T))+I[5]+1200080426&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(w^A&(p^w))+I[6]+2821735955&4294967295,T=A+(y<<17&4294967295|y>>>15),y=w+(p^T&(A^p))+I[7]+4249261313&4294967295,w=T+(y<<22&4294967295|y>>>10),y=p+(A^w&(T^A))+I[8]+1770035416&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(T^p&(w^T))+I[9]+2336552879&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(w^A&(p^w))+I[10]+4294925233&4294967295,T=A+(y<<17&4294967295|y>>>15),y=w+(p^T&(A^p))+I[11]+2304563134&4294967295,w=T+(y<<22&4294967295|y>>>10),y=p+(A^w&(T^A))+I[12]+1804603682&4294967295,p=w+(y<<7&4294967295|y>>>25),y=A+(T^p&(w^T))+I[13]+4254626195&4294967295,A=p+(y<<12&4294967295|y>>>20),y=T+(w^A&(p^w))+I[14]+2792965006&4294967295,T=A+(y<<17&4294967295|y>>>15),y=w+(p^T&(A^p))+I[15]+1236535329&4294967295,w=T+(y<<22&4294967295|y>>>10),y=p+(T^A&(w^T))+I[1]+4129170786&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^T&(p^w))+I[6]+3225465664&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^w&(A^p))+I[11]+643717713&4294967295,T=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(T^A))+I[0]+3921069994&4294967295,w=T+(y<<20&4294967295|y>>>12),y=p+(T^A&(w^T))+I[5]+3593408605&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^T&(p^w))+I[10]+38016083&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^w&(A^p))+I[15]+3634488961&4294967295,T=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(T^A))+I[4]+3889429448&4294967295,w=T+(y<<20&4294967295|y>>>12),y=p+(T^A&(w^T))+I[9]+568446438&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^T&(p^w))+I[14]+3275163606&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^w&(A^p))+I[3]+4107603335&4294967295,T=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(T^A))+I[8]+1163531501&4294967295,w=T+(y<<20&4294967295|y>>>12),y=p+(T^A&(w^T))+I[13]+2850285829&4294967295,p=w+(y<<5&4294967295|y>>>27),y=A+(w^T&(p^w))+I[2]+4243563512&4294967295,A=p+(y<<9&4294967295|y>>>23),y=T+(p^w&(A^p))+I[7]+1735328473&4294967295,T=A+(y<<14&4294967295|y>>>18),y=w+(A^p&(T^A))+I[12]+2368359562&4294967295,w=T+(y<<20&4294967295|y>>>12),y=p+(w^T^A)+I[5]+4294588738&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^T)+I[8]+2272392833&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^w)+I[11]+1839030562&4294967295,T=A+(y<<16&4294967295|y>>>16),y=w+(T^A^p)+I[14]+4259657740&4294967295,w=T+(y<<23&4294967295|y>>>9),y=p+(w^T^A)+I[1]+2763975236&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^T)+I[4]+1272893353&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^w)+I[7]+4139469664&4294967295,T=A+(y<<16&4294967295|y>>>16),y=w+(T^A^p)+I[10]+3200236656&4294967295,w=T+(y<<23&4294967295|y>>>9),y=p+(w^T^A)+I[13]+681279174&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^T)+I[0]+3936430074&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^w)+I[3]+3572445317&4294967295,T=A+(y<<16&4294967295|y>>>16),y=w+(T^A^p)+I[6]+76029189&4294967295,w=T+(y<<23&4294967295|y>>>9),y=p+(w^T^A)+I[9]+3654602809&4294967295,p=w+(y<<4&4294967295|y>>>28),y=A+(p^w^T)+I[12]+3873151461&4294967295,A=p+(y<<11&4294967295|y>>>21),y=T+(A^p^w)+I[15]+530742520&4294967295,T=A+(y<<16&4294967295|y>>>16),y=w+(T^A^p)+I[2]+3299628645&4294967295,w=T+(y<<23&4294967295|y>>>9),y=p+(T^(w|~A))+I[0]+4096336452&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~T))+I[7]+1126891415&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~w))+I[14]+2878612391&4294967295,T=A+(y<<15&4294967295|y>>>17),y=w+(A^(T|~p))+I[5]+4237533241&4294967295,w=T+(y<<21&4294967295|y>>>11),y=p+(T^(w|~A))+I[12]+1700485571&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~T))+I[3]+2399980690&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~w))+I[10]+4293915773&4294967295,T=A+(y<<15&4294967295|y>>>17),y=w+(A^(T|~p))+I[1]+2240044497&4294967295,w=T+(y<<21&4294967295|y>>>11),y=p+(T^(w|~A))+I[8]+1873313359&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~T))+I[15]+4264355552&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~w))+I[6]+2734768916&4294967295,T=A+(y<<15&4294967295|y>>>17),y=w+(A^(T|~p))+I[13]+1309151649&4294967295,w=T+(y<<21&4294967295|y>>>11),y=p+(T^(w|~A))+I[4]+4149444226&4294967295,p=w+(y<<6&4294967295|y>>>26),y=A+(w^(p|~T))+I[11]+3174756917&4294967295,A=p+(y<<10&4294967295|y>>>22),y=T+(p^(A|~w))+I[2]+718787259&4294967295,T=A+(y<<15&4294967295|y>>>17),y=w+(A^(T|~p))+I[9]+3951481745&4294967295,v.g[0]=v.g[0]+p&4294967295,v.g[1]=v.g[1]+(T+(y<<21&4294967295|y>>>11))&4294967295,v.g[2]=v.g[2]+T&4294967295,v.g[3]=v.g[3]+A&4294967295}n.prototype.u=function(v,p){p===void 0&&(p=v.length);for(var w=p-this.blockSize,I=this.B,T=this.h,A=0;A<p;){if(T==0)for(;A<=w;)i(this,v,A),A+=this.blockSize;if(typeof v=="string"){for(;A<p;)if(I[T++]=v.charCodeAt(A++),T==this.blockSize){i(this,I),T=0;break}}else for(;A<p;)if(I[T++]=v[A++],T==this.blockSize){i(this,I),T=0;break}}this.h=T,this.o+=p},n.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var p=1;p<v.length-8;++p)v[p]=0;var w=8*this.o;for(p=v.length-8;p<v.length;++p)v[p]=w&255,w/=256;for(this.u(v),v=Array(16),p=w=0;4>p;++p)for(var I=0;32>I;I+=8)v[w++]=this.g[p]>>>I&255;return v};function s(v,p){var w=u;return Object.prototype.hasOwnProperty.call(w,v)?w[v]:w[v]=p(v)}function a(v,p){this.h=p;for(var w=[],I=!0,T=v.length-1;0<=T;T--){var A=v[T]|0;I&&A==p||(w[T]=A,I=!1)}this.g=w}var u={};function c(v){return-128<=v&&128>v?s(v,function(p){return new a([p|0],0>p?-1:0)}):new a([v|0],0>v?-1:0)}function d(v){if(isNaN(v)||!isFinite(v))return g;if(0>v)return D(d(-v));for(var p=[],w=1,I=0;v>=w;I++)p[I]=v/w|0,w*=4294967296;return new a(p,0)}function f(v,p){if(v.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(v.charAt(0)=="-")return D(f(v.substring(1),p));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=d(Math.pow(p,8)),I=g,T=0;T<v.length;T+=8){var A=Math.min(8,v.length-T),y=parseInt(v.substring(T,T+A),p);8>A?(A=d(Math.pow(p,A)),I=I.j(A).add(d(y))):(I=I.j(w),I=I.add(d(y)))}return I}var g=c(0),_=c(1),S=c(16777216);r=a.prototype,r.m=function(){if(N(this))return-D(this).m();for(var v=0,p=1,w=0;w<this.g.length;w++){var I=this.i(w);v+=(0<=I?I:4294967296+I)*p,p*=4294967296}return v},r.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(k(this))return"0";if(N(this))return"-"+D(this).toString(v);for(var p=d(Math.pow(v,6)),w=this,I="";;){var T=W(w,p).g;w=z(w,T.j(p));var A=((0<w.g.length?w.g[0]:w.h)>>>0).toString(v);if(w=T,k(w))return A+I;for(;6>A.length;)A="0"+A;I=A+I}},r.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function k(v){if(v.h!=0)return!1;for(var p=0;p<v.g.length;p++)if(v.g[p]!=0)return!1;return!0}function N(v){return v.h==-1}r.l=function(v){return v=z(this,v),N(v)?-1:k(v)?0:1};function D(v){for(var p=v.g.length,w=[],I=0;I<p;I++)w[I]=~v.g[I];return new a(w,~v.h).add(_)}r.abs=function(){return N(this)?D(this):this},r.add=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],I=0,T=0;T<=p;T++){var A=I+(this.i(T)&65535)+(v.i(T)&65535),y=(A>>>16)+(this.i(T)>>>16)+(v.i(T)>>>16);I=y>>>16,A&=65535,y&=65535,w[T]=y<<16|A}return new a(w,w[w.length-1]&-2147483648?-1:0)};function z(v,p){return v.add(D(p))}r.j=function(v){if(k(this)||k(v))return g;if(N(this))return N(v)?D(this).j(D(v)):D(D(this).j(v));if(N(v))return D(this.j(D(v)));if(0>this.l(S)&&0>v.l(S))return d(this.m()*v.m());for(var p=this.g.length+v.g.length,w=[],I=0;I<2*p;I++)w[I]=0;for(I=0;I<this.g.length;I++)for(var T=0;T<v.g.length;T++){var A=this.i(I)>>>16,y=this.i(I)&65535,te=v.i(T)>>>16,ar=v.i(T)&65535;w[2*I+2*T]+=y*ar,j(w,2*I+2*T),w[2*I+2*T+1]+=A*ar,j(w,2*I+2*T+1),w[2*I+2*T+1]+=y*te,j(w,2*I+2*T+1),w[2*I+2*T+2]+=A*te,j(w,2*I+2*T+2)}for(I=0;I<p;I++)w[I]=w[2*I+1]<<16|w[2*I];for(I=p;I<2*p;I++)w[I]=0;return new a(w,0)};function j(v,p){for(;(v[p]&65535)!=v[p];)v[p+1]+=v[p]>>>16,v[p]&=65535,p++}function B(v,p){this.g=v,this.h=p}function W(v,p){if(k(p))throw Error("division by zero");if(k(v))return new B(g,g);if(N(v))return p=W(D(v),p),new B(D(p.g),D(p.h));if(N(p))return p=W(v,D(p)),new B(D(p.g),p.h);if(30<v.g.length){if(N(v)||N(p))throw Error("slowDivide_ only works with positive integers.");for(var w=_,I=p;0>=I.l(v);)w=Z(w),I=Z(I);var T=K(w,1),A=K(I,1);for(I=K(I,2),w=K(w,2);!k(I);){var y=A.add(I);0>=y.l(v)&&(T=T.add(w),A=y),I=K(I,1),w=K(w,1)}return p=z(v,T.j(p)),new B(T,p)}for(T=g;0<=v.l(p);){for(w=Math.max(1,Math.floor(v.m()/p.m())),I=Math.ceil(Math.log(w)/Math.LN2),I=48>=I?1:Math.pow(2,I-48),A=d(w),y=A.j(p);N(y)||0<y.l(v);)w-=I,A=d(w),y=A.j(p);k(A)&&(A=_),T=T.add(A),v=z(v,y)}return new B(T,v)}r.A=function(v){return W(this,v).h},r.and=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],I=0;I<p;I++)w[I]=this.i(I)&v.i(I);return new a(w,this.h&v.h)},r.or=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],I=0;I<p;I++)w[I]=this.i(I)|v.i(I);return new a(w,this.h|v.h)},r.xor=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],I=0;I<p;I++)w[I]=this.i(I)^v.i(I);return new a(w,this.h^v.h)};function Z(v){for(var p=v.g.length+1,w=[],I=0;I<p;I++)w[I]=v.i(I)<<1|v.i(I-1)>>>31;return new a(w,v.h)}function K(v,p){var w=p>>5;p%=32;for(var I=v.g.length-w,T=[],A=0;A<I;A++)T[A]=0<p?v.i(A+w)>>>p|v.i(A+w+1)<<32-p:v.i(A+w);return new a(T,v.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Jo=ah.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,_e=ah.Integer=a}).apply(typeof oh<"u"?oh:typeof self<"u"?self:typeof window<"u"?window:{});var Bi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},re={};var Yo,Qg,Tn,Xo,Cr,zi,Zo,ta,ea;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,l,h){return o==Array.prototype||o==Object.prototype||(o[l]=h.value),o};function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Bi=="object"&&Bi];for(var l=0;l<o.length;++l){var h=o[l];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function i(o,l){if(l)t:{var h=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var E=o[m];if(!(E in h))break t;h=h[E]}o=o[o.length-1],m=h[o],l=l(m),l!=m&&l!=null&&t(h,o,{configurable:!0,writable:!0,value:l})}}function s(o,l){o instanceof String&&(o+="");var h=0,m=!1,E={next:function(){if(!m&&h<o.length){var P=h++;return{value:l(P,o[P]),done:!1}}return m=!0,{done:!0,value:void 0}}};return E[Symbol.iterator]=function(){return E},E}i("Array.prototype.values",function(o){return o||function(){return s(this,function(l,h){return h})}});var a=a||{},u=this||self;function c(o){var l=typeof o;return l=l!="object"?l:o?Array.isArray(o)?"array":l:"null",l=="array"||l=="object"&&typeof o.length=="number"}function d(o){var l=typeof o;return l=="object"&&o!=null||l=="function"}function f(o,l,h){return o.call.apply(o.bind,arguments)}function g(o,l,h){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var E=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(E,m),o.apply(l,E)}}return function(){return o.apply(l,arguments)}}function _(o,l,h){return _=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:g,_.apply(null,arguments)}function S(o,l){var h=Array.prototype.slice.call(arguments,1);return function(){var m=h.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function k(o,l){function h(){}h.prototype=l.prototype,o.aa=l.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(m,E,P){for(var F=Array(arguments.length-2),et=2;et<arguments.length;et++)F[et-2]=arguments[et];return l.prototype[E].apply(m,F)}}function N(o){let l=o.length;if(0<l){let h=Array(l);for(let m=0;m<l;m++)h[m]=o[m];return h}return[]}function D(o,l){for(let h=1;h<arguments.length;h++){let m=arguments[h];if(c(m)){let E=o.length||0,P=m.length||0;o.length=E+P;for(let F=0;F<P;F++)o[E+F]=m[F]}else o.push(m)}}class z{constructor(l,h){this.i=l,this.j=h,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function j(o){return/^[\s\xa0]*$/.test(o)}function B(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function W(o){return W[" "](o),o}W[" "]=function(){};var Z=B().indexOf("Gecko")!=-1&&!(B().toLowerCase().indexOf("webkit")!=-1&&B().indexOf("Edge")==-1)&&!(B().indexOf("Trident")!=-1||B().indexOf("MSIE")!=-1)&&B().indexOf("Edge")==-1;function K(o,l,h){for(let m in o)l.call(h,o[m],m,o)}function v(o,l){for(let h in o)l.call(void 0,o[h],h,o)}function p(o){let l={};for(let h in o)l[h]=o[h];return l}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function I(o,l){let h,m;for(let E=1;E<arguments.length;E++){m=arguments[E];for(h in m)o[h]=m[h];for(let P=0;P<w.length;P++)h=w[P],Object.prototype.hasOwnProperty.call(m,h)&&(o[h]=m[h])}}function T(o){var l=1;o=o.split(":");let h=[];for(;0<l&&o.length;)h.push(o.shift()),l--;return o.length&&h.push(o.join(":")),h}function A(o){u.setTimeout(()=>{throw o},0)}function y(){var o=so;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}class te{constructor(){this.h=this.g=null}add(l,h){let m=ar.get();m.set(l,h),this.h?this.h.next=m:this.g=m,this.h=m}}var ar=new z(()=>new Jf,o=>o.reset());class Jf{constructor(){this.next=this.g=this.h=null}set(l,h){this.h=l,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let ur,cr=!1,so=new te,qc=()=>{let o=u.Promise.resolve(void 0);ur=()=>{o.then(Yf)}};var Yf=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){A(h)}var l=ar;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}cr=!1};function fe(){this.s=this.s,this.C=this.C}fe.prototype.s=!1,fe.prototype.ma=function(){this.s||(this.s=!0,this.N())},fe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function At(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}At.prototype.h=function(){this.defaultPrevented=!0};var Xf=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};u.addEventListener("test",h,l),u.removeEventListener("test",h,l)}catch{}return o}();function lr(o,l){if(At.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(Z){t:{try{W(l.nodeName);var E=!0;break t}catch{}E=!1}E||(l=null)}}else h=="mouseover"?l=o.fromElement:h=="mouseout"&&(l=o.toElement);this.relatedTarget=l,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:Zf[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&lr.aa.h.call(this)}}k(lr,At);var Zf={2:"touch",3:"pen",4:"mouse"};lr.prototype.h=function(){lr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var hr="closure_listenable_"+(1e6*Math.random()|0),tm=0;function em(o,l,h,m,E){this.listener=o,this.proxy=null,this.src=l,this.type=h,this.capture=!!m,this.ha=E,this.key=++tm,this.da=this.fa=!1}function pi(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function yi(o){this.src=o,this.g={},this.h=0}yi.prototype.add=function(o,l,h,m,E){var P=o.toString();o=this.g[P],o||(o=this.g[P]=[],this.h++);var F=ao(o,l,m,E);return-1<F?(l=o[F],h||(l.fa=!1)):(l=new em(l,this.src,P,!!m,E),l.fa=h,o.push(l)),l};function oo(o,l){var h=l.type;if(h in o.g){var m=o.g[h],E=Array.prototype.indexOf.call(m,l,void 0),P;(P=0<=E)&&Array.prototype.splice.call(m,E,1),P&&(pi(l),o.g[h].length==0&&(delete o.g[h],o.h--))}}function ao(o,l,h,m){for(var E=0;E<o.length;++E){var P=o[E];if(!P.da&&P.listener==l&&P.capture==!!h&&P.ha==m)return E}return-1}var uo="closure_lm_"+(1e6*Math.random()|0),co={};function Bc(o,l,h,m,E){if(m&&m.once)return jc(o,l,h,m,E);if(Array.isArray(l)){for(var P=0;P<l.length;P++)Bc(o,l[P],h,m,E);return null}return h=mo(h),o&&o[hr]?o.K(l,h,d(m)?!!m.capture:!!m,E):zc(o,l,h,!1,m,E)}function zc(o,l,h,m,E,P){if(!l)throw Error("Invalid event type");var F=d(E)?!!E.capture:!!E,et=ho(o);if(et||(o[uo]=et=new yi(o)),h=et.add(l,h,m,F,P),h.proxy)return h;if(m=nm(),h.proxy=m,m.src=o,m.listener=h,o.addEventListener)Xf||(E=F),E===void 0&&(E=!1),o.addEventListener(l.toString(),m,E);else if(o.attachEvent)o.attachEvent($c(l.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return h}function nm(){function o(h){return l.call(o.src,o.listener,h)}let l=rm;return o}function jc(o,l,h,m,E){if(Array.isArray(l)){for(var P=0;P<l.length;P++)jc(o,l[P],h,m,E);return null}return h=mo(h),o&&o[hr]?o.L(l,h,d(m)?!!m.capture:!!m,E):zc(o,l,h,!0,m,E)}function Gc(o,l,h,m,E){if(Array.isArray(l))for(var P=0;P<l.length;P++)Gc(o,l[P],h,m,E);else m=d(m)?!!m.capture:!!m,h=mo(h),o&&o[hr]?(o=o.i,l=String(l).toString(),l in o.g&&(P=o.g[l],h=ao(P,h,m,E),-1<h&&(pi(P[h]),Array.prototype.splice.call(P,h,1),P.length==0&&(delete o.g[l],o.h--)))):o&&(o=ho(o))&&(l=o.g[l.toString()],o=-1,l&&(o=ao(l,h,m,E)),(h=-1<o?l[o]:null)&&lo(h))}function lo(o){if(typeof o!="number"&&o&&!o.da){var l=o.src;if(l&&l[hr])oo(l.i,o);else{var h=o.type,m=o.proxy;l.removeEventListener?l.removeEventListener(h,m,o.capture):l.detachEvent?l.detachEvent($c(h),m):l.addListener&&l.removeListener&&l.removeListener(m),(h=ho(l))?(oo(h,o),h.h==0&&(h.src=null,l[uo]=null)):pi(o)}}}function $c(o){return o in co?co[o]:co[o]="on"+o}function rm(o,l){if(o.da)o=!0;else{l=new lr(l,this);var h=o.listener,m=o.ha||o.src;o.fa&&lo(o),o=h.call(m,l)}return o}function ho(o){return o=o[uo],o instanceof yi?o:null}var fo="__closure_events_fn_"+(1e9*Math.random()>>>0);function mo(o){return typeof o=="function"?o:(o[fo]||(o[fo]=function(l){return o.handleEvent(l)}),o[fo])}function St(){fe.call(this),this.i=new yi(this),this.M=this,this.F=null}k(St,fe),St.prototype[hr]=!0,St.prototype.removeEventListener=function(o,l,h,m){Gc(this,o,l,h,m)};function Ct(o,l){var h,m=o.F;if(m)for(h=[];m;m=m.F)h.push(m);if(o=o.M,m=l.type||l,typeof l=="string")l=new At(l,o);else if(l instanceof At)l.target=l.target||o;else{var E=l;l=new At(m,o),I(l,E)}if(E=!0,h)for(var P=h.length-1;0<=P;P--){var F=l.g=h[P];E=_i(F,m,!0,l)&&E}if(F=l.g=o,E=_i(F,m,!0,l)&&E,E=_i(F,m,!1,l)&&E,h)for(P=0;P<h.length;P++)F=l.g=h[P],E=_i(F,m,!1,l)&&E}St.prototype.N=function(){if(St.aa.N.call(this),this.i){var o=this.i,l;for(l in o.g){for(var h=o.g[l],m=0;m<h.length;m++)pi(h[m]);delete o.g[l],o.h--}}this.F=null},St.prototype.K=function(o,l,h,m){return this.i.add(String(o),l,!1,h,m)},St.prototype.L=function(o,l,h,m){return this.i.add(String(o),l,!0,h,m)};function _i(o,l,h,m){if(l=o.i.g[String(l)],!l)return!0;l=l.concat();for(var E=!0,P=0;P<l.length;++P){var F=l[P];if(F&&!F.da&&F.capture==h){var et=F.listener,Tt=F.ha||F.src;F.fa&&oo(o.i,F),E=et.call(Tt,m)!==!1&&E}}return E&&!m.defaultPrevented}function Kc(o,l,h){if(typeof o=="function")h&&(o=_(o,h));else if(o&&typeof o.handleEvent=="function")o=_(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function Qc(o){o.g=Kc(()=>{o.g=null,o.i&&(o.i=!1,Qc(o))},o.l);let l=o.h;o.h=null,o.m.apply(null,l)}class im extends fe{constructor(l,h){super(),this.m=l,this.l=h,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Qc(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function dr(o){fe.call(this),this.h=o,this.g={}}k(dr,fe);var Wc=[];function Hc(o){K(o.g,function(l,h){this.g.hasOwnProperty(h)&&lo(l)},o),o.g={}}dr.prototype.N=function(){dr.aa.N.call(this),Hc(this)},dr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var go=u.JSON.stringify,sm=u.JSON.parse,om=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function po(){}po.prototype.h=null;function Jc(o){return o.h||(o.h=o.i())}function Yc(){}var fr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function yo(){At.call(this,"d")}k(yo,At);function _o(){At.call(this,"c")}k(_o,At);var Ue={},Xc=null;function wi(){return Xc=Xc||new St}Ue.La="serverreachability";function Zc(o){At.call(this,Ue.La,o)}k(Zc,At);function mr(o){let l=wi();Ct(l,new Zc(l))}Ue.STAT_EVENT="statevent";function tl(o,l){At.call(this,Ue.STAT_EVENT,o),this.stat=l}k(tl,At);function xt(o){let l=wi();Ct(l,new tl(l,o))}Ue.Ma="timingevent";function el(o,l){At.call(this,Ue.Ma,o),this.size=l}k(el,At);function gr(o,l){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function pr(){this.g=!0}pr.prototype.xa=function(){this.g=!1};function am(o,l,h,m,E,P){o.info(function(){if(o.g)if(P)for(var F="",et=P.split("&"),Tt=0;Tt<et.length;Tt++){var Y=et[Tt].split("=");if(1<Y.length){var Rt=Y[0];Y=Y[1];var Pt=Rt.split("_");F=2<=Pt.length&&Pt[1]=="type"?F+(Rt+"="+Y+"&"):F+(Rt+"=redacted&")}}else F=null;else F=P;return"XMLHTTP REQ ("+m+") [attempt "+E+"]: "+l+`
`+h+`
`+F})}function um(o,l,h,m,E,P,F){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+E+"]: "+l+`
`+h+`
`+P+" "+F})}function pn(o,l,h,m){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+lm(o,h)+(m?" "+m:"")})}function cm(o,l){o.info(function(){return"TIMEOUT: "+l})}pr.prototype.info=function(){};function lm(o,l){if(!o.g)return l;if(!l)return null;try{var h=JSON.parse(l);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var m=h[o];if(!(2>m.length)){var E=m[1];if(Array.isArray(E)&&!(1>E.length)){var P=E[0];if(P!="noop"&&P!="stop"&&P!="close")for(var F=1;F<E.length;F++)E[F]=""}}}}return go(h)}catch{return l}}var vi={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},nl={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},wo;function Ii(){}k(Ii,po),Ii.prototype.g=function(){return new XMLHttpRequest},Ii.prototype.i=function(){return{}},wo=new Ii;function me(o,l,h,m){this.j=o,this.i=l,this.l=h,this.R=m||1,this.U=new dr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new rl}function rl(){this.i=null,this.g="",this.h=!1}var il={},vo={};function Io(o,l,h){o.L=1,o.v=Si(ee(l)),o.m=h,o.P=!0,sl(o,null)}function sl(o,l){o.F=Date.now(),Ti(o),o.A=ee(o.v);var h=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),wl(h.i,"t",m),o.C=0,h=o.j.J,o.h=new rl,o.g=Ml(o.j,h?l:null,!o.m),0<o.O&&(o.M=new im(_(o.Y,o,o.g),o.O)),l=o.U,h=o.g,m=o.ca;var E="readystatechange";Array.isArray(E)||(E&&(Wc[0]=E.toString()),E=Wc);for(var P=0;P<E.length;P++){var F=Bc(h,E[P],m||l.handleEvent,!1,l.h||l);if(!F)break;l.g[F.key]=F}l=o.H?p(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),mr(),am(o.i,o.u,o.A,o.l,o.R,o.m)}me.prototype.ca=function(o){o=o.target;let l=this.M;l&&ne(o)==3?l.j():this.Y(o)},me.prototype.Y=function(o){try{if(o==this.g)t:{let Pt=ne(this.g);var l=this.g.Ba();let wn=this.g.Z();if(!(3>Pt)&&(Pt!=3||this.g&&(this.h.h||this.g.oa()||Rl(this.g)))){this.J||Pt!=4||l==7||(l==8||0>=wn?mr(3):mr(2)),To(this);var h=this.g.Z();this.X=h;e:if(ol(this)){var m=Rl(this.g);o="";var E=m.length,P=ne(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){qe(this),yr(this);var F="";break e}this.h.i=new u.TextDecoder}for(l=0;l<E;l++)this.h.h=!0,o+=this.h.i.decode(m[l],{stream:!(P&&l==E-1)});m.length=0,this.h.g+=o,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=h==200,um(this.i,this.u,this.A,this.l,this.R,Pt,h),this.o){if(this.T&&!this.K){e:{if(this.g){var et,Tt=this.g;if((et=Tt.g?Tt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(et)){var Y=et;break e}}Y=null}if(h=Y)pn(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Eo(this,h);else{this.o=!1,this.s=3,xt(12),qe(this),yr(this);break t}}if(this.P){h=!0;let Bt;for(;!this.J&&this.C<F.length;)if(Bt=hm(this,F),Bt==vo){Pt==4&&(this.s=4,xt(14),h=!1),pn(this.i,this.l,null,"[Incomplete Response]");break}else if(Bt==il){this.s=4,xt(15),pn(this.i,this.l,F,"[Invalid Chunk]"),h=!1;break}else pn(this.i,this.l,Bt,null),Eo(this,Bt);if(ol(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Pt!=4||F.length!=0||this.h.h||(this.s=1,xt(16),h=!1),this.o=this.o&&h,!h)pn(this.i,this.l,F,"[Invalid Chunked Response]"),qe(this),yr(this);else if(0<F.length&&!this.W){this.W=!0;var Rt=this.j;Rt.g==this&&Rt.ba&&!Rt.M&&(Rt.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),Vo(Rt),Rt.M=!0,xt(11))}}else pn(this.i,this.l,F,null),Eo(this,F);Pt==4&&qe(this),this.o&&!this.J&&(Pt==4?kl(this.j,this):(this.o=!1,Ti(this)))}else bm(this.g),h==400&&0<F.indexOf("Unknown SID")?(this.s=3,xt(12)):(this.s=0,xt(13)),qe(this),yr(this)}}}catch{}finally{}};function ol(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function hm(o,l){var h=o.C,m=l.indexOf(`
`,h);return m==-1?vo:(h=Number(l.substring(h,m)),isNaN(h)?il:(m+=1,m+h>l.length?vo:(l=l.slice(m,m+h),o.C=m+h,l)))}me.prototype.cancel=function(){this.J=!0,qe(this)};function Ti(o){o.S=Date.now()+o.I,al(o,o.I)}function al(o,l){if(o.B!=null)throw Error("WatchDog timer not null");o.B=gr(_(o.ba,o),l)}function To(o){o.B&&(u.clearTimeout(o.B),o.B=null)}me.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(cm(this.i,this.A),this.L!=2&&(mr(),xt(17)),qe(this),this.s=2,yr(this)):al(this,this.S-o)};function yr(o){o.j.G==0||o.J||kl(o.j,o)}function qe(o){To(o);var l=o.M;l&&typeof l.ma=="function"&&l.ma(),o.M=null,Hc(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function Eo(o,l){try{var h=o.j;if(h.G!=0&&(h.g==o||Ao(h.h,o))){if(!o.K&&Ao(h.h,o)&&h.G==3){try{var m=h.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&m.length==3){var E=m;if(E[0]==0){t:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)Ci(h),bi(h);else break t;bo(h),xt(18)}}else h.za=E[1],0<h.za-h.T&&37500>E[2]&&h.F&&h.v==0&&!h.C&&(h.C=gr(_(h.Za,h),6e3));if(1>=ll(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else ze(h,11)}else if((o.K||h.g==o)&&Ci(h),!j(l))for(E=h.Da.g.parse(l),l=0;l<E.length;l++){let Y=E[l];if(h.T=Y[0],Y=Y[1],h.G==2)if(Y[0]=="c"){h.K=Y[1],h.ia=Y[2];let Rt=Y[3];Rt!=null&&(h.la=Rt,h.j.info("VER="+h.la));let Pt=Y[4];Pt!=null&&(h.Aa=Pt,h.j.info("SVER="+h.Aa));let wn=Y[5];wn!=null&&typeof wn=="number"&&0<wn&&(m=1.5*wn,h.L=m,h.j.info("backChannelRequestTimeoutMs_="+m)),m=h;let Bt=o.g;if(Bt){let Di=Bt.g?Bt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Di){var P=m.h;P.g||Di.indexOf("spdy")==-1&&Di.indexOf("quic")==-1&&Di.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(So(P,P.h),P.h=null))}if(m.D){let Co=Bt.g?Bt.g.getResponseHeader("X-HTTP-Session-Id"):null;Co&&(m.ya=Co,rt(m.I,m.D,Co))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),m=h;var F=o;if(m.qa=Ol(m,m.J?m.ia:null,m.W),F.K){hl(m.h,F);var et=F,Tt=m.L;Tt&&(et.I=Tt),et.B&&(To(et),Ti(et)),m.g=F}else xl(m);0<h.i.length&&Vi(h)}else Y[0]!="stop"&&Y[0]!="close"||ze(h,7);else h.G==3&&(Y[0]=="stop"||Y[0]=="close"?Y[0]=="stop"?ze(h,7):Po(h):Y[0]!="noop"&&h.l&&h.l.ta(Y),h.v=0)}}mr(4)}catch{}}var dm=class{constructor(o,l){this.g=o,this.map=l}};function ul(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function cl(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function ll(o){return o.h?1:o.g?o.g.size:0}function Ao(o,l){return o.h?o.h==l:o.g?o.g.has(l):!1}function So(o,l){o.g?o.g.add(l):o.h=l}function hl(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}ul.prototype.cancel=function(){if(this.i=dl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function dl(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let l=o.i;for(let h of o.g.values())l=l.concat(h.D);return l}return N(o.i)}function fm(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(c(o)){for(var l=[],h=o.length,m=0;m<h;m++)l.push(o[m]);return l}l=[],h=0;for(m in o)l[h++]=o[m];return l}function mm(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||typeof o=="string"){var l=[];o=o.length;for(var h=0;h<o;h++)l.push(h);return l}l=[],h=0;for(let m in o)l[h++]=m;return l}}}function fl(o,l){if(o.forEach&&typeof o.forEach=="function")o.forEach(l,void 0);else if(c(o)||typeof o=="string")Array.prototype.forEach.call(o,l,void 0);else for(var h=mm(o),m=fm(o),E=m.length,P=0;P<E;P++)l.call(void 0,m[P],h&&h[P],o)}var ml=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function gm(o,l){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var m=o[h].indexOf("="),E=null;if(0<=m){var P=o[h].substring(0,m);E=o[h].substring(m+1)}else P=o[h];l(P,E?decodeURIComponent(E.replace(/\+/g," ")):"")}}}function Be(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof Be){this.h=o.h,Ei(this,o.j),this.o=o.o,this.g=o.g,Ai(this,o.s),this.l=o.l;var l=o.i,h=new vr;h.i=l.i,l.g&&(h.g=new Map(l.g),h.h=l.h),gl(this,h),this.m=o.m}else o&&(l=String(o).match(ml))?(this.h=!1,Ei(this,l[1]||"",!0),this.o=_r(l[2]||""),this.g=_r(l[3]||"",!0),Ai(this,l[4]),this.l=_r(l[5]||"",!0),gl(this,l[6]||"",!0),this.m=_r(l[7]||"")):(this.h=!1,this.i=new vr(null,this.h))}Be.prototype.toString=function(){var o=[],l=this.j;l&&o.push(wr(l,pl,!0),":");var h=this.g;return(h||l=="file")&&(o.push("//"),(l=this.o)&&o.push(wr(l,pl,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(wr(h,h.charAt(0)=="/"?_m:ym,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",wr(h,vm)),o.join("")};function ee(o){return new Be(o)}function Ei(o,l,h){o.j=h?_r(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function Ai(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function gl(o,l,h){l instanceof vr?(o.i=l,Im(o.i,o.h)):(h||(l=wr(l,wm)),o.i=new vr(l,o.h))}function rt(o,l,h){o.i.set(l,h)}function Si(o){return rt(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function _r(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function wr(o,l,h){return typeof o=="string"?(o=encodeURI(o).replace(l,pm),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function pm(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var pl=/[#\/\?@]/g,ym=/[#\?:]/g,_m=/[#\?]/g,wm=/[#\?@]/g,vm=/#/g;function vr(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function ge(o){o.g||(o.g=new Map,o.h=0,o.i&&gm(o.i,function(l,h){o.add(decodeURIComponent(l.replace(/\+/g," ")),h)}))}r=vr.prototype,r.add=function(o,l){ge(this),this.i=null,o=yn(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(l),this.h+=1,this};function yl(o,l){ge(o),l=yn(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function _l(o,l){return ge(o),l=yn(o,l),o.g.has(l)}r.forEach=function(o,l){ge(this),this.g.forEach(function(h,m){h.forEach(function(E){o.call(l,E,m,this)},this)},this)},r.na=function(){ge(this);let o=Array.from(this.g.values()),l=Array.from(this.g.keys()),h=[];for(let m=0;m<l.length;m++){let E=o[m];for(let P=0;P<E.length;P++)h.push(l[m])}return h},r.V=function(o){ge(this);let l=[];if(typeof o=="string")_l(this,o)&&(l=l.concat(this.g.get(yn(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)l=l.concat(o[h])}return l},r.set=function(o,l){return ge(this),this.i=null,o=yn(this,o),_l(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o?(o=this.V(o),0<o.length?String(o[0]):l):l};function wl(o,l,h){yl(o,l),0<h.length&&(o.i=null,o.g.set(yn(o,l),N(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],l=Array.from(this.g.keys());for(var h=0;h<l.length;h++){var m=l[h];let P=encodeURIComponent(String(m)),F=this.V(m);for(m=0;m<F.length;m++){var E=P;F[m]!==""&&(E+="="+encodeURIComponent(String(F[m]))),o.push(E)}}return this.i=o.join("&")};function yn(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function Im(o,l){l&&!o.j&&(ge(o),o.i=null,o.g.forEach(function(h,m){var E=m.toLowerCase();m!=E&&(yl(this,m),wl(this,E,h))},o)),o.j=l}function Tm(o,l){let h=new pr;if(u.Image){let m=new Image;m.onload=S(pe,h,"TestLoadImage: loaded",!0,l,m),m.onerror=S(pe,h,"TestLoadImage: error",!1,l,m),m.onabort=S(pe,h,"TestLoadImage: abort",!1,l,m),m.ontimeout=S(pe,h,"TestLoadImage: timeout",!1,l,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else l(!1)}function Em(o,l){let h=new pr,m=new AbortController,E=setTimeout(()=>{m.abort(),pe(h,"TestPingServer: timeout",!1,l)},1e4);fetch(o,{signal:m.signal}).then(P=>{clearTimeout(E),P.ok?pe(h,"TestPingServer: ok",!0,l):pe(h,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(E),pe(h,"TestPingServer: error",!1,l)})}function pe(o,l,h,m,E){try{E&&(E.onload=null,E.onerror=null,E.onabort=null,E.ontimeout=null),m(h)}catch{}}function Am(){this.g=new om}function Sm(o,l,h){let m=h||"";try{fl(o,function(E,P){let F=E;d(E)&&(F=go(E)),l.push(m+P+"="+encodeURIComponent(F))})}catch(E){throw l.push(m+"type="+encodeURIComponent("_badmap")),E}}function Ir(o){this.l=o.Ub||null,this.j=o.eb||!1}k(Ir,po),Ir.prototype.g=function(){return new Ri(this.l,this.j)},Ir.prototype.i=function(o){return function(){return o}}({});function Ri(o,l){St.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}k(Ri,St),r=Ri.prototype,r.open=function(o,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,Er(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Tr(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Er(this)),this.g&&(this.readyState=3,Er(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;vl(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function vl(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?Tr(this):Er(this),this.readyState==3&&vl(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,Tr(this))},r.Qa=function(o){this.g&&(this.response=o,Tr(this))},r.ga=function(){this.g&&Tr(this)};function Tr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Er(o)}r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],l=this.h.entries();for(var h=l.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=l.next();return o.join(`\r
`)};function Er(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Ri.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function Il(o){let l="";return K(o,function(h,m){l+=m,l+=":",l+=h,l+=`\r
`}),l}function Ro(o,l,h){t:{for(m in h){var m=!1;break t}m=!0}m||(h=Il(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):rt(o,l,h))}function at(o){St.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}k(at,St);var Rm=/^https?$/i,Pm=["POST","PUT"];r=at.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,l,h,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():wo.g(),this.v=this.o?Jc(this.o):Jc(wo),this.g.onreadystatechange=_(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(P){Tl(this,P);return}if(o=h||"",h=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var E in m)h.set(E,m[E]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let P of m.keys())h.set(P,m.get(P));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(h.keys()).find(P=>P.toLowerCase()=="content-type"),E=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Pm,l,void 0))||m||E||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,F]of h)this.g.setRequestHeader(P,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Sl(this),this.u=!0,this.g.send(o),this.u=!1}catch(P){Tl(this,P)}};function Tl(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,El(o),Pi(o)}function El(o){o.A||(o.A=!0,Ct(o,"complete"),Ct(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Ct(this,"complete"),Ct(this,"abort"),Pi(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Pi(this,!0)),at.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Al(this):this.bb())},r.bb=function(){Al(this)};function Al(o){if(o.h&&typeof a<"u"&&(!o.v[1]||ne(o)!=4||o.Z()!=2)){if(o.u&&ne(o)==4)Kc(o.Ea,0,o);else if(Ct(o,"readystatechange"),ne(o)==4){o.h=!1;try{let F=o.Z();t:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break t;default:l=!1}var h;if(!(h=l)){var m;if(m=F===0){var E=String(o.D).match(ml)[1]||null;!E&&u.self&&u.self.location&&(E=u.self.location.protocol.slice(0,-1)),m=!Rm.test(E?E.toLowerCase():"")}h=m}if(h)Ct(o,"complete"),Ct(o,"success");else{o.m=6;try{var P=2<ne(o)?o.g.statusText:""}catch{P=""}o.l=P+" ["+o.Z()+"]",El(o)}}finally{Pi(o)}}}}function Pi(o,l){if(o.g){Sl(o);let h=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||Ct(o,"ready");try{h.onreadystatechange=m}catch{}}}function Sl(o){o.I&&(u.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function ne(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<ne(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&l.indexOf(o)==0&&(l=l.substring(o.length)),sm(l)}};function Rl(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function bm(o){let l={};o=(o.g&&2<=ne(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(j(o[m]))continue;var h=T(o[m]);let E=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let P=l[E]||[];l[E]=P,P.push(h)}v(l,function(m){return m.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ar(o,l,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||l}function Pl(o){this.Aa=0,this.i=[],this.j=new pr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ar("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ar("baseRetryDelayMs",5e3,o),this.cb=Ar("retryDelaySeedMs",1e4,o),this.Wa=Ar("forwardChannelMaxRetries",2,o),this.wa=Ar("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new ul(o&&o.concurrentRequestLimit),this.Da=new Am,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Pl.prototype,r.la=8,r.G=1,r.connect=function(o,l,h,m){xt(0),this.W=o,this.H=l||{},h&&m!==void 0&&(this.H.OSID=h,this.H.OAID=m),this.F=this.X,this.I=Ol(this,null,this.W),Vi(this)};function Po(o){if(bl(o),o.G==3){var l=o.U++,h=ee(o.I);if(rt(h,"SID",o.K),rt(h,"RID",l),rt(h,"TYPE","terminate"),Sr(o,h),l=new me(o,o.j,l),l.L=2,l.v=Si(ee(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=l.v,h=!0),h||(l.g=Ml(l.j,null),l.g.ea(l.v)),l.F=Date.now(),Ti(l)}Fl(o)}function bi(o){o.g&&(Vo(o),o.g.cancel(),o.g=null)}function bl(o){bi(o),o.u&&(u.clearTimeout(o.u),o.u=null),Ci(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function Vi(o){if(!cl(o.h)&&!o.s){o.s=!0;var l=o.Ga;ur||qc(),cr||(ur(),cr=!0),so.add(l,o),o.B=0}}function Vm(o,l){return ll(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=l.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=gr(_(o.Ga,o,l),Nl(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let E=new me(this,this.j,o),P=this.o;if(this.S&&(P?(P=p(P),I(P,this.S)):P=this.S),this.m!==null||this.O||(E.H=P,P=null),this.P)t:{for(var l=0,h=0;h<this.i.length;h++){e:{var m=this.i[h];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(l+=m,4096<l){l=h;break t}if(l===4096||h===this.i.length-1){l=h+1;break t}}l=1e3}else l=1e3;l=Cl(this,E,l),h=ee(this.I),rt(h,"RID",o),rt(h,"CVER",22),this.D&&rt(h,"X-HTTP-Session-Id",this.D),Sr(this,h),P&&(this.O?l="headers="+encodeURIComponent(String(Il(P)))+"&"+l:this.m&&Ro(h,this.m,P)),So(this.h,E),this.Ua&&rt(h,"TYPE","init"),this.P?(rt(h,"$req",l),rt(h,"SID","null"),E.T=!0,Io(E,h,null)):Io(E,h,l),this.G=2}}else this.G==3&&(o?Vl(this,o):this.i.length==0||cl(this.h)||Vl(this))};function Vl(o,l){var h;l?h=l.l:h=o.U++;let m=ee(o.I);rt(m,"SID",o.K),rt(m,"RID",h),rt(m,"AID",o.T),Sr(o,m),o.m&&o.o&&Ro(m,o.m,o.o),h=new me(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),l&&(o.i=l.D.concat(o.i)),l=Cl(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),So(o.h,h),Io(h,m,l)}function Sr(o,l){o.H&&K(o.H,function(h,m){rt(l,m,h)}),o.l&&fl({},function(h,m){rt(l,m,h)})}function Cl(o,l,h){h=Math.min(o.i.length,h);var m=o.l?_(o.l.Na,o.l,o):null;t:{var E=o.i;let P=-1;for(;;){let F=["count="+h];P==-1?0<h?(P=E[0].g,F.push("ofs="+P)):P=0:F.push("ofs="+P);let et=!0;for(let Tt=0;Tt<h;Tt++){let Y=E[Tt].g,Rt=E[Tt].map;if(Y-=P,0>Y)P=Math.max(0,E[Tt].g-100),et=!1;else try{Sm(Rt,F,"req"+Y+"_")}catch{m&&m(Rt)}}if(et){m=F.join("&");break t}}}return o=o.i.splice(0,h),l.D=o,m}function xl(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;ur||qc(),cr||(ur(),cr=!0),so.add(l,o),o.v=0}}function bo(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=gr(_(o.Fa,o),Nl(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,Dl(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=gr(_(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,xt(10),bi(this),Dl(this))};function Vo(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function Dl(o){o.g=new me(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var l=ee(o.qa);rt(l,"RID","rpc"),rt(l,"SID",o.K),rt(l,"AID",o.T),rt(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&rt(l,"TO",o.ja),rt(l,"TYPE","xmlhttp"),Sr(o,l),o.m&&o.o&&Ro(l,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=Si(ee(l)),h.m=null,h.P=!0,sl(h,o)}r.Za=function(){this.C!=null&&(this.C=null,bi(this),bo(this),xt(19))};function Ci(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function kl(o,l){var h=null;if(o.g==l){Ci(o),Vo(o),o.g=null;var m=2}else if(Ao(o.h,l))h=l.D,hl(o.h,l),m=1;else return;if(o.G!=0){if(l.o)if(m==1){h=l.m?l.m.length:0,l=Date.now()-l.F;var E=o.B;m=wi(),Ct(m,new el(m,h)),Vi(o)}else xl(o);else if(E=l.s,E==3||E==0&&0<l.X||!(m==1&&Vm(o,l)||m==2&&bo(o)))switch(h&&0<h.length&&(l=o.h,l.i=l.i.concat(h)),E){case 1:ze(o,5);break;case 4:ze(o,10);break;case 3:ze(o,6);break;default:ze(o,2)}}}function Nl(o,l){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*l}function ze(o,l){if(o.j.info("Error code "+l),l==2){var h=_(o.fb,o),m=o.Xa;let E=!m;m=new Be(m||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Ei(m,"https"),Si(m),E?Tm(m.toString(),h):Em(m.toString(),h)}else xt(2);o.G=0,o.l&&o.l.sa(l),Fl(o),bl(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),xt(2)):(this.j.info("Failed to ping google.com"),xt(1))};function Fl(o){if(o.G=0,o.ka=[],o.l){let l=dl(o.h);(l.length!=0||o.i.length!=0)&&(D(o.ka,l),D(o.ka,o.i),o.h.i.length=0,N(o.i),o.i.length=0),o.l.ra()}}function Ol(o,l,h){var m=h instanceof Be?ee(h):new Be(h);if(m.g!="")l&&(m.g=l+"."+m.g),Ai(m,m.s);else{var E=u.location;m=E.protocol,l=l?l+"."+E.hostname:E.hostname,E=+E.port;var P=new Be(null);m&&Ei(P,m),l&&(P.g=l),E&&Ai(P,E),h&&(P.l=h),m=P}return h=o.D,l=o.ya,h&&l&&rt(m,h,l),rt(m,"VER",o.la),Sr(o,m),m}function Ml(o,l,h){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=o.Ca&&!o.pa?new at(new Ir({eb:h})):new at(o.pa),l.Ha(o.J),l}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ll(){}r=Ll.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function xi(){}xi.prototype.g=function(o,l){return new Ot(o,l)};function Ot(o,l){St.call(this),this.g=new Pl(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!j(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!j(l)&&(this.g.D=l,o=this.h,o!==null&&l in o&&(o=this.h,l in o&&delete o[l])),this.j=new _n(this)}k(Ot,St),Ot.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ot.prototype.close=function(){Po(this.g)},Ot.prototype.o=function(o){var l=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=go(o),o=h);l.i.push(new dm(l.Ya++,o)),l.G==3&&Vi(l)},Ot.prototype.N=function(){this.g.l=null,delete this.j,Po(this.g),delete this.g,Ot.aa.N.call(this)};function Ul(o){yo.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){t:{for(let h in l){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,l=l!==null&&o in l?l[o]:void 0),this.data=l}else this.data=o}k(Ul,yo);function ql(){_o.call(this),this.status=1}k(ql,_o);function _n(o){this.g=o}k(_n,Ll),_n.prototype.ua=function(){Ct(this.g,"a")},_n.prototype.ta=function(o){Ct(this.g,new Ul(o))},_n.prototype.sa=function(o){Ct(this.g,new ql)},_n.prototype.ra=function(){Ct(this.g,"b")},xi.prototype.createWebChannel=xi.prototype.g,Ot.prototype.send=Ot.prototype.o,Ot.prototype.open=Ot.prototype.m,Ot.prototype.close=Ot.prototype.close,ea=re.createWebChannelTransport=function(){return new xi},ta=re.getStatEventTarget=function(){return wi()},Zo=re.Event=Ue,zi=re.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},vi.NO_ERROR=0,vi.TIMEOUT=8,vi.HTTP_ERROR=6,Cr=re.ErrorCode=vi,nl.COMPLETE="complete",Xo=re.EventType=nl,Yc.EventType=fr,fr.OPEN="a",fr.CLOSE="b",fr.ERROR="c",fr.MESSAGE="d",St.prototype.listen=St.prototype.K,Tn=re.WebChannel=Yc,Qg=re.FetchXmlHttpFactory=Ir,at.prototype.listenOnce=at.prototype.L,at.prototype.getLastError=at.prototype.Ka,at.prototype.getLastErrorCode=at.prototype.Ba,at.prototype.getStatus=at.prototype.Z,at.prototype.getResponseJson=at.prototype.Oa,at.prototype.getResponseText=at.prototype.oa,at.prototype.send=at.prototype.ea,at.prototype.setWithCredentials=at.prototype.Ha,Yo=re.XhrIo=at}).apply(typeof Bi<"u"?Bi:typeof self<"u"?self:typeof window<"u"?window:{});var uh="@firebase/firestore";var pt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};pt.UNAUTHENTICATED=new pt(null),pt.GOOGLE_CREDENTIALS=new pt("google-credentials-uid"),pt.FIRST_PARTY=new pt("first-party-uid"),pt.MOCK_USER=new pt("mock-user");var er="10.14.0";var Ae=new Xl("@firebase/firestore");function Pn(){return Ae.logLevel}function Mw(r){Ae.setLogLevel(r)}function C(r,...t){if(Ae.logLevel<=$t.DEBUG){let e=t.map(oc);Ae.debug(`Firestore (${er}): ${r}`,...e)}}function ct(r,...t){if(Ae.logLevel<=$t.ERROR){let e=t.map(oc);Ae.error(`Firestore (${er}): ${r}`,...e)}}function oe(r,...t){if(Ae.logLevel<=$t.WARN){let e=t.map(oc);Ae.warn(`Firestore (${er}): ${r}`,...e)}}function oc(r){if(typeof r=="string")return r;try{return function(e){return JSON.stringify(e)}(r)}catch{return r}}function L(r="Unexpected state"){let t=`FIRESTORE (${er}) INTERNAL ASSERTION FAILED: `+r;throw ct(t),new Error(t)}function U(r,t){r||L()}function Lw(r,t){r||L()}function O(r,t){return r}var b={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends Jl{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var wt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var Xi=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},aa=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(pt.UNAUTHENTICATED))}shutdown(){}},ua=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},ca=class{constructor(t){this.t=t,this.currentUser=pt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){U(this.o===void 0);let n=this.i,i=c=>this.i!==n?(n=this.i,e(c)):Promise.resolve(),s=new wt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new wt,t.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let c=s;t.enqueueRetryable(()=>V(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},u=c=>{C("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?u(c):(C("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new wt)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(C("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(U(typeof n.accessToken=="string"),new Xi(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return U(t===null||typeof t=="string"),new pt(t)}},la=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=pt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},ha=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new la(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(pt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},da=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},fa=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){U(this.o===void 0);let n=s=>{s.error!=null&&C("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.R;return this.R=s.token,C("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>n(s))};let i=s=>{C("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):C("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(U(typeof e.token=="string"),this.R=e.token,new da(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function Wg(r){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}var Zi=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";for(;n.length<20;){let i=Wg(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<e&&(n+=t.charAt(i[s]%t.length))}return n}};function G(r,t){return r<t?-1:r>t?1:0}function Mn(r,t,e){return r.length===t.length&&r.every((n,i)=>e(n,t[i]))}function dd(r){return r+"\0"}var lt=class r{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new x(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new x(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new x(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new x(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return r.fromMillis(Date.now())}static fromDate(t){return r.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new r(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?G(this.nanoseconds,t.nanoseconds):G(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var q=class r{constructor(t){this.timestamp=t}static fromTimestamp(t){return new r(t)}static min(){return new r(new lt(0,0))}static max(){return new r(new lt(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var ts=class r{constructor(t,e,n){e===void 0?e=0:e>t.length&&L(),n===void 0?n=t.length-e:n>t.length-e&&L(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return r.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof r?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let n=Math.min(t.length,e.length);for(let i=0;i<n;i++){let s=t.get(i),a=e.get(i);if(s<a)return-1;if(s>a)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},J=class r extends ts{construct(t,e,n){return new r(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let n of t){if(n.indexOf("//")>=0)throw new x(b.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(i=>i.length>0))}return new r(e)}static emptyPath(){return new r([])}},Hg=/^[_a-zA-Z][_a-zA-Z0-9]*$/,vt=class r extends ts{construct(t,e,n){return new r(t,e,n)}static isValidIdentifier(t){return Hg.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new r(["__name__"])}static fromServerFormat(t){let e=[],n="",i=0,s=()=>{if(n.length===0)throw new x(b.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""},a=!1;for(;i<t.length;){let u=t[i];if(u==="\\"){if(i+1===t.length)throw new x(b.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let c=t[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new x(b.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=c,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new x(b.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new r(e)}static emptyPath(){return new r([])}};var M=class r{constructor(t){this.path=t}static fromPath(t){return new r(J.fromString(t))}static fromName(t){return new r(J.fromString(t).popFirst(5))}static empty(){return new r(J.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&J.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return J.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new r(new J(t.slice()))}};var Ln=class{constructor(t,e,n,i){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=i}};function ma(r){return r.fields.find(t=>t.kind===2)}function He(r){return r.fields.filter(t=>t.kind!==2)}Ln.UNKNOWN_ID=-1;var kn=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var zr=class r{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new r(0,qt.min())}};function fd(r,t){let e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=q.fromTimestamp(n===1e9?new lt(e+1,0):new lt(e,n));return new qt(i,M.empty(),t)}function md(r){return new qt(r.readTime,r.key,-1)}var qt=class r{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new r(q.min(),M.empty(),-1)}static max(){return new r(q.max(),M.empty(),-1)}};function ac(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=M.comparator(r.documentKey,t.documentKey),e!==0?e:G(r.largestBatchId,t.largestBatchId))}var gd="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",es=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Oe(r){return V(this,null,function*(){if(r.code!==b.FAILED_PRECONDITION||r.message!==gd)throw r;C("LocalStore","Unexpectedly lost primary lease")})}var R=class r{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(n,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof r?e:r.resolve(e)}catch(e){return r.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):r.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):r.reject(e)}static resolve(t){return new r((e,n)=>{e(t)})}static reject(t){return new r((e,n)=>{n(t)})}static waitFor(t){return new r((e,n)=>{let i=0,s=0,a=!1;t.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&e()},c=>n(c))}),a=!0,s===i&&e()})}static or(t){let e=r.resolve(!1);for(let n of t)e=e.next(i=>i?r.resolve(i):n());return e}static forEach(t,e){let n=[];return t.forEach((i,s)=>{n.push(e.call(this,i,s))}),this.waitFor(n)}static mapArray(t,e){return new r((n,i)=>{let s=t.length,a=new Array(s),u=0;for(let c=0;c<s;c++){let d=c;e(t[d]).next(f=>{a[d]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(t,e){return new r((n,i)=>{let s=()=>{t()===!0?e().next(()=>{s()},i):n()};s()})}};var ns=class r{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new wt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new en(t,e.error)):this.V.resolve()},this.transaction.onerror=n=>{let i=uc(n.target.error);this.V.reject(new en(t,i))}}static open(t,e,n,i){try{return new r(e,t.transaction(i,n))}catch(s){throw new en(e,s)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(C("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new pa(e)}},Se=class r{constructor(t,e,n){this.name=t,this.version=e,this.p=n,r.S(Rr())===12.2&&ct("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return C("SimpleDb","Removing database:",t),Je(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!Hl())return!1;if(r.v())return!0;let t=Rr(),e=r.S(t),n=0<e&&e<10,i=pd(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static v(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.C)==="YES"}static F(t,e){return t.store(e)}static S(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(t){return V(this,null,function*(){return this.db||(C("SimpleDb","Opening database:",this.name),this.db=yield new Promise((e,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let a=s.target.result;e(a)},i.onblocked=()=>{n(new en(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let a=s.target.error;a.name==="VersionError"?n(new x(b.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new x(b.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new en(t,a))},i.onupgradeneeded=s=>{C("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let a=s.target.result;this.p.O(a,i.transaction,s.oldVersion,this.version).next(()=>{C("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db})}L(t){this.N=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,n,i){return V(this,null,function*(){let s=e==="readonly",a=0;for(;;){++a;try{this.db=yield this.M(t);let u=ns.open(this.db,t,s?"readonly":"readwrite",n),c=i(u).next(d=>(u.g(),d)).catch(d=>(u.abort(d),R.reject(d))).toPromise();return c.catch(()=>{}),yield u.m,c}catch(u){let c=u,d=c.name!=="FirebaseError"&&a<3;if(C("SimpleDb","Transaction failed with error:",c.message,"Retrying:",d),this.close(),!d)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function pd(r){let t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var ga=class{constructor(t){this.B=t,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(t){this.B=t}done(){this.k=!0}$(t){this.q=t}delete(){return Je(this.B.delete())}},en=class extends x{constructor(t,e){super(b.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function Me(r){return r.name==="IndexedDbTransactionError"}var pa=class{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(C("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(C("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Je(n)}add(t){return C("SimpleDb","ADD",this.store.name,t,t),Je(this.store.add(t))}get(t){return Je(this.store.get(t)).next(e=>(e===void 0&&(e=null),C("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return C("SimpleDb","DELETE",this.store.name,t),Je(this.store.delete(t))}count(){return C("SimpleDb","COUNT",this.store.name),Je(this.store.count())}U(t,e){let n=this.options(t,e),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new R((a,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{a(c.target.result)}})}{let s=this.cursor(n),a=[];return this.W(s,(u,c)=>{a.push(c)}).next(()=>a)}}G(t,e){let n=this.store.getAll(t,e===null?void 0:e);return new R((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(t,e){C("SimpleDb","DELETE ALL",this.store.name);let n=this.options(t,e);n.H=!1;let i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(t,e){let n;e?n=t:(n={},e=t);let i=this.cursor(n);return this.W(i,e)}Y(t){let e=this.cursor({});return new R((n,i)=>{e.onerror=s=>{let a=uc(s.target.error);i(a)},e.onsuccess=s=>{let a=s.target.result;a?t(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(t,e){let n=[];return new R((i,s)=>{t.onerror=a=>{s(a.target.error)},t.onsuccess=a=>{let u=a.target.result;if(!u)return void i();let c=new ga(u),d=e(u.primaryKey,u.value,c);if(d instanceof R){let f=d.catch(g=>(c.done(),R.reject(g)));n.push(f)}c.isDone?i():c.K===null?u.continue():u.continue(c.K)}}).next(()=>R.waitFor(n))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let n=this.store.index(t.index);return t.H?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function Je(r){return new R((t,e)=>{r.onsuccess=n=>{let i=n.target.result;t(i)},r.onerror=n=>{let i=uc(n.target.error);e(i)}})}var ch=!1;function uc(r){let t=Se.S(Rr());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){let n=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ch||(ch=!0,setTimeout(()=>{throw n},0)),n}}return r}var ya=class{constructor(t,e){this.asyncQueue=t,this.Z=e,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(t){C("IndexBackfiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>V(this,null,function*(){this.task=null;try{C("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(e){Me(e)?C("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):yield Oe(e)}yield this.X(6e4)}))}},_a=class{constructor(t,e){this.localStore=t,this.persistence=e}ee(t=50){return V(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.te(e,t))})}te(t,e){let n=new Set,i=e,s=!0;return R.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(a=>{if(a!==null&&!n.has(a))return C("IndexBackfiller",`Processing collection: ${a}`),this.ne(t,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>e-i)}ne(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(i=>this.localStore.localDocuments.getNextDocuments(t,e,i,n).next(s=>{let a=s.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next(()=>this.re(i,s)).next(u=>(C("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u))).next(()=>a.size)}))}re(t,e){let n=t;return e.changes.forEach((i,s)=>{let a=md(s);ac(a,n)>0&&(n=a)}),new qt(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Mt=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}return r.oe=-1,r})();function li(r){return r==null}function jr(r){return r===0&&1/r==-1/0}function yd(r){return typeof r=="number"&&Number.isInteger(r)&&!jr(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function Dt(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=lh(t)),t=Jg(r.get(e),t);return lh(t)}function Jg(r,t){let e=t,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":e+="";break;case"":e+="";break;default:e+=s}}return e}function lh(r){return r+""}function Kt(r){let t=r.length;if(U(t>=2),t===2)return U(r.charAt(0)===""&&r.charAt(1)===""),J.emptyPath();let e=t-2,n=[],i="";for(let s=0;s<t;){let a=r.indexOf("",s);switch((a<0||a>e)&&L(),r.charAt(a+1)){case"":let u=r.substring(s,a),c;i.length===0?c=u:(i+=u,c=i,i=""),n.push(c);break;case"":i+=r.substring(s,a),i+="\0";break;case"":i+=r.substring(s,a+1);break;default:L()}s=a+2}return new J(n)}var hh=["userId","batchId"];function Qi(r,t){return[r,Dt(t)]}function _d(r,t,e){return[r,Dt(t),e]}var Yg={},Xg=["prefixPath","collectionGroup","readTime","documentId"],Zg=["prefixPath","collectionGroup","documentId"],tp=["collectionGroup","readTime","prefixPath","documentId"],ep=["canonicalId","targetId"],np=["targetId","path"],rp=["path","targetId"],ip=["collectionId","parent"],sp=["indexId","uid"],op=["uid","sequenceNumber"],ap=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],up=["indexId","uid","orderedDocumentKey"],cp=["userId","collectionPath","documentId"],lp=["userId","collectionPath","largestBatchId"],hp=["userId","collectionGroup","largestBatchId"],wd=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],dp=[...wd,"documentOverlays"],vd=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Id=vd,cc=[...Id,"indexConfiguration","indexState","indexEntries"],fp=cc,mp=[...cc,"globals"];var Gr=class extends es{constructor(t,e){super(),this._e=t,this.currentSequenceNumber=e}};function It(r,t){let e=O(r);return Se.F(e._e,t)}function dh(r){let t=0;for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function fn(r,t){for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Td(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}var it=class r{constructor(t,e){this.comparator=t,this.root=e||Wt.EMPTY}insert(t,e){return new r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Wt.BLACK,null,null))}remove(t){return new r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Wt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(t,n.key);if(i===0)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){let t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Dn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Dn(this.root,t,this.comparator,!1)}getReverseIterator(){return new Dn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Dn(this.root,t,this.comparator,!0)}},Dn=class{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},Wt=class r{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new r(t??this.key,e??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this,s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):s===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw L();let t=this.left.check();if(t!==this.right.check())throw L();return t+(this.isRed()?0:1)}};Wt.EMPTY=null,Wt.RED=!0,Wt.BLACK=!1;Wt.EMPTY=new class{constructor(){this.size=0}get key(){throw L()}get value(){throw L()}get color(){throw L()}get left(){throw L()}get right(){throw L()}copy(t,e,n,i,s){return this}insert(t,e,n){return new Wt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var nt=class r{constructor(t){this.comparator=t,this.data=new it(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){let n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new rs(this.data.getIterator())}getIteratorFrom(t){return new rs(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new r(this.comparator);return e.data=t,e}},rs=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function En(r){return r.hasNext()?r.getNext():void 0}var Lt=class r{constructor(t){this.fields=t,t.sort(vt.comparator)}static empty(){return new r([])}unionWith(t){let e=new nt(vt.comparator);for(let n of this.fields)e=e.add(n);for(let n of t)e=e.add(n);return new r(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Mn(this.fields,t.fields,(e,n)=>e.isEqual(n))}};var is=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function qw(){return typeof atob<"u"}var ft=class r{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new is("Invalid base64 string: "+s):s}}(t);return new r(e)}static fromUint8Array(t){let e=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(t);return new r(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return G(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};ft.EMPTY_BYTE_STRING=new ft("");var gp=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ae(r){if(U(!!r),typeof r=="string"){let t=0,e=gp.exec(r);if(U(!!e),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:st(r.seconds),nanos:st(r.nanos)}}function st(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Re(r){return typeof r=="string"?ft.fromBase64String(r):ft.fromUint8Array(r)}function Hs(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function lc(r){let t=r.mapValue.fields.__previous_value__;return Hs(t)?lc(t):t}function $r(r){let t=ae(r.mapValue.fields.__local_write_time__.timestampValue);return new lt(t.seconds,t.nanos)}var wa=class{constructor(t,e,n,i,s,a,u,c,d){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=d}},Un=class r{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new r("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof r&&t.projectId===this.projectId&&t.database===this.database}};var Ee={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Wi={nullValue:"NULL_VALUE"};function nn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?Hs(r)?4:Ed(r)?9007199254740991:Js(r)?10:11:L()}function Yt(r,t){if(r===t)return!0;let e=nn(r);if(e!==nn(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return $r(r).isEqual($r(t));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=ae(i.timestampValue),u=ae(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(i,s){return Re(i.bytesValue).isEqual(Re(s.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(i,s){return st(i.geoPointValue.latitude)===st(s.geoPointValue.latitude)&&st(i.geoPointValue.longitude)===st(s.geoPointValue.longitude)}(r,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return st(i.integerValue)===st(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=st(i.doubleValue),u=st(s.doubleValue);return a===u?jr(a)===jr(u):isNaN(a)&&isNaN(u)}return!1}(r,t);case 9:return Mn(r.arrayValue.values||[],t.arrayValue.values||[],Yt);case 10:case 11:return function(i,s){let a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(dh(a)!==dh(u))return!1;for(let c in a)if(a.hasOwnProperty(c)&&(u[c]===void 0||!Yt(a[c],u[c])))return!1;return!0}(r,t);default:return L()}}function Kr(r,t){return(r.values||[]).find(e=>Yt(e,t))!==void 0}function Pe(r,t){if(r===t)return 0;let e=nn(r),n=nn(t);if(e!==n)return G(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return G(r.booleanValue,t.booleanValue);case 2:return function(s,a){let u=st(s.integerValue||s.doubleValue),c=st(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,t);case 3:return fh(r.timestampValue,t.timestampValue);case 4:return fh($r(r),$r(t));case 5:return G(r.stringValue,t.stringValue);case 6:return function(s,a){let u=Re(s),c=Re(a);return u.compareTo(c)}(r.bytesValue,t.bytesValue);case 7:return function(s,a){let u=s.split("/"),c=a.split("/");for(let d=0;d<u.length&&d<c.length;d++){let f=G(u[d],c[d]);if(f!==0)return f}return G(u.length,c.length)}(r.referenceValue,t.referenceValue);case 8:return function(s,a){let u=G(st(s.latitude),st(a.latitude));return u!==0?u:G(st(s.longitude),st(a.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return mh(r.arrayValue,t.arrayValue);case 10:return function(s,a){var u,c,d,f;let g=s.fields||{},_=a.fields||{},S=(u=g.value)===null||u===void 0?void 0:u.arrayValue,k=(c=_.value)===null||c===void 0?void 0:c.arrayValue,N=G(((d=S?.values)===null||d===void 0?void 0:d.length)||0,((f=k?.values)===null||f===void 0?void 0:f.length)||0);return N!==0?N:mh(S,k)}(r.mapValue,t.mapValue);case 11:return function(s,a){if(s===Ee.mapValue&&a===Ee.mapValue)return 0;if(s===Ee.mapValue)return 1;if(a===Ee.mapValue)return-1;let u=s.fields||{},c=Object.keys(u),d=a.fields||{},f=Object.keys(d);c.sort(),f.sort();for(let g=0;g<c.length&&g<f.length;++g){let _=G(c[g],f[g]);if(_!==0)return _;let S=Pe(u[c[g]],d[f[g]]);if(S!==0)return S}return G(c.length,f.length)}(r.mapValue,t.mapValue);default:throw L()}}function fh(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return G(r,t);let e=ae(r),n=ae(t),i=G(e.seconds,n.seconds);return i!==0?i:G(e.nanos,n.nanos)}function mh(r,t){let e=r.values||[],n=t.values||[];for(let i=0;i<e.length&&i<n.length;++i){let s=Pe(e[i],n[i]);if(s)return s}return G(e.length,n.length)}function qn(r){return va(r)}function va(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){let n=ae(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return Re(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return M.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",i=!0;for(let s of e.values||[])i?i=!1:n+=",",n+=va(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){let n=Object.keys(e.fields||{}).sort(),i="{",s=!0;for(let a of n)s?s=!1:i+=",",i+=`${a}:${va(e.fields[a])}`;return i+"}"}(r.mapValue):L()}function rn(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function Ia(r){return!!r&&"integerValue"in r}function Qr(r){return!!r&&"arrayValue"in r}function gh(r){return!!r&&"nullValue"in r}function ph(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Hi(r){return!!r&&"mapValue"in r}function Js(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="__vector__"}function Mr(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let t={mapValue:{fields:{}}};return fn(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Mr(n)),t}if(r.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Mr(r.arrayValue.values[e]);return t}return Object.assign({},r)}function Ed(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}var Ad={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function pp(r){return"nullValue"in r?Wi:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?rn(Un.empty(),M.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Js(r)?Ad:{mapValue:{}}:L()}function yp(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?rn(Un.empty(),M.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Ad:"mapValue"in r?Js(r)?{mapValue:{}}:Ee:L()}function yh(r,t){let e=Pe(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function _h(r,t){let e=Pe(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}var Vt=class r{constructor(t){this.value=t}static empty(){return new r({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Hi(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Mr(e)}setAll(t){let e=vt.emptyPath(),n={},i=[];t.forEach((a,u)=>{if(!e.isImmediateParentOf(u)){let c=this.getFieldsMap(e);this.applyChanges(c,n,i),n={},i=[],e=u.popLast()}a?n[u.lastSegment()]=Mr(a):i.push(u.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){let e=this.field(t.popLast());Hi(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Yt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];Hi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){fn(e,(i,s)=>t[i]=s);for(let i of n)delete t[i]}clone(){return new r(Mr(this.value))}};function Sd(r){let t=[];return fn(r.fields,(e,n)=>{let i=new vt([e]);if(Hi(n)){let s=Sd(n.mapValue).fields;if(s.length===0)t.push(i);else for(let a of s)t.push(i.child(a))}else t.push(i)}),new Lt(t)}var yt=class r{constructor(t,e,n,i,s,a,u){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(t){return new r(t,0,q.min(),q.min(),q.min(),Vt.empty(),0)}static newFoundDocument(t,e,n,i){return new r(t,1,e,q.min(),n,i,0)}static newNoDocument(t,e){return new r(t,2,e,q.min(),q.min(),Vt.empty(),0)}static newUnknownDocument(t,e){return new r(t,3,e,q.min(),q.min(),Vt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Vt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Vt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=q.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Xt=class{constructor(t,e){this.position=t,this.inclusive=e}};function wh(r,t,e){let n=0;for(let i=0;i<r.position.length;i++){let s=t[i],a=r.position[i];if(s.field.isKeyField()?n=M.comparator(M.fromName(a.referenceValue),e.key):n=Pe(a,e.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function vh(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!Yt(r.position[e],t.position[e]))return!1;return!0}var sn=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function _p(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}var ss=class{},Q=class r extends ss{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new Aa(t,e,n):e==="array-contains"?new Pa(t,n):e==="in"?new os(t,n):e==="not-in"?new ba(t,n):e==="array-contains-any"?new Va(t,n):new r(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new Sa(t,n):new Ra(t,n)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(Pe(e,this.value)):e!==null&&nn(this.value)===nn(e)&&this.matchesComparison(Pe(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return L()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},tt=class r extends ss{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new r(t,e)}matches(t){return Bn(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function Bn(r){return r.op==="and"}function Ta(r){return r.op==="or"}function hc(r){return Rd(r)&&Bn(r)}function Rd(r){for(let t of r.filters)if(t instanceof tt)return!1;return!0}function Ea(r){if(r instanceof Q)return r.field.canonicalString()+r.op.toString()+qn(r.value);if(hc(r))return r.filters.map(t=>Ea(t)).join(",");{let t=r.filters.map(e=>Ea(e)).join(",");return`${r.op}(${t})`}}function Pd(r,t){return r instanceof Q?function(n,i){return i instanceof Q&&n.op===i.op&&n.field.isEqual(i.field)&&Yt(n.value,i.value)}(r,t):r instanceof tt?function(n,i){return i instanceof tt&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,a,u)=>s&&Pd(a,i.filters[u]),!0):!1}(r,t):void L()}function bd(r,t){let e=r.filters.concat(t);return tt.create(e,r.op)}function Vd(r){return r instanceof Q?function(e){return`${e.field.canonicalString()} ${e.op} ${qn(e.value)}`}(r):r instanceof tt?function(e){return e.op.toString()+" {"+e.getFilters().map(Vd).join(" ,")+"}"}(r):"Filter"}var Aa=class extends Q{constructor(t,e,n){super(t,e,n),this.key=M.fromName(n.referenceValue)}matches(t){let e=M.comparator(t.key,this.key);return this.matchesComparison(e)}},Sa=class extends Q{constructor(t,e){super(t,"in",e),this.keys=Cd("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Ra=class extends Q{constructor(t,e){super(t,"not-in",e),this.keys=Cd("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Cd(r,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(n=>M.fromName(n.referenceValue))}var Pa=class extends Q{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return Qr(e)&&Kr(e.arrayValue,this.value)}},os=class extends Q{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&Kr(this.value.arrayValue,e)}},ba=class extends Q{constructor(t,e){super(t,"not-in",e)}matches(t){if(Kr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!Kr(this.value.arrayValue,e)}},Va=class extends Q{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!Qr(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>Kr(this.value.arrayValue,n))}};var Ca=class{constructor(t,e=null,n=[],i=[],s=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}};function xa(r,t=null,e=[],n=[],i=null,s=null,a=null){return new Ca(r,t,e,n,i,s,a)}function on(r){let t=O(r);if(t.ue===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>Ea(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),li(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>qn(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>qn(n)).join(",")),t.ue=e}return t.ue}function hi(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!_p(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!Pd(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!vh(r.startAt,t.startAt)&&vh(r.endAt,t.endAt)}function as(r){return M.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function us(r,t){return r.filters.filter(e=>e instanceof Q&&e.field.isEqual(t))}function Ih(r,t,e){let n=Wi,i=!0;for(let s of us(r,t)){let a=Wi,u=!0;switch(s.op){case"<":case"<=":a=pp(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=Wi}yh({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];yh({value:n,inclusive:i},{value:a,inclusive:e.inclusive})<0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}function Th(r,t,e){let n=Ee,i=!0;for(let s of us(r,t)){let a=Ee,u=!0;switch(s.op){case">=":case">":a=yp(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=Ee}_h({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];_h({value:n,inclusive:i},{value:a,inclusive:e.inclusive})>0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}var jt=class{constructor(t,e=null,n=[],i=[],s=null,a="F",u=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function xd(r,t,e,n,i,s,a,u){return new jt(r,t,e,n,i,s,a,u)}function nr(r){return new jt(r)}function Eh(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function dc(r){return r.collectionGroup!==null}function Nn(r){let t=O(r);if(t.ce===null){t.ce=[];let e=new Set;for(let s of t.explicitOrderBy)t.ce.push(s),e.add(s.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new nt(vt.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.ce.push(new sn(s,n))}),e.has(vt.keyField().canonicalString())||t.ce.push(new sn(vt.keyField(),n))}return t.ce}function kt(r){let t=O(r);return t.le||(t.le=wp(t,Nn(r))),t.le}function wp(r,t){if(r.limitType==="F")return xa(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new sn(i.field,s)});let e=r.endAt?new Xt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Xt(r.startAt.position,r.startAt.inclusive):null;return xa(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function Da(r,t){let e=r.filters.concat([t]);return new jt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function cs(r,t,e){return new jt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function di(r,t){return hi(kt(r),kt(t))&&r.limitType===t.limitType}function Dd(r){return`${on(kt(r))}|lt:${r.limitType}`}function bn(r){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(i=>Vd(i)).join(", ")}]`),li(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(i=>qn(i)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(i=>qn(i)).join(",")),`Target(${n})`}(kt(r))}; limitType=${r.limitType})`}function fi(r,t){return t.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):M.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,t)&&function(n,i){for(let s of Nn(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,t)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,t)&&function(n,i){return!(n.startAt&&!function(a,u,c){let d=wh(a,u,c);return a.inclusive?d<=0:d<0}(n.startAt,Nn(n),i)||n.endAt&&!function(a,u,c){let d=wh(a,u,c);return a.inclusive?d>=0:d>0}(n.endAt,Nn(n),i))}(r,t)}function kd(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Nd(r){return(t,e)=>{let n=!1;for(let i of Nn(r)){let s=vp(i,t,e);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function vp(r,t,e){let n=r.field.isKeyField()?M.comparator(t.key,e.key):function(s,a,u){let c=a.data.field(s),d=u.data.field(s);return c!==null&&d!==null?Pe(c,d):L()}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return L()}}var Zt=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let n=this.mapKeyFn(t),i=this.inner[n];if(i===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return n.length===1?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){fn(this.inner,(e,n)=>{for(let[i,s]of n)t(i,s)})}isEmpty(){return Td(this.inner)}size(){return this.innerSize}};var Ip=new it(M.comparator);function Ft(){return Ip}var Fd=new it(M.comparator);function Fr(...r){let t=Fd;for(let e of r)t=t.insert(e.key,e);return t}function Od(r){let t=Fd;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Qt(){return Lr()}function Md(){return Lr()}function Lr(){return new Zt(r=>r.toString(),(r,t)=>r.isEqual(t))}var Tp=new it(M.comparator),Ep=new nt(M.comparator);function $(...r){let t=Ep;for(let e of r)t=t.add(e);return t}var Ap=new nt(G);function fc(){return Ap}function mc(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:jr(t)?"-0":t}}function Ld(r){return{integerValue:""+r}}function Ud(r,t){return yd(t)?Ld(t):mc(r,t)}var zn=class{constructor(){this._=void 0}};function Sp(r,t,e){return r instanceof be?function(i,s){let a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Hs(s)&&(s=lc(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(e,t):r instanceof ue?Bd(r,t):r instanceof ce?zd(r,t):function(i,s){let a=qd(i,s),u=Ah(a)+Ah(i.Pe);return Ia(a)&&Ia(i.Pe)?Ld(u):mc(i.serializer,u)}(r,t)}function Rp(r,t,e){return r instanceof ue?Bd(r,t):r instanceof ce?zd(r,t):e}function qd(r,t){return r instanceof Ve?function(n){return Ia(n)||function(s){return!!s&&"doubleValue"in s}(n)}(t)?t:{integerValue:0}:null}var be=class extends zn{},ue=class extends zn{constructor(t){super(),this.elements=t}};function Bd(r,t){let e=jd(t);for(let n of r.elements)e.some(i=>Yt(i,n))||e.push(n);return{arrayValue:{values:e}}}var ce=class extends zn{constructor(t){super(),this.elements=t}};function zd(r,t){let e=jd(t);for(let n of r.elements)e=e.filter(i=>!Yt(i,n));return{arrayValue:{values:e}}}var Ve=class extends zn{constructor(t,e){super(),this.serializer=t,this.Pe=e}};function Ah(r){return st(r.integerValue||r.doubleValue)}function jd(r){return Qr(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var an=class{constructor(t,e){this.field=t,this.transform=e}};function Pp(r,t){return r.field.isEqual(t.field)&&function(n,i){return n instanceof ue&&i instanceof ue||n instanceof ce&&i instanceof ce?Mn(n.elements,i.elements,Yt):n instanceof Ve&&i instanceof Ve?Yt(n.Pe,i.Pe):n instanceof be&&i instanceof be}(r.transform,t.transform)}var ka=class{constructor(t,e){this.version=t,this.transformResults=e}},ut=class r{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new r}static exists(t){return new r(void 0,t)}static updateTime(t){return new r(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function Ji(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}var jn=class{};function Gd(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new xe(r.key,ut.none()):new Ce(r.key,r.data,ut.none());{let e=r.data,n=Vt.empty(),i=new nt(vt.comparator);for(let s of t.fields)if(!i.has(s)){let a=e.field(s);a===null&&s.length>1&&(s=s.popLast(),a=e.field(s)),a===null?n.delete(s):n.set(s,a),i=i.add(s)}return new Gt(r.key,n,new Lt(i.toArray()),ut.none())}}function bp(r,t,e){r instanceof Ce?function(i,s,a){let u=i.value.clone(),c=Rh(i.fieldTransforms,s,a.transformResults);u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,t,e):r instanceof Gt?function(i,s,a){if(!Ji(i.precondition,s))return void s.convertToUnknownDocument(a.version);let u=Rh(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll($d(i)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,t,e):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function Ur(r,t,e,n){return r instanceof Ce?function(s,a,u,c){if(!Ji(s.precondition,a))return u;let d=s.value.clone(),f=Ph(s.fieldTransforms,c,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,t,e,n):r instanceof Gt?function(s,a,u,c){if(!Ji(s.precondition,a))return u;let d=Ph(s.fieldTransforms,c,a),f=a.data;return f.setAll($d(s)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,t,e,n):function(s,a,u){return Ji(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(r,t,e)}function Vp(r,t){let e=null;for(let n of r.fieldTransforms){let i=t.data.field(n.field),s=qd(n.transform,i||null);s!=null&&(e===null&&(e=Vt.empty()),e.set(n.field,s))}return e||null}function Sh(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&Mn(n,i,(s,a)=>Pp(s,a))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}var Ce=class extends jn{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Gt=class extends jn{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function $d(r){let t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let n=r.data.field(e);t.set(e,n)}}),t}function Rh(r,t,e){let n=new Map;U(r.length===e.length);for(let i=0;i<e.length;i++){let s=r[i],a=s.transform,u=t.data.field(s.field);n.set(s.field,Rp(a,u,e[i]))}return n}function Ph(r,t,e){let n=new Map;for(let i of r){let s=i.transform,a=e.data.field(i.field);n.set(i.field,Sp(s,a,t))}return n}var xe=class extends jn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Wr=class extends jn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Hr=class{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){let n=e.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&bp(s,t,n[i])}}applyToLocalView(t,e){for(let n of this.baseMutations)n.key.isEqual(t.key)&&(e=Ur(n,t,e,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(t.key)&&(e=Ur(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let n=Md();return this.mutations.forEach(i=>{let s=t.get(i.key),a=s.overlayedDocument,u=this.applyToLocalView(a,s.mutatedFields);u=e.has(i.key)?null:u;let c=Gd(a,u);c!==null&&n.set(i.key,c),a.isValidDocument()||a.convertToNoDocument(q.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),$())}isEqual(t){return this.batchId===t.batchId&&Mn(this.mutations,t.mutations,(e,n)=>Sh(e,n))&&Mn(this.baseMutations,t.baseMutations,(e,n)=>Sh(e,n))}},Na=class r{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){U(t.mutations.length===n.length);let i=function(){return Tp}(),s=t.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new r(t,e,n,i)}};var Jr=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Fa=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var mt,H;function Kd(r){switch(r){default:return L();case b.CANCELLED:case b.UNKNOWN:case b.DEADLINE_EXCEEDED:case b.RESOURCE_EXHAUSTED:case b.INTERNAL:case b.UNAVAILABLE:case b.UNAUTHENTICATED:return!1;case b.INVALID_ARGUMENT:case b.NOT_FOUND:case b.ALREADY_EXISTS:case b.PERMISSION_DENIED:case b.FAILED_PRECONDITION:case b.ABORTED:case b.OUT_OF_RANGE:case b.UNIMPLEMENTED:case b.DATA_LOSS:return!0}}function Qd(r){if(r===void 0)return ct("GRPC error has no .code"),b.UNKNOWN;switch(r){case mt.OK:return b.OK;case mt.CANCELLED:return b.CANCELLED;case mt.UNKNOWN:return b.UNKNOWN;case mt.DEADLINE_EXCEEDED:return b.DEADLINE_EXCEEDED;case mt.RESOURCE_EXHAUSTED:return b.RESOURCE_EXHAUSTED;case mt.INTERNAL:return b.INTERNAL;case mt.UNAVAILABLE:return b.UNAVAILABLE;case mt.UNAUTHENTICATED:return b.UNAUTHENTICATED;case mt.INVALID_ARGUMENT:return b.INVALID_ARGUMENT;case mt.NOT_FOUND:return b.NOT_FOUND;case mt.ALREADY_EXISTS:return b.ALREADY_EXISTS;case mt.PERMISSION_DENIED:return b.PERMISSION_DENIED;case mt.FAILED_PRECONDITION:return b.FAILED_PRECONDITION;case mt.ABORTED:return b.ABORTED;case mt.OUT_OF_RANGE:return b.OUT_OF_RANGE;case mt.UNIMPLEMENTED:return b.UNIMPLEMENTED;case mt.DATA_LOSS:return b.DATA_LOSS;default:return L()}}(H=mt||(mt={}))[H.OK=0]="OK",H[H.CANCELLED=1]="CANCELLED",H[H.UNKNOWN=2]="UNKNOWN",H[H.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",H[H.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",H[H.NOT_FOUND=5]="NOT_FOUND",H[H.ALREADY_EXISTS=6]="ALREADY_EXISTS",H[H.PERMISSION_DENIED=7]="PERMISSION_DENIED",H[H.UNAUTHENTICATED=16]="UNAUTHENTICATED",H[H.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",H[H.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",H[H.ABORTED=10]="ABORTED",H[H.OUT_OF_RANGE=11]="OUT_OF_RANGE",H[H.UNIMPLEMENTED=12]="UNIMPLEMENTED",H[H.INTERNAL=13]="INTERNAL",H[H.UNAVAILABLE=14]="UNAVAILABLE",H[H.DATA_LOSS=15]="DATA_LOSS";var bh=null;function Wd(){return new TextEncoder}var Cp=new _e([4294967295,4294967295],0);function Vh(r){let t=Wd().encode(r),e=new Jo;return e.update(t),new Uint8Array(e.digest())}function Ch(r){let t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new _e([e,n],0),new _e([i,s],0)]}var Oa=class r{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new tn(`Invalid padding: ${e}`);if(n<0)throw new tn(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new tn(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new tn(`Invalid padding when bitmap length is 0: ${e}`);this.Ie=8*t.length-e,this.Te=_e.fromNumber(this.Ie)}Ee(t,e,n){let i=t.add(e.multiply(_e.fromNumber(n)));return i.compare(Cp)===1&&(i=new _e([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Ie===0)return!1;let e=Vh(t),[n,i]=Ch(e);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(t,e,n){let i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),a=new r(s,i,e);return n.forEach(u=>a.insert(u)),a}insert(t){if(this.Ie===0)return;let e=Vh(t),[n,i]=Ch(e);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);this.Ae(a)}}Ae(t){let e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}},tn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Yr=class r{constructor(t,e,n,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){let i=new Map;return i.set(t,Xr.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new r(q.min(),i,new it(G),Ft(),$())}},Xr=class r{constructor(t,e,n,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new r(n,e,$(),$(),$())}};var Fn=class{constructor(t,e,n,i){this.Re=t,this.removedTargetIds=e,this.key=n,this.Ve=i}},ls=class{constructor(t,e){this.targetId=t,this.me=e}},hs=class{constructor(t,e,n=ft.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}},ds=class{constructor(){this.fe=0,this.ge=Dh(),this.pe=ft.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=$(),e=$(),n=$();return this.ge.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:L()}}),new Xr(this.pe,this.ye,t,e,n)}Ce(){this.we=!1,this.ge=Dh()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,U(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Ma=class{constructor(t){this.Le=t,this.Be=new Map,this.ke=Ft(),this.qe=xh(),this.Qe=new it(G)}Ke(t){for(let e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(e,t.Ve):this.Ue(e,t.key,t.Ve);for(let e of t.removedTargetIds)this.Ue(e,t.key,t.Ve)}We(t){this.forEachTarget(t,e=>{let n=this.Ge(e);switch(t.state){case 0:this.ze(e)&&n.De(t.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(t.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(e);break;case 3:this.ze(e)&&(n.Ne(),n.De(t.resumeToken));break;case 4:this.ze(e)&&(this.je(e),n.De(t.resumeToken));break;default:L()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach((n,i)=>{this.ze(i)&&e(i)})}He(t){let e=t.targetId,n=t.me.count,i=this.Je(e);if(i){let s=i.target;if(as(s))if(n===0){let a=new M(s.path);this.Ue(e,a,yt.newNoDocument(a,q.min()))}else U(n===1);else{let a=this.Ye(e);if(a!==n){let u=this.Ze(t),c=u?this.Xe(u,t,a):1;if(c!==0){this.je(e);let d=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,d)}bh?.et(function(f,g,_,S,k){var N,D,z,j,B,W;let Z={localCacheCount:f,existenceFilterCount:g.count,databaseId:_.database,projectId:_.projectId},K=g.unchangedNames;return K&&(Z.bloomFilter={applied:k===0,hashCount:(N=K?.hashCount)!==null&&N!==void 0?N:0,bitmapLength:(j=(z=(D=K?.bits)===null||D===void 0?void 0:D.bitmap)===null||z===void 0?void 0:z.length)!==null&&j!==void 0?j:0,padding:(W=(B=K?.bits)===null||B===void 0?void 0:B.padding)!==null&&W!==void 0?W:0,mightContain:v=>{var p;return(p=S?.mightContain(v))!==null&&p!==void 0&&p}}),Z}(a,t.me,this.Le.tt(),u,c))}}}}Ze(t){let e=t.me.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=e,a,u;try{a=Re(n).toUint8Array()}catch(c){if(c instanceof is)return oe("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new Oa(a,i,s)}catch(c){return oe(c instanceof tn?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.Ie===0?null:u}Xe(t,e,n){return e.me.count===n-this.nt(t,e.targetId)?0:2}nt(t,e){let n=this.Le.getRemoteKeysForTarget(e),i=0;return n.forEach(s=>{let a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;t.mightContain(u)||(this.Ue(e,s,null),i++)}),i}rt(t){let e=new Map;this.Be.forEach((s,a)=>{let u=this.Je(a);if(u){if(s.current&&as(u.target)){let c=new M(u.target.path);this.ke.get(c)!==null||this.it(a,c)||this.Ue(a,c,yt.newNoDocument(c,t))}s.be&&(e.set(a,s.ve()),s.Ce())}});let n=$();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(c=>{let d=this.Je(c);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(t));let i=new Yr(t,e,this.Qe,this.ke,n);return this.ke=Ft(),this.qe=xh(),this.Qe=new it(G),i}$e(t,e){if(!this.ze(t))return;let n=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,n),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}Ue(t,e,n){if(!this.ze(t))return;let i=this.Ge(t);this.it(t,e)?i.Fe(e,1):i.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),n&&(this.ke=this.ke.insert(e,n))}removeTarget(t){this.Be.delete(t)}Ye(t){let e=this.Ge(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let e=this.Be.get(t);return e||(e=new ds,this.Be.set(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new nt(G),this.qe=this.qe.insert(t,e)),e}ze(t){let e=this.Je(t)!==null;return e||C("WatchChangeAggregator","Detected inactive target",t),e}Je(t){let e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new ds),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.Ue(t,e,null)})}it(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}};function xh(){return new it(M.comparator)}function Dh(){return new it(M.comparator)}var xp={asc:"ASCENDING",desc:"DESCENDING"},Dp={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},kp={and:"AND",or:"OR"},La=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function Ua(r,t){return r.useProto3Json||li(t)?t:{value:t}}function Gn(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Hd(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function Np(r,t){return Gn(r,t.toTimestamp())}function ht(r){return U(!!r),q.fromTimestamp(function(e){let n=ae(e);return new lt(n.seconds,n.nanos)}(r))}function gc(r,t){return qa(r,t).canonicalString()}function qa(r,t){let e=function(i){return new J(["projects",i.projectId,"databases",i.database])}(r).child("documents");return t===void 0?e:e.child(t)}function Jd(r){let t=J.fromString(r);return U(af(t)),t}function Zr(r,t){return gc(r.databaseId,t.path)}function Ht(r,t){let e=Jd(t);if(e.get(1)!==r.databaseId.projectId)throw new x(b.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new x(b.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new M(Zd(e))}function Yd(r,t){return gc(r.databaseId,t)}function Xd(r){let t=Jd(r);return t.length===4?J.emptyPath():Zd(t)}function Ba(r){return new J(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Zd(r){return U(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function kh(r,t,e){return{name:Zr(r,t),fields:e.value.mapValue.fields}}function tf(r,t,e){let n=Ht(r,t.name),i=ht(t.updateTime),s=t.createTime?ht(t.createTime):q.min(),a=new Vt({mapValue:{fields:t.fields}}),u=yt.newFoundDocument(n,i,s,a);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function Fp(r,t){return"found"in t?function(n,i){U(!!i.found),i.found.name,i.found.updateTime;let s=Ht(n,i.found.name),a=ht(i.found.updateTime),u=i.found.createTime?ht(i.found.createTime):q.min(),c=new Vt({mapValue:{fields:i.found.fields}});return yt.newFoundDocument(s,a,u,c)}(r,t):"missing"in t?function(n,i){U(!!i.missing),U(!!i.readTime);let s=Ht(n,i.missing),a=ht(i.readTime);return yt.newNoDocument(s,a)}(r,t):L()}function Op(r,t){let e;if("targetChange"in t){t.targetChange;let n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:L()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(d,f){return d.useProto3Json?(U(f===void 0||typeof f=="string"),ft.fromBase64String(f||"")):(U(f===void 0||f instanceof Buffer||f instanceof Uint8Array),ft.fromUint8Array(f||new Uint8Array))}(r,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&function(d){let f=d.code===void 0?b.UNKNOWN:Qd(d.code);return new x(f,d.message||"")}(a);e=new hs(n,i,s,u||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=Ht(r,n.document.name),s=ht(n.document.updateTime),a=n.document.createTime?ht(n.document.createTime):q.min(),u=new Vt({mapValue:{fields:n.document.fields}}),c=yt.newFoundDocument(i,s,a,u),d=n.targetIds||[],f=n.removedTargetIds||[];e=new Fn(d,f,c.key,c)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=Ht(r,n.document),s=n.readTime?ht(n.readTime):q.min(),a=yt.newNoDocument(i,s),u=n.removedTargetIds||[];e=new Fn([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=Ht(r,n.document),s=n.removedTargetIds||[];e=new Fn([],s,i,null)}else{if(!("filter"in t))return L();{t.filter;let n=t.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,a=new Fa(i,s),u=n.targetId;e=new ls(u,a)}}return e}function ti(r,t){let e;if(t instanceof Ce)e={update:kh(r,t.key,t.value)};else if(t instanceof xe)e={delete:Zr(r,t.key)};else if(t instanceof Gt)e={update:kh(r,t.key,t.data),updateMask:zp(t.fieldMask)};else{if(!(t instanceof Wr))return L();e={verify:Zr(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(s,a){let u=a.transform;if(u instanceof be)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof ue)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof ce)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Ve)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw L()}(0,n))),t.precondition.isNone||(e.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:Np(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:L()}(r,t.precondition)),e}function za(r,t){let e=t.currentDocument?function(s){return s.updateTime!==void 0?ut.updateTime(ht(s.updateTime)):s.exists!==void 0?ut.exists(s.exists):ut.none()}(t.currentDocument):ut.none(),n=t.updateTransforms?t.updateTransforms.map(i=>function(a,u){let c=null;if("setToServerValue"in u)U(u.setToServerValue==="REQUEST_TIME"),c=new be;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];c=new ue(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];c=new ce(f)}else"increment"in u?c=new Ve(a,u.increment):L();let d=vt.fromServerFormat(u.fieldPath);return new an(d,c)}(r,i)):[];if(t.update){t.update.name;let i=Ht(r,t.update.name),s=new Vt({mapValue:{fields:t.update.fields}});if(t.updateMask){let a=function(c){let d=c.fieldPaths||[];return new Lt(d.map(f=>vt.fromServerFormat(f)))}(t.updateMask);return new Gt(i,s,a,e,n)}return new Ce(i,s,e,n)}if(t.delete){let i=Ht(r,t.delete);return new xe(i,e)}if(t.verify){let i=Ht(r,t.verify);return new Wr(i,e)}return L()}function Mp(r,t){return r&&r.length>0?(U(t!==void 0),r.map(e=>function(i,s){let a=i.updateTime?ht(i.updateTime):ht(s);return a.isEqual(q.min())&&(a=ht(s)),new ka(a,i.transformResults||[])}(e,t))):[]}function ef(r,t){return{documents:[Yd(r,t.path)]}}function nf(r,t){let e={structuredQuery:{}},n=t.path,i;t.collectionGroup!==null?(i=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=Yd(r,i);let s=function(d){if(d.length!==0)return of(tt.create(d,"and"))}(t.filters);s&&(e.structuredQuery.where=s);let a=function(d){if(d.length!==0)return d.map(f=>function(_){return{field:Vn(_.field),direction:Up(_.dir)}}(f))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);let u=Ua(r,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(t.endAt)),{_t:e,parent:i}}function rf(r){let t=Xd(r.parent),e=r.structuredQuery,n=e.from?e.from.length:0,i=null;if(n>0){U(n===1);let f=e.from[0];f.allDescendants?i=f.collectionId:t=t.child(f.collectionId)}let s=[];e.where&&(s=function(g){let _=sf(g);return _ instanceof tt&&hc(_)?_.getFilters():[_]}(e.where));let a=[];e.orderBy&&(a=function(g){return g.map(_=>function(k){return new sn(Cn(k.field),function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(k.direction))}(_))}(e.orderBy));let u=null;e.limit&&(u=function(g){let _;return _=typeof g=="object"?g.value:g,li(_)?null:_}(e.limit));let c=null;e.startAt&&(c=function(g){let _=!!g.before,S=g.values||[];return new Xt(S,_)}(e.startAt));let d=null;return e.endAt&&(d=function(g){let _=!g.before,S=g.values||[];return new Xt(S,_)}(e.endAt)),xd(t,i,a,s,u,"F",c,d)}function Lp(r,t){let e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function sf(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let n=Cn(e.unaryFilter.field);return Q.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=Cn(e.unaryFilter.field);return Q.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Cn(e.unaryFilter.field);return Q.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Cn(e.unaryFilter.field);return Q.create(a,"!=",{nullValue:"NULL_VALUE"});default:return L()}}(r):r.fieldFilter!==void 0?function(e){return Q.create(Cn(e.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return L()}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return tt.create(e.compositeFilter.filters.map(n=>sf(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return L()}}(e.compositeFilter.op))}(r):L()}function Up(r){return xp[r]}function qp(r){return Dp[r]}function Bp(r){return kp[r]}function Vn(r){return{fieldPath:r.canonicalString()}}function Cn(r){return vt.fromServerFormat(r.fieldPath)}function of(r){return r instanceof Q?function(e){if(e.op==="=="){if(ph(e.value))return{unaryFilter:{field:Vn(e.field),op:"IS_NAN"}};if(gh(e.value))return{unaryFilter:{field:Vn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(ph(e.value))return{unaryFilter:{field:Vn(e.field),op:"IS_NOT_NAN"}};if(gh(e.value))return{unaryFilter:{field:Vn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Vn(e.field),op:qp(e.op),value:e.value}}}(r):r instanceof tt?function(e){let n=e.getFilters().map(i=>of(i));return n.length===1?n[0]:{compositeFilter:{op:Bp(e.op),filters:n}}}(r):L()}function zp(r){let t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function af(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var $n=class r{constructor(t,e,n,i,s=q.min(),a=q.min(),u=ft.EMPTY_BYTE_STRING,c=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(t){return new r(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var fs=class{constructor(t){this.ct=t}};function jp(r,t){let e;if(t.document)e=tf(r.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let n=M.fromSegments(t.noDocument.path),i=cn(t.noDocument.readTime);e=yt.newNoDocument(n,i),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return L();{let n=M.fromSegments(t.unknownDocument.path),i=cn(t.unknownDocument.version);e=yt.newUnknownDocument(n,i)}}return t.readTime&&e.setReadTime(function(i){let s=new lt(i[0],i[1]);return q.fromTimestamp(s)}(t.readTime)),e}function Nh(r,t){let e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:ms(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=function(s,a){return{name:Zr(s,a.key),fields:a.data.value.mapValue.fields,updateTime:Gn(s,a.version.toTimestamp()),createTime:Gn(s,a.createTime.toTimestamp())}}(r.ct,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:un(t.version)};else{if(!t.isUnknownDocument())return L();n.unknownDocument={path:e.path.toArray(),version:un(t.version)}}return n}function ms(r){let t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function un(r){let t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function cn(r){let t=new lt(r.seconds,r.nanoseconds);return q.fromTimestamp(t)}function Ye(r,t){let e=(t.baseMutations||[]).map(s=>za(r.ct,s));for(let s=0;s<t.mutations.length-1;++s){let a=t.mutations[s];if(s+1<t.mutations.length&&t.mutations[s+1].transform!==void 0){let u=t.mutations[s+1];a.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}let n=t.mutations.map(s=>za(r.ct,s)),i=lt.fromMillis(t.localWriteTimeMs);return new Hr(t.batchId,i,e,n)}function Or(r){let t=cn(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?cn(r.lastLimboFreeSnapshotVersion):q.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){return U(s.documents.length===1),kt(nr(Xd(s.documents[0])))}(r.query):function(s){return kt(rf(s))}(r.query),new $n(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,ft.fromBase64String(r.resumeToken))}function uf(r,t){let e=un(t.snapshotVersion),n=un(t.lastLimboFreeSnapshotVersion),i;i=as(t.target)?ef(r.ct,t.target):nf(r.ct,t.target)._t;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:on(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function pc(r){let t=rf({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?cs(t,t.limit,"L"):t}function na(r,t){return new Jr(t.largestBatchId,za(r.ct,t.overlayMutation))}function Fh(r,t){let e=t.path.lastSegment();return[r,Dt(t.path.popLast()),e]}function Oh(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:un(n.readTime),documentKey:Dt(n.documentKey.path),largestBatchId:n.largestBatchId}}var ja=class{getBundleMetadata(t,e){return Mh(t).get(e).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:cn(s.createTime),version:s.version}}(n)})}saveBundleMetadata(t,e){return Mh(t).put(function(i){return{bundleId:i.id,createTime:un(ht(i.createTime)),version:i.version}}(e))}getNamedQuery(t,e){return Lh(t).get(e).next(n=>{if(n)return function(s){return{name:s.name,query:pc(s.bundledQuery),readTime:cn(s.readTime)}}(n)})}saveNamedQuery(t,e){return Lh(t).put(function(i){return{name:i.name,readTime:un(ht(i.readTime)),bundledQuery:i.bundledQuery}}(e))}};function Mh(r){return It(r,"bundles")}function Lh(r){return It(r,"namedQueries")}var gs=class r{constructor(t,e){this.serializer=t,this.userId=e}static lt(t,e){let n=e.uid||"";return new r(t,n)}getOverlay(t,e){return xr(t).get(Fh(this.userId,e)).next(n=>n?na(this.serializer,n):null)}getOverlays(t,e){let n=Qt();return R.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){let i=[];return n.forEach((s,a)=>{let u=new Jr(e,a);i.push(this.ht(t,u))}),R.waitFor(i)}removeOverlaysForBatchId(t,e,n){let i=new Set;e.forEach(a=>i.add(Dt(a.getCollectionPath())));let s=[];return i.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(xr(t).j("collectionPathOverlayIndex",u))}),R.waitFor(s)}getOverlaysForCollection(t,e,n){let i=Qt(),s=Dt(e),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return xr(t).U("collectionPathOverlayIndex",a).next(u=>{for(let c of u){let d=na(this.serializer,c);i.set(d.getKey(),d)}return i})}getOverlaysForCollectionGroup(t,e,n,i){let s=Qt(),a,u=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return xr(t).J({index:"collectionGroupOverlayIndex",range:u},(c,d,f)=>{let g=na(this.serializer,d);s.size()<i||g.largestBatchId===a?(s.set(g.getKey(),g),a=g.largestBatchId):f.done()}).next(()=>s)}ht(t,e){return xr(t).put(function(i,s,a){let[u,c,d]=Fh(s,a.mutation.key);return{userId:s,collectionPath:c,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:ti(i.ct,a.mutation)}}(this.serializer,this.userId,e))}};function xr(r){return It(r,"documentOverlays")}var Ga=class{Pt(t){return It(t,"globals")}getSessionToken(t){return this.Pt(t).get("sessionToken").next(e=>{let n=e?.value;return n?ft.fromUint8Array(n):ft.EMPTY_BYTE_STRING})}setSessionToken(t,e){return this.Pt(t).put({name:"sessionToken",value:e.toUint8Array()})}};var ie=class{constructor(){}It(t,e){this.Tt(t,e),e.Et()}Tt(t,e){if("nullValue"in t)this.dt(e,5);else if("booleanValue"in t)this.dt(e,10),e.At(t.booleanValue?1:0);else if("integerValue"in t)this.dt(e,15),e.At(st(t.integerValue));else if("doubleValue"in t){let n=st(t.doubleValue);isNaN(n)?this.dt(e,13):(this.dt(e,15),jr(n)?e.At(0):e.At(n))}else if("timestampValue"in t){let n=t.timestampValue;this.dt(e,20),typeof n=="string"&&(n=ae(n)),e.Rt(`${n.seconds||""}`),e.At(n.nanos||0)}else if("stringValue"in t)this.Vt(t.stringValue,e),this.ft(e);else if("bytesValue"in t)this.dt(e,30),e.gt(Re(t.bytesValue)),this.ft(e);else if("referenceValue"in t)this.yt(t.referenceValue,e);else if("geoPointValue"in t){let n=t.geoPointValue;this.dt(e,45),e.At(n.latitude||0),e.At(n.longitude||0)}else"mapValue"in t?Ed(t)?this.dt(e,Number.MAX_SAFE_INTEGER):Js(t)?this.wt(t.mapValue,e):(this.St(t.mapValue,e),this.ft(e)):"arrayValue"in t?(this.bt(t.arrayValue,e),this.ft(e)):L()}Vt(t,e){this.dt(e,25),this.Dt(t,e)}Dt(t,e){e.Rt(t)}St(t,e){let n=t.fields||{};this.dt(e,55);for(let i of Object.keys(n))this.Vt(i,e),this.Tt(n[i],e)}wt(t,e){var n,i;let s=t.fields||{};this.dt(e,53);let a="value",u=((i=(n=s[a].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.length)||0;this.dt(e,15),e.At(st(u)),this.Vt(a,e),this.Tt(s[a],e)}bt(t,e){let n=t.values||[];this.dt(e,50);for(let i of n)this.Tt(i,e)}yt(t,e){this.dt(e,37),M.fromName(t).path.forEach(n=>{this.dt(e,60),this.Dt(n,e)})}dt(t,e){t.At(e)}ft(t){t.At(2)}};ie.vt=new ie;function Gp(r){if(r===0)return 8;let t=0;return!(r>>4)&&(t+=4,r<<=4),!(r>>6)&&(t+=2,r<<=2),!(r>>7)&&(t+=1),t}function Uh(r){let t=64-function(n){let i=0;for(let s=0;s<8;++s){let a=Gp(255&n[s]);if(i+=a,a!==8)break}return i}(r);return Math.ceil(t/8)}var $a=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Ft(n.value),n=e.next();this.Mt()}xt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Ot(n.value),n=e.next();this.Nt()}Lt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{let i=e.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{let i=e.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(t){let e=this.qt(t),n=Uh(e);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=255&e[i]}Kt(t){let e=this.qt(t),n=Uh(e);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=~(255&e[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(t){this.Qt(t.length),this.buffer.set(t,this.position),this.position+=t.length}zt(){return this.buffer.slice(0,this.position)}qt(t){let e=function(s){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(t),n=(128&e[0])!=0;e[0]^=n?255:128;for(let i=1;i<e.length;++i)e[i]^=n?255:0;return e}Ft(t){let e=255&t;e===0?(this.Ut(0),this.Ut(255)):e===255?(this.Ut(255),this.Ut(0)):this.Ut(e)}Ot(t){let e=255&t;e===0?(this.Gt(0),this.Gt(255)):e===255?(this.Gt(255),this.Gt(0)):this.Gt(t)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(t){this.Qt(1),this.buffer[this.position++]=t}Gt(t){this.Qt(1),this.buffer[this.position++]=~t}Qt(t){let e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},Ka=class{constructor(t){this.jt=t}gt(t){this.jt.Ct(t)}Rt(t){this.jt.Lt(t)}At(t){this.jt.kt(t)}Et(){this.jt.$t()}},Qa=class{constructor(t){this.jt=t}gt(t){this.jt.xt(t)}Rt(t){this.jt.Bt(t)}At(t){this.jt.Kt(t)}Et(){this.jt.Wt()}},Xe=class{constructor(){this.jt=new $a,this.Ht=new Ka(this.jt),this.Jt=new Qa(this.jt)}seed(t){this.jt.seed(t)}Yt(t){return t===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}};var Ze=class r{constructor(t,e,n,i){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=i}Zt(){let t=this.directionalValue.length,e=t===0||this.directionalValue[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new r(this.indexId,this.documentKey,this.arrayValue,n)}};function we(r,t){let e=r.indexId-t.indexId;return e!==0?e:(e=qh(r.arrayValue,t.arrayValue),e!==0?e:(e=qh(r.directionalValue,t.directionalValue),e!==0?e:M.comparator(r.documentKey,t.documentKey)))}function qh(r,t){for(let e=0;e<r.length&&e<t.length;++e){let n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}var ps=class{constructor(t){this.Xt=new nt((e,n)=>vt.comparator(e.field,n.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.en=t.orderBy,this.tn=[];for(let e of t.filters){let n=e;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(t){if(U(t.collectionGroup===this.collectionId),this.nn)return!1;let e=ma(t);if(e!==void 0&&!this.sn(e))return!1;let n=He(t),i=new Set,s=0,a=0;for(;s<n.length&&this.sn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Xt.size>0){let u=this.Xt.getIterator().getNext();if(!i.has(u.field.canonicalString())){let c=n[s];if(!this.on(u,c)||!this._n(this.en[a++],c))return!1}++s}for(;s<n.length;++s){let u=n[s];if(a>=this.en.length||!this._n(this.en[a++],u))return!1}return!0}an(){if(this.nn)return null;let t=new nt(vt.comparator),e=[];for(let n of this.tn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new kn(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new kn(n.field,0))}for(let n of this.en)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new kn(n.field,n.dir==="asc"?0:1)));return new Ln(Ln.UNKNOWN_ID,this.collectionId,e,zr.empty())}sn(t){for(let e of this.tn)if(this.on(e,t))return!0;return!1}on(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}_n(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function cf(r){var t,e;if(U(r instanceof Q||r instanceof tt),r instanceof Q){if(r instanceof os){let i=((e=(t=r.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(s=>Q.create(r.field,"==",s)))||[];return tt.create(i,"or")}return r}let n=r.filters.map(i=>cf(i));return tt.create(n,r.op)}function $p(r){if(r.getFilters().length===0)return[];let t=Ja(cf(r));return U(lf(t)),Wa(t)||Ha(t)?[t]:t.getFilters()}function Wa(r){return r instanceof Q}function Ha(r){return r instanceof tt&&hc(r)}function lf(r){return Wa(r)||Ha(r)||function(e){if(e instanceof tt&&Ta(e)){for(let n of e.getFilters())if(!Wa(n)&&!Ha(n))return!1;return!0}return!1}(r)}function Ja(r){if(U(r instanceof Q||r instanceof tt),r instanceof Q)return r;if(r.filters.length===1)return Ja(r.filters[0]);let t=r.filters.map(n=>Ja(n)),e=tt.create(t,r.op);return e=ys(e),lf(e)?e:(U(e instanceof tt),U(Bn(e)),U(e.filters.length>1),e.filters.reduce((n,i)=>yc(n,i)))}function yc(r,t){let e;return U(r instanceof Q||r instanceof tt),U(t instanceof Q||t instanceof tt),e=r instanceof Q?t instanceof Q?function(i,s){return tt.create([i,s],"and")}(r,t):Bh(r,t):t instanceof Q?Bh(t,r):function(i,s){if(U(i.filters.length>0&&s.filters.length>0),Bn(i)&&Bn(s))return bd(i,s.getFilters());let a=Ta(i)?i:s,u=Ta(i)?s:i,c=a.filters.map(d=>yc(d,u));return tt.create(c,"or")}(r,t),ys(e)}function Bh(r,t){if(Bn(t))return bd(t,r.getFilters());{let e=t.filters.map(n=>yc(r,n));return tt.create(e,"or")}}function ys(r){if(U(r instanceof Q||r instanceof tt),r instanceof Q)return r;let t=r.getFilters();if(t.length===1)return ys(t[0]);if(Rd(r))return r;let e=t.map(i=>ys(i)),n=[];return e.forEach(i=>{i instanceof Q?n.push(i):i instanceof tt&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:tt.create(n,r.op)}var Ya=class{constructor(){this.un=new ei}addToCollectionParentIndex(t,e){return this.un.add(e),R.resolve()}getCollectionParents(t,e){return R.resolve(this.un.getEntries(e))}addFieldIndex(t,e){return R.resolve()}deleteFieldIndex(t,e){return R.resolve()}deleteAllFieldIndexes(t){return R.resolve()}createTargetIndexes(t,e){return R.resolve()}getDocumentsMatchingTarget(t,e){return R.resolve(null)}getIndexType(t,e){return R.resolve(0)}getFieldIndexes(t,e){return R.resolve([])}getNextCollectionGroupToUpdate(t){return R.resolve(null)}getMinOffset(t,e){return R.resolve(qt.min())}getMinOffsetFromCollectionGroup(t,e){return R.resolve(qt.min())}updateCollectionGroup(t,e,n){return R.resolve()}updateIndexEntries(t,e){return R.resolve()}},ei=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new nt(J.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new nt(J.comparator)).toArray()}};var ji=new Uint8Array(0),Xa=class{constructor(t,e){this.databaseId=e,this.cn=new ei,this.ln=new Zt(n=>on(n),(n,i)=>hi(n,i)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.cn.has(e)){let n=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(()=>{this.cn.add(e)});let s={collectionId:n,parent:Dt(i)};return zh(t).put(s)}return R.resolve()}getCollectionParents(t,e){let n=[],i=IDBKeyRange.bound([e,""],[dd(e),""],!1,!0);return zh(t).U(i).next(s=>{for(let a of s){if(a.collectionId!==e)break;n.push(Kt(a.parent))}return n})}addFieldIndex(t,e){let n=Dr(t),i=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(e);delete i.indexId;let s=n.add(i);if(e.indexState){let a=Sn(t);return s.next(u=>{a.put(Oh(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){let n=Dr(t),i=Sn(t),s=An(t);return n.delete(e.indexId).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=Dr(t),n=An(t),i=Sn(t);return e.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(t,e){return R.forEach(this.hn(e),n=>this.getIndexType(t,n).next(i=>{if(i===0||i===1){let s=new ps(n).an();if(s!=null)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){let n=An(t),i=!0,s=new Map;return R.forEach(this.hn(e),a=>this.Pn(t,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=$(),u=[];return R.forEach(s,(c,d)=>{C("IndexedDbIndexManager",`Using index ${function(B){return`id=${B.indexId}|cg=${B.collectionGroup}|f=${B.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`}(c)} to execute ${on(e)}`);let f=function(B,W){let Z=ma(W);if(Z===void 0)return null;for(let K of us(B,Z.fieldPath))switch(K.op){case"array-contains-any":return K.value.arrayValue.values||[];case"array-contains":return[K.value]}return null}(d,c),g=function(B,W){let Z=new Map;for(let K of He(W))for(let v of us(B,K.fieldPath))switch(v.op){case"==":case"in":Z.set(K.fieldPath.canonicalString(),v.value);break;case"not-in":case"!=":return Z.set(K.fieldPath.canonicalString(),v.value),Array.from(Z.values())}return null}(d,c),_=function(B,W){let Z=[],K=!0;for(let v of He(W)){let p=v.kind===0?Ih(B,v.fieldPath,B.startAt):Th(B,v.fieldPath,B.startAt);Z.push(p.value),K&&(K=p.inclusive)}return new Xt(Z,K)}(d,c),S=function(B,W){let Z=[],K=!0;for(let v of He(W)){let p=v.kind===0?Th(B,v.fieldPath,B.endAt):Ih(B,v.fieldPath,B.endAt);Z.push(p.value),K&&(K=p.inclusive)}return new Xt(Z,K)}(d,c),k=this.In(c,d,_),N=this.In(c,d,S),D=this.Tn(c,d,g),z=this.En(c.indexId,f,k,_.inclusive,N,S.inclusive,D);return R.forEach(z,j=>n.G(j,e.limit).next(B=>{B.forEach(W=>{let Z=M.fromSegments(W.documentKey);a.has(Z)||(a=a.add(Z),u.push(Z))})}))}).next(()=>u)}return R.resolve(null)})}hn(t){let e=this.ln.get(t);return e||(t.filters.length===0?e=[t]:e=$p(tt.create(t.filters,"and")).map(n=>xa(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt)),this.ln.set(t,e),e)}En(t,e,n,i,s,a,u){let c=(e!=null?e.length:1)*Math.max(n.length,s.length),d=c/(e!=null?e.length:1),f=[];for(let g=0;g<c;++g){let _=e?this.dn(e[g/d]):ji,S=this.An(t,_,n[g%d],i),k=this.Rn(t,_,s[g%d],a),N=u.map(D=>this.An(t,_,D,!0));f.push(...this.createRange(S,k,N))}return f}An(t,e,n,i){let s=new Ze(t,M.empty(),e,n);return i?s:s.Zt()}Rn(t,e,n,i){let s=new Ze(t,M.empty(),e,n);return i?s.Zt():s}Pn(t,e){let n=new ps(e),i=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next(s=>{let a=null;for(let u of s)n.rn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(t,e){let n=2,i=this.hn(e);return R.forEach(i,s=>this.Pn(t,s).next(a=>{a?n!==0&&a.fields.length<function(c){let d=new nt(vt.comparator),f=!1;for(let g of c.filters)for(let _ of g.getFlattenedFilters())_.field.isKeyField()||(_.op==="array-contains"||_.op==="array-contains-any"?f=!0:d=d.add(_.field));for(let g of c.orderBy)g.field.isKeyField()||(d=d.add(g.field));return d.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(e)&&i.length>1&&n===2?1:n)}Vn(t,e){let n=new Xe;for(let i of He(t)){let s=e.data.field(i.fieldPath);if(s==null)return null;let a=n.Yt(i.kind);ie.vt.It(s,a)}return n.zt()}dn(t){let e=new Xe;return ie.vt.It(t,e.Yt(0)),e.zt()}mn(t,e){let n=new Xe;return ie.vt.It(rn(this.databaseId,e),n.Yt(function(s){let a=He(s);return a.length===0?0:a[a.length-1].kind}(t))),n.zt()}Tn(t,e,n){if(n===null)return[];let i=[];i.push(new Xe);let s=0;for(let a of He(t)){let u=n[s++];for(let c of i)if(this.fn(e,a.fieldPath)&&Qr(u))i=this.gn(i,a,u);else{let d=c.Yt(a.kind);ie.vt.It(u,d)}}return this.pn(i)}In(t,e,n){return this.Tn(t,e,n.position)}pn(t){let e=[];for(let n=0;n<t.length;++n)e[n]=t[n].zt();return e}gn(t,e,n){let i=[...t],s=[];for(let a of n.arrayValue.values||[])for(let u of i){let c=new Xe;c.seed(u.zt()),ie.vt.It(a,c.Yt(e.kind)),s.push(c)}return s}fn(t,e){return!!t.filters.find(n=>n instanceof Q&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(t,e){let n=Dr(t),i=Sn(t);return(e?n.U("collectionGroupIndex",IDBKeyRange.bound(e,e)):n.U()).next(s=>{let a=[];return R.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{a.push(function(f,g){let _=g?new zr(g.sequenceNumber,new qt(cn(g.readTime),new M(Kt(g.documentKey)),g.largestBatchId)):zr.empty(),S=f.fields.map(([k,N])=>new kn(vt.fromServerFormat(k),N));return new Ln(f.indexId,f.collectionGroup,S,_)}(u,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:G(n.collectionGroup,i.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,n){let i=Dr(t),s=Sn(t);return this.yn(t).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(e,e)).next(u=>R.forEach(u,c=>s.put(Oh(c.indexId,this.uid,a,n)))))}updateIndexEntries(t,e){let n=new Map;return R.forEach(e,(i,s)=>{let a=n.get(i.collectionGroup);return(a?R.resolve(a):this.getFieldIndexes(t,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),R.forEach(u,c=>this.wn(t,i,c).next(d=>{let f=this.Sn(s,c);return d.isEqual(f)?R.resolve():this.bn(t,s,c,d,f)}))))})}Dn(t,e,n,i){return An(t).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(n,e.key),documentKey:e.key.path.toArray()})}vn(t,e,n,i){return An(t).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(n,e.key),e.key.path.toArray()])}wn(t,e,n){let i=An(t),s=new nt(we);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,e)])},(a,u)=>{s=s.add(new Ze(n.indexId,e,u.arrayValue,u.directionalValue))}).next(()=>s)}Sn(t,e){let n=new nt(we),i=this.Vn(e,t);if(i==null)return n;let s=ma(e);if(s!=null){let a=t.data.field(s.fieldPath);if(Qr(a))for(let u of a.arrayValue.values||[])n=n.add(new Ze(e.indexId,t.key,this.dn(u),i))}else n=n.add(new Ze(e.indexId,t.key,ji,i));return n}bn(t,e,n,i,s){C("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);let a=[];return function(c,d,f,g,_){let S=c.getIterator(),k=d.getIterator(),N=En(S),D=En(k);for(;N||D;){let z=!1,j=!1;if(N&&D){let B=f(N,D);B<0?j=!0:B>0&&(z=!0)}else N!=null?j=!0:z=!0;z?(g(D),D=En(k)):j?(_(N),N=En(S)):(N=En(S),D=En(k))}}(i,s,we,u=>{a.push(this.Dn(t,e,n,u))},u=>{a.push(this.vn(t,e,n,u))}),R.waitFor(a)}yn(t){let e=1;return Sn(t).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),e=i.sequenceNumber+1}).next(()=>e)}createRange(t,e,n){n=n.sort((a,u)=>we(a,u)).filter((a,u,c)=>!u||we(a,c[u-1])!==0);let i=[];i.push(t);for(let a of n){let u=we(a,t),c=we(a,e);if(u===0)i[0]=t.Zt();else if(u>0&&c<0)i.push(a),i.push(a.Zt());else if(c>0)break}i.push(e);let s=[];for(let a=0;a<i.length;a+=2){if(this.Cn(i[a],i[a+1]))return[];let u=[i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,ji,[]],c=[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,ji,[]];s.push(IDBKeyRange.bound(u,c))}return s}Cn(t,e){return we(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(jh)}getMinOffset(t,e){return R.mapArray(this.hn(e),n=>this.Pn(t,n).next(i=>i||L())).next(jh)}};function zh(r){return It(r,"collectionParents")}function An(r){return It(r,"indexEntries")}function Dr(r){return It(r,"indexConfiguration")}function Sn(r){return It(r,"indexState")}function jh(r){U(r.length!==0);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;ac(i,t)<0&&(t=i),e<i.largestBatchId&&(e=i.largestBatchId)}return new qt(t.readTime,t.documentKey,e)}var Gh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ut=class r{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new r(t,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function hf(r,t,e){let n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(e.batchId),u=0,c=n.J({range:a},(f,g,_)=>(u++,_.delete()));s.push(c.next(()=>{U(u===1)}));let d=[];for(let f of e.mutations){let g=_d(t,f.key.path,e.batchId);s.push(i.delete(g)),d.push(f.key)}return R.waitFor(s).next(()=>d)}function _s(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw L();t=r.noDocument}return JSON.stringify(t).length}Ut.DEFAULT_COLLECTION_PERCENTILE=10,Ut.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ut.DEFAULT=new Ut(41943040,Ut.DEFAULT_COLLECTION_PERCENTILE,Ut.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ut.DISABLED=new Ut(-1,0,0);var ws=class r{constructor(t,e,n,i){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=i,this.Fn={}}static lt(t,e,n,i){U(t.uid!=="");let s=t.isAuthenticated()?t.uid:"";return new r(s,e,n,i)}checkEmpty(t){let e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ve(t).J({index:"userMutationsIndex",range:n},(i,s,a)=>{e=!1,a.done()}).next(()=>e)}addMutationBatch(t,e,n,i){let s=xn(t),a=ve(t);return a.add({}).next(u=>{U(typeof u=="number");let c=new Hr(u,e,n,i),d=function(S,k,N){let D=N.baseMutations.map(j=>ti(S.ct,j)),z=N.mutations.map(j=>ti(S.ct,j));return{userId:k,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:D,mutations:z}}(this.serializer,this.userId,c),f=[],g=new nt((_,S)=>G(_.canonicalString(),S.canonicalString()));for(let _ of i){let S=_d(this.userId,_.key.path,u);g=g.add(_.key.path.popLast()),f.push(a.put(d)),f.push(s.put(S,Yg))}return g.forEach(_=>{f.push(this.indexManager.addToCollectionParentIndex(t,_))}),t.addOnCommittedListener(()=>{this.Fn[u]=c.keys()}),R.waitFor(f).next(()=>c)})}lookupMutationBatch(t,e){return ve(t).get(e).next(n=>n?(U(n.userId===this.userId),Ye(this.serializer,n)):null)}Mn(t,e){return this.Fn[e]?R.resolve(this.Fn[e]):this.lookupMutationBatch(t,e).next(n=>{if(n){let i=n.keys();return this.Fn[e]=i,i}return null})}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return ve(t).J({index:"userMutationsIndex",range:i},(a,u,c)=>{u.userId===this.userId&&(U(u.batchId>=n),s=Ye(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return ve(t).J({index:"userMutationsIndex",range:e,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ve(t).U("userMutationsIndex",e).next(n=>n.map(i=>Ye(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(t,e){let n=Qi(this.userId,e.path),i=IDBKeyRange.lowerBound(n),s=[];return xn(t).J({range:i},(a,u,c)=>{let[d,f,g]=a,_=Kt(f);if(d===this.userId&&e.path.isEqual(_))return ve(t).get(g).next(S=>{if(!S)throw L();U(S.userId===this.userId),s.push(Ye(this.serializer,S))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new nt(G),i=[];return e.forEach(s=>{let a=Qi(this.userId,s.path),u=IDBKeyRange.lowerBound(a),c=xn(t).J({range:u},(d,f,g)=>{let[_,S,k]=d,N=Kt(S);_===this.userId&&s.path.isEqual(N)?n=n.add(k):g.done()});i.push(c)}),R.waitFor(i).next(()=>this.xn(t,n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=Qi(this.userId,n),a=IDBKeyRange.lowerBound(s),u=new nt(G);return xn(t).J({range:a},(c,d,f)=>{let[g,_,S]=c,k=Kt(_);g===this.userId&&n.isPrefixOf(k)?k.length===i&&(u=u.add(S)):f.done()}).next(()=>this.xn(t,u))}xn(t,e){let n=[],i=[];return e.forEach(s=>{i.push(ve(t).get(s).next(a=>{if(a===null)throw L();U(a.userId===this.userId),n.push(Ye(this.serializer,a))}))}),R.waitFor(i).next(()=>n)}removeMutationBatch(t,e){return hf(t._e,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.On(e.batchId)}),R.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(t,i))))}On(t){delete this.Fn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return R.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return xn(t).J({range:n},(s,a,u)=>{if(s[0]===this.userId){let c=Kt(s[1]);i.push(c)}else u.done()}).next(()=>{U(i.length===0)})})}containsKey(t,e){return df(t,this.userId,e)}Nn(t){return ff(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function df(r,t,e){let n=Qi(t,e.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return xn(r).J({range:s,H:!0},(u,c,d)=>{let[f,g,_]=u;f===t&&g===i&&(a=!0),d.done()}).next(()=>a)}function ve(r){return It(r,"mutations")}function xn(r){return It(r,"documentMutations")}function ff(r){return It(r,"mutationQueues")}var Kn=class r{constructor(t){this.Ln=t}next(){return this.Ln+=2,this.Ln}static Bn(){return new r(0)}static kn(){return new r(-1)}};var Za=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.qn(t).next(e=>{let n=new Kn(e.highestTargetId);return e.highestTargetId=n.next(),this.Qn(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.qn(t).next(e=>q.fromTimestamp(new lt(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.qn(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.qn(t).next(i=>(i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.Qn(t,i)))}addTargetData(t,e){return this.Kn(t,e).next(()=>this.qn(t).next(n=>(n.targetCount+=1,this.$n(e,n),this.Qn(t,n))))}updateTargetData(t,e){return this.Kn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Rn(t).delete(e.targetId)).next(()=>this.qn(t)).next(n=>(U(n.targetCount>0),n.targetCount-=1,this.Qn(t,n)))}removeTargets(t,e,n){let i=0,s=[];return Rn(t).J((a,u)=>{let c=Or(u);c.sequenceNumber<=e&&n.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(t,c)))}).next(()=>R.waitFor(s)).next(()=>i)}forEachTarget(t,e){return Rn(t).J((n,i)=>{let s=Or(i);e(s)})}qn(t){return $h(t).get("targetGlobalKey").next(e=>(U(e!==null),e))}Qn(t,e){return $h(t).put("targetGlobalKey",e)}Kn(t,e){return Rn(t).put(uf(this.serializer,e))}$n(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.qn(t).next(e=>e.targetCount)}getTargetData(t,e){let n=on(e),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return Rn(t).J({range:i,index:"queryTargetsIndex"},(a,u,c)=>{let d=Or(u);hi(e,d.target)&&(s=d,c.done())}).next(()=>s)}addMatchingKeys(t,e,n){let i=[],s=Ie(t);return e.forEach(a=>{let u=Dt(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(t,n,a))}),R.waitFor(i)}removeMatchingKeys(t,e,n){let i=Ie(t);return R.forEach(e,s=>{let a=Dt(s.path);return R.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(t,n,s)])})}removeMatchingKeysForTargetId(t,e){let n=Ie(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(t,e){let n=IDBKeyRange.bound([e],[e+1],!1,!0),i=Ie(t),s=$();return i.J({range:n,H:!0},(a,u,c)=>{let d=Kt(a[1]),f=new M(d);s=s.add(f)}).next(()=>s)}containsKey(t,e){let n=Dt(e.path),i=IDBKeyRange.bound([n],[dd(n)],!1,!0),s=0;return Ie(t).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],c,d)=>{a!==0&&(s++,d.done())}).next(()=>s>0)}ot(t,e){return Rn(t).get(e).next(n=>n?Or(n):null)}};function Rn(r){return It(r,"targets")}function $h(r){return It(r,"targetGlobal")}function Ie(r){return It(r,"targetDocuments")}function Kh([r,t],[e,n]){let i=G(r,e);return i===0?G(t,n):i}var tu=class{constructor(t){this.Un=t,this.buffer=new nt(Kh),this.Wn=0}Gn(){return++this.Wn}zn(t){let e=[t,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(e);else{let n=this.buffer.last();Kh(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}},eu=class{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(t){C("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>V(this,null,function*(){this.jn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){Me(e)?C("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield Oe(e)}yield this.Hn(3e5)}))}},nu=class{constructor(t,e){this.Jn=t,this.params=e}calculateTargetCount(t,e){return this.Jn.Yn(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return R.resolve(Mt.oe);let n=new tu(e);return this.Jn.forEachTarget(t,i=>n.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(t,i=>n.zn(i))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.Jn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.Jn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(C("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(Gh)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(C("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Gh):this.Xn(t,e))}getCacheSize(t){return this.Jn.getCacheSize(t)}Xn(t,e){let n,i,s,a,u,c,d,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(C("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,a=Date.now(),this.nthSequenceNumber(t,i))).next(g=>(n=g,u=Date.now(),this.removeTargets(t,n,e))).next(g=>(s=g,c=Date.now(),this.removeOrphanedDocuments(t,n))).next(g=>(d=Date.now(),Pn()<=$t.DEBUG&&C("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${s} targets in `+(c-u)+`ms
	Removed ${g} documents in `+(d-c)+`ms
Total Duration: ${d-f}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}};function Kp(r,t){return new nu(r,t)}var ru=class{constructor(t,e){this.db=t,this.garbageCollector=Kp(this,e)}Yn(t){let e=this.er(t);return this.db.getTargetCache().getTargetCount(t).next(n=>e.next(i=>n+i))}er(t){let e=0;return this.Zn(t,n=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Zn(t,e){return this.tr(t,(n,i)=>e(i))}addReference(t,e,n){return Gi(t,n)}removeReference(t,e,n){return Gi(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Gi(t,e)}nr(t,e){return function(i,s){let a=!1;return ff(i).Y(u=>df(i,u,s).next(c=>(c&&(a=!0),R.resolve(!c)))).next(()=>a)}(t,e)}removeOrphanedDocuments(t,e){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.tr(t,(a,u)=>{if(u<=e){let c=this.nr(t,a).next(d=>{if(!d)return s++,n.getEntry(t,a).next(()=>(n.removeEntry(a,q.min()),Ie(t).delete(function(g){return[0,Dt(g.path)]}(a))))});i.push(c)}}).next(()=>R.waitFor(i)).next(()=>n.apply(t)).next(()=>s)}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Gi(t,e)}tr(t,e){let n=Ie(t),i,s=Mt.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:c,sequenceNumber:d})=>{a===0?(s!==Mt.oe&&e(new M(Kt(i)),s),s=d,i=c):s=Mt.oe}).next(()=>{s!==Mt.oe&&e(new M(Kt(i)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function Gi(r,t){return Ie(r).put(function(n,i){return{targetId:0,path:Dt(n.path),sequenceNumber:i}}(t,r.currentSequenceNumber))}var vs=class{constructor(){this.changes=new Zt(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,yt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let n=this.changes.get(e);return n!==void 0?R.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var iu=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return We(t).put(n)}removeEntry(t,e,n){return We(t).delete(function(s,a){let u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],ms(a),u[u.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.rr(t,n)))}getEntry(t,e){let n=yt.newInvalidDocument(e);return We(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(kr(e))},(i,s)=>{n=this.ir(e,s)}).next(()=>n)}sr(t,e){let n={size:0,document:yt.newInvalidDocument(e)};return We(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(kr(e))},(i,s)=>{n={document:this.ir(e,s),size:_s(s)}}).next(()=>n)}getEntries(t,e){let n=Ft();return this._r(t,e,(i,s)=>{let a=this.ir(i,s);n=n.insert(i,a)}).next(()=>n)}ar(t,e){let n=Ft(),i=new it(M.comparator);return this._r(t,e,(s,a)=>{let u=this.ir(s,a);n=n.insert(s,u),i=i.insert(s,_s(a))}).next(()=>({documents:n,ur:i}))}_r(t,e,n){if(e.isEmpty())return R.resolve();let i=new nt(Hh);e.forEach(c=>i=i.add(c));let s=IDBKeyRange.bound(kr(i.first()),kr(i.last())),a=i.getIterator(),u=a.getNext();return We(t).J({index:"documentKeyIndex",range:s},(c,d,f)=>{let g=M.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&Hh(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,d),u=a.hasNext()?a.getNext():null),u?f.$(kr(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(t,e,n,i,s){let a=e.path,u=[a.popLast().toArray(),a.lastSegment(),ms(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return We(t).U(IDBKeyRange.bound(u,c,!0)).next(d=>{s?.incrementDocumentReadCount(d.length);let f=Ft();for(let g of d){let _=this.ir(M.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);_.isFoundDocument()&&(fi(e,_)||i.has(_.key))&&(f=f.insert(_.key,_))}return f})}getAllFromCollectionGroup(t,e,n,i){let s=Ft(),a=Wh(e,n),u=Wh(e,qt.max());return We(t).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(c,d,f)=>{let g=this.ir(M.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(t){return new su(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return Qh(t).get("remoteDocumentGlobalKey").next(e=>(U(!!e),e))}rr(t,e){return Qh(t).put("remoteDocumentGlobalKey",e)}ir(t,e){if(e){let n=jp(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(q.min())))return n}return yt.newInvalidDocument(t)}};function mf(r){return new iu(r)}var su=class extends vs{constructor(t,e){super(),this.cr=t,this.trackRemovals=e,this.lr=new Zt(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(t){let e=[],n=0,i=new nt((s,a)=>G(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{let u=this.lr.get(s);if(e.push(this.cr.removeEntry(t,s,u.readTime)),a.isValidDocument()){let c=Nh(this.cr.serializer,a);i=i.add(s.path.popLast());let d=_s(c);n+=d-u.size,e.push(this.cr.addEntry(t,s,c))}else if(n-=u.size,this.trackRemovals){let c=Nh(this.cr.serializer,a.convertToNoDocument(q.min()));e.push(this.cr.addEntry(t,s,c))}}),i.forEach(s=>{e.push(this.cr.indexManager.addToCollectionParentIndex(t,s))}),e.push(this.cr.updateMetadata(t,n)),R.waitFor(e)}getFromCache(t,e){return this.cr.sr(t,e).next(n=>(this.lr.set(e,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(t,e){return this.cr.ar(t,e).next(({documents:n,ur:i})=>(i.forEach((s,a)=>{this.lr.set(s,{size:a,readTime:n.get(s).readTime})}),n))}};function Qh(r){return It(r,"remoteDocumentGlobal")}function We(r){return It(r,"remoteDocumentsV14")}function kr(r){let t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Wh(r,t){let e=t.documentKey.path.toArray();return[r,ms(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Hh(r,t){let e=r.path.toArray(),n=t.path.toArray(),i=0;for(let s=0;s<e.length-2&&s<n.length-2;++s)if(i=G(e[s],n[s]),i)return i;return i=G(e.length,n.length),i||(i=G(e[e.length-2],n[n.length-2]),i||G(e[e.length-1],n[n.length-1]))}var ou=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var Is=class{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(n=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(n!==null&&Ur(n.mutation,i,Lt.empty(),lt.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,$()).next(()=>n))}getLocalViewOfDocuments(t,e,n=$()){let i=Qt();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,n).next(s=>{let a=Fr();return s.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let n=Qt();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,$()))}populateOverlays(t,e,n){let i=[];return n.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((a,u)=>{e.set(a,u)})})}computeViews(t,e,n,i){let s=Ft(),a=Lr(),u=function(){return Lr()}();return e.forEach((c,d)=>{let f=n.get(d.key);i.has(d.key)&&(f===void 0||f.mutation instanceof Gt)?s=s.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),Ur(f.mutation,d,f.mutation.getFieldMask(),lt.now())):a.set(d.key,Lt.empty())}),this.recalculateAndSaveOverlays(t,s).next(c=>(c.forEach((d,f)=>a.set(d,f)),e.forEach((d,f)=>{var g;return u.set(d,new ou(f,(g=a.get(d))!==null&&g!==void 0?g:null))}),u))}recalculateAndSaveOverlays(t,e){let n=Lr(),i=new it((a,u)=>a-u),s=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let u of a)u.keys().forEach(c=>{let d=e.get(c);if(d===null)return;let f=n.get(c)||Lt.empty();f=u.applyToLocalView(d,f),n.set(c,f);let g=(i.get(u.batchId)||$()).add(c);i=i.insert(u.batchId,g)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let c=u.getNext(),d=c.key,f=c.value,g=Md();f.forEach(_=>{if(!s.has(_)){let S=Gd(e.get(_),n.get(_));S!==null&&g.set(_,S),s=s.add(_)}}),a.push(this.documentOverlayCache.saveOverlays(t,d,g))}return R.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,i){return function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):dc(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,i):this.getDocumentsMatchingCollectionQuery(t,e,n,i)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-s.size):R.resolve(Qt()),u=-1,c=s;return a.next(d=>R.forEach(d,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),s.get(f)?R.resolve():this.remoteDocumentCache.getEntry(t,f).next(_=>{c=c.insert(f,_)}))).next(()=>this.populateOverlays(t,d,s)).next(()=>this.computeViews(t,c,d,$())).next(f=>({batchId:u,changes:Od(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new M(e)).next(n=>{let i=Fr();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,n,i){let s=e.collectionGroup,a=Fr();return this.indexManager.getCollectionParents(t,s).next(u=>R.forEach(u,c=>{let d=function(g,_){return new jt(_,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(e,c.child(s));return this.getDocumentsMatchingCollectionQuery(t,d,n,i).next(f=>{f.forEach((g,_)=>{a=a.insert(g,_)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,i))).next(a=>{s.forEach((c,d)=>{let f=d.getKey();a.get(f)===null&&(a=a.insert(f,yt.newInvalidDocument(f)))});let u=Fr();return a.forEach((c,d)=>{let f=s.get(c);f!==void 0&&Ur(f.mutation,d,Lt.empty(),lt.now()),fi(e,d)&&(u=u.insert(c,d))}),u})}};var au=class{constructor(t){this.serializer=t,this.hr=new Map,this.Pr=new Map}getBundleMetadata(t,e){return R.resolve(this.hr.get(e))}saveBundleMetadata(t,e){return this.hr.set(e.id,function(i){return{id:i.id,version:i.version,createTime:ht(i.createTime)}}(e)),R.resolve()}getNamedQuery(t,e){return R.resolve(this.Pr.get(e))}saveNamedQuery(t,e){return this.Pr.set(e.name,function(i){return{name:i.name,query:pc(i.bundledQuery),readTime:ht(i.readTime)}}(e)),R.resolve()}};var uu=class{constructor(){this.overlays=new it(M.comparator),this.Ir=new Map}getOverlay(t,e){return R.resolve(this.overlays.get(e))}getOverlays(t,e){let n=Qt();return R.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((i,s)=>{this.ht(t,e,s)}),R.resolve()}removeOverlaysForBatchId(t,e,n){let i=this.Ir.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(n)),R.resolve()}getOverlaysForCollection(t,e,n){let i=Qt(),s=e.length+1,a=new M(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let c=u.getNext().value,d=c.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return R.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new it((d,f)=>d-f),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let f=s.get(d.largestBatchId);f===null&&(f=Qt(),s=s.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}let u=Qt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((d,f)=>u.set(d,f)),!(u.size()>=i)););return R.resolve(u)}ht(t,e,n){let i=this.overlays.get(n.key);if(i!==null){let a=this.Ir.get(i.largestBatchId).delete(n.key);this.Ir.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Jr(e,n));let s=this.Ir.get(e);s===void 0&&(s=$(),this.Ir.set(e,s)),this.Ir.set(e,s.add(n.key))}};var cu=class{constructor(){this.sessionToken=ft.EMPTY_BYTE_STRING}getSessionToken(t){return R.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,R.resolve()}};var ni=class{constructor(){this.Tr=new nt(gt.Er),this.dr=new nt(gt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(t,e){let n=new gt(t,e);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.Vr(new gt(t,e))}mr(t,e){t.forEach(n=>this.removeReference(n,e))}gr(t){let e=new M(new J([])),n=new gt(e,t),i=new gt(e,t+1),s=[];return this.dr.forEachInRange([n,i],a=>{this.Vr(a),s.push(a.key)}),s}pr(){this.Tr.forEach(t=>this.Vr(t))}Vr(t){this.Tr=this.Tr.delete(t),this.dr=this.dr.delete(t)}yr(t){let e=new M(new J([])),n=new gt(e,t),i=new gt(e,t+1),s=$();return this.dr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(t){let e=new gt(t,0),n=this.Tr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}},gt=class{constructor(t,e){this.key=t,this.wr=e}static Er(t,e){return M.comparator(t.key,e.key)||G(t.wr,e.wr)}static Ar(t,e){return G(t.wr,e.wr)||M.comparator(t.key,e.key)}};var lu=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.Sr=1,this.br=new nt(gt.Er)}checkEmpty(t){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,i){let s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new Hr(s,e,n,i);this.mutationQueue.push(a);for(let u of i)this.br=this.br.add(new gt(u.key,s)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return R.resolve(a)}lookupMutationBatch(t,e){return R.resolve(this.Dr(e))}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=this.vr(n),s=i<0?0:i;return R.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(t){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let n=new gt(e,0),i=new gt(e,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([n,i],a=>{let u=this.Dr(a.wr);s.push(u)}),R.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new nt(G);return e.forEach(i=>{let s=new gt(i,0),a=new gt(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,a],u=>{n=n.add(u.wr)})}),R.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=n;M.isDocumentKey(s)||(s=s.child(""));let a=new gt(new M(s),0),u=new nt(G);return this.br.forEachWhile(c=>{let d=c.key.path;return!!n.isPrefixOf(d)&&(d.length===i&&(u=u.add(c.wr)),!0)},a),R.resolve(this.Cr(u))}Cr(t){let e=[];return t.forEach(n=>{let i=this.Dr(n);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){U(this.Fr(e.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return R.forEach(e.mutations,i=>{let s=new gt(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.br=n})}On(t){}containsKey(t,e){let n=new gt(e,0),i=this.br.firstAfterOrEqual(n);return R.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,R.resolve()}Fr(t,e){return this.vr(t)}vr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Dr(t){let e=this.vr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var hu=class{constructor(t){this.Mr=t,this.docs=function(){return new it(M.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let n=e.key,i=this.docs.get(n),s=i?i.size:0,a=this.Mr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let n=this.docs.get(e);return R.resolve(n?n.document.mutableCopy():yt.newInvalidDocument(e))}getEntries(t,e){let n=Ft();return e.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():yt.newInvalidDocument(i))}),R.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let s=Ft(),a=e.path,u=new M(a.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){let{key:d,value:{document:f}}=c.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||ac(md(f),n)<=0||(i.has(f.key)||fi(e,f))&&(s=s.insert(f.key,f.mutableCopy()))}return R.resolve(s)}getAllFromCollectionGroup(t,e,n,i){L()}Or(t,e){return R.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new du(this)}getSize(t){return R.resolve(this.size)}},du=class extends vs{constructor(t){super(),this.cr=t}applyChanges(t){let e=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?e.push(this.cr.addEntry(t,i)):this.cr.removeEntry(n)}),R.waitFor(e)}getFromCache(t,e){return this.cr.getEntry(t,e)}getAllFromCache(t,e){return this.cr.getEntries(t,e)}};var fu=class{constructor(t){this.persistence=t,this.Nr=new Zt(e=>on(e),hi),this.lastRemoteSnapshotVersion=q.min(),this.highestTargetId=0,this.Lr=0,this.Br=new ni,this.targetCount=0,this.kr=Kn.Bn()}forEachTarget(t,e){return this.Nr.forEach((n,i)=>e(i)),R.resolve()}getLastRemoteSnapshotVersion(t){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return R.resolve(this.Lr)}allocateTargetId(t){return this.highestTargetId=this.kr.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Lr&&(this.Lr=e),R.resolve()}Kn(t){this.Nr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.kr=new Kn(e),this.highestTargetId=e),t.sequenceNumber>this.Lr&&(this.Lr=t.sequenceNumber)}addTargetData(t,e){return this.Kn(e),this.targetCount+=1,R.resolve()}updateTargetData(t,e){return this.Kn(e),R.resolve()}removeTargetData(t,e){return this.Nr.delete(e.target),this.Br.gr(e.targetId),this.targetCount-=1,R.resolve()}removeTargets(t,e,n){let i=0,s=[];return this.Nr.forEach((a,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.Nr.delete(a),s.push(this.removeMatchingKeysForTargetId(t,u.targetId)),i++)}),R.waitFor(s).next(()=>i)}getTargetCount(t){return R.resolve(this.targetCount)}getTargetData(t,e){let n=this.Nr.get(e)||null;return R.resolve(n)}addMatchingKeys(t,e,n){return this.Br.Rr(e,n),R.resolve()}removeMatchingKeys(t,e,n){this.Br.mr(e,n);let i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(a=>{s.push(i.markPotentiallyOrphaned(t,a))}),R.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Br.gr(e),R.resolve()}getMatchingKeysForTargetId(t,e){let n=this.Br.yr(e);return R.resolve(n)}containsKey(t,e){return R.resolve(this.Br.containsKey(e))}};var Ts=class{constructor(t,e){this.qr={},this.overlays={},this.Qr=new Mt(0),this.Kr=!1,this.Kr=!0,this.$r=new cu,this.referenceDelegate=t(this),this.Ur=new fu(this),this.indexManager=new Ya,this.remoteDocumentCache=function(i){return new hu(i)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new fs(e),this.Gr=new au(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new uu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.qr[t.toKey()];return n||(n=new lu(e,this.referenceDelegate),this.qr[t.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(t,e,n){C("MemoryPersistence","Starting transaction:",t);let i=new mu(this.Qr.next());return this.referenceDelegate.zr(),n(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(t,e){return R.or(Object.values(this.qr).map(n=>()=>n.containsKey(t,e)))}},mu=class extends es{constructor(t){super(),this.currentSequenceNumber=t}},Es=class r{constructor(t){this.persistence=t,this.Jr=new ni,this.Yr=null}static Zr(t){return new r(t)}get Xr(){if(this.Yr)return this.Yr;throw L()}addReference(t,e,n){return this.Jr.addReference(n,e),this.Xr.delete(n.toString()),R.resolve()}removeReference(t,e,n){return this.Jr.removeReference(n,e),this.Xr.add(n.toString()),R.resolve()}markPotentiallyOrphaned(t,e){return this.Xr.add(e.toString()),R.resolve()}removeTarget(t,e){this.Jr.gr(e.targetId).forEach(i=>this.Xr.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>n.removeTargetData(t,e))}zr(){this.Yr=new Set}jr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.Xr,n=>{let i=M.fromPath(n);return this.ei(t,i).next(s=>{s||e.removeEntry(i,q.min())})}).next(()=>(this.Yr=null,e.apply(t)))}updateLimboDocument(t,e){return this.ei(t,e).next(n=>{n?this.Xr.delete(e.toString()):this.Xr.add(e.toString())})}Wr(t){return 0}ei(t,e){return R.or([()=>R.resolve(this.Jr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Hr(t,e)])}};var gu=class{constructor(t){this.serializer=t}O(t,e,n,i){let s=new ns("createOrUpgrade",e);n<1&&i>=1&&(function(c){c.createObjectStore("owner")}(t),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",hh,{unique:!0}),c.createObjectStore("documentMutations")}(t),Jh(t),function(c){c.createObjectStore("remoteDocuments")}(t));let a=R.resolve();return n<3&&i>=3&&(n!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(t),Jh(t)),a=a.next(()=>function(c){let d=c.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:q.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(n!==0&&(a=a.next(()=>function(c,d){return d.store("mutations").U().next(f=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",hh,{unique:!0});let g=d.store("mutations"),_=f.map(S=>g.put(S));return R.waitFor(_)})}(t,s))),a=a.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(t)})),n<5&&i>=5&&(a=a.next(()=>this.ni(s))),n<6&&i>=6&&(a=a.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(t),this.ri(s)))),n<7&&i>=7&&(a=a.next(()=>this.ii(s))),n<8&&i>=8&&(a=a.next(()=>this.si(t,s))),n<9&&i>=9&&(a=a.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(t)})),n<10&&i>=10&&(a=a.next(()=>this.oi(s))),n<11&&i>=11&&(a=a.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(t),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(t)})),n<12&&i>=12&&(a=a.next(()=>{(function(c){let d=c.createObjectStore("documentOverlays",{keyPath:cp});d.createIndex("collectionPathOverlayIndex",lp,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",hp,{unique:!1})})(t)})),n<13&&i>=13&&(a=a.next(()=>function(c){let d=c.createObjectStore("remoteDocumentsV14",{keyPath:Xg});d.createIndex("documentKeyIndex",Zg),d.createIndex("collectionGroupIndex",tp)}(t)).next(()=>this._i(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this.ai(t,s))),n<15&&i>=15&&(a=a.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:sp}).createIndex("sequenceNumberIndex",op,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:ap}).createIndex("documentKeyIndex",up,{unique:!1})}(t))),n<16&&i>=16&&(a=a.next(()=>{e.objectStore("indexState").clear()}).next(()=>{e.objectStore("indexEntries").clear()})),n<17&&i>=17&&(a=a.next(()=>{(function(c){c.createObjectStore("globals",{keyPath:"name"})})(t)})),a}ri(t){let e=0;return t.store("remoteDocuments").J((n,i)=>{e+=_s(i)}).next(()=>{let n={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(t){let e=t.store("mutationQueues"),n=t.store("mutations");return e.U().next(i=>R.forEach(i,s=>{let a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>R.forEach(u,c=>{U(c.userId===s.userId);let d=Ye(this.serializer,c);return hf(t,s.userId,d).next(()=>{})}))}))}ii(t){let e=t.store("targetDocuments"),n=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return n.J((a,u)=>{let c=new J(a),d=function(g){return[0,Dt(g)]}(c);s.push(e.get(d).next(f=>f?R.resolve():(g=>e.put({targetId:0,path:Dt(g),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>R.waitFor(s))})}si(t,e){t.createObjectStore("collectionParents",{keyPath:ip});let n=e.store("collectionParents"),i=new ei,s=a=>{if(i.add(a)){let u=a.lastSegment(),c=a.popLast();return n.put({collectionId:u,parent:Dt(c)})}};return e.store("remoteDocuments").J({H:!0},(a,u)=>{let c=new J(a);return s(c.popLast())}).next(()=>e.store("documentMutations").J({H:!0},([a,u,c],d)=>{let f=Kt(u);return s(f.popLast())}))}oi(t){let e=t.store("targets");return e.J((n,i)=>{let s=Or(i),a=uf(this.serializer,s);return e.put(a)})}_i(t,e){let n=e.store("remoteDocuments"),i=[];return n.J((s,a)=>{let u=e.store("remoteDocumentsV14"),c=function(g){return g.document?new M(J.fromString(g.document.name).popFirst(5)):g.noDocument?M.fromSegments(g.noDocument.path):g.unknownDocument?M.fromSegments(g.unknownDocument.path):L()}(a).path.toArray(),d={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(u.put(d))}).next(()=>R.waitFor(i))}ai(t,e){let n=e.store("mutations"),i=mf(this.serializer),s=new Ts(Es.Zr,this.serializer.ct);return n.U().next(a=>{let u=new Map;return a.forEach(c=>{var d;let f=(d=u.get(c.userId))!==null&&d!==void 0?d:$();Ye(this.serializer,c).keys().forEach(g=>f=f.add(g)),u.set(c.userId,f)}),R.forEach(u,(c,d)=>{let f=new pt(d),g=gs.lt(this.serializer,f),_=s.getIndexManager(f),S=ws.lt(f,this.serializer,_,s.referenceDelegate);return new Is(i,S,g,_).recalculateAndSaveOverlaysForDocumentKeys(new Gr(e,Mt.oe),c).next()})})}};function Jh(r){r.createObjectStore("targetDocuments",{keyPath:np}).createIndex("documentTargetsIndex",rp,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",ep,{unique:!0}),r.createObjectStore("targetGlobal")}var ra="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",pu=class r{constructor(t,e,n,i,s,a,u,c,d,f,g=17){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.ui=s,this.window=a,this.document=u,this.ci=d,this.li=f,this.hi=g,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=_=>Promise.resolve(),!r.D())throw new x(b.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ru(this,i),this.Ai=e+"main",this.serializer=new fs(c),this.Ri=new Se(this.Ai,this.hi,new gu(this.serializer)),this.$r=new Ga,this.Ur=new Za(this.referenceDelegate,this.serializer),this.remoteDocumentCache=mf(this.serializer),this.Gr=new ja,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,f===!1&&ct("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(b.FAILED_PRECONDITION,ra);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Ur.getHighestSequenceNumber(t))}).then(t=>{this.Qr=new Mt(t,this.ci)}).then(()=>{this.Kr=!0}).catch(t=>(this.Ri&&this.Ri.close(),Promise.reject(t)))}yi(t){return this.di=e=>V(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ri.L(e=>V(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.ui.enqueueAndForget(()=>V(this,null,function*(){this.started&&(yield this.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>$i(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(t).next(e=>{e||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(t)).next(e=>this.isPrimary&&!e?this.bi(t).next(()=>!1):!!e&&this.Di(t).next(()=>!0))).catch(t=>{if(Me(t))return C("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return C("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.ui.enqueueRetryable(()=>this.di(t)),this.isPrimary=t})}wi(t){return Nr(t).get("owner").next(e=>R.resolve(this.vi(e)))}Ci(t){return $i(t).delete(this.clientId)}Fi(){return V(this,null,function*(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=It(e,"clientMetadata");return n.U().next(i=>{let s=this.xi(i,18e5),a=i.filter(u=>s.indexOf(u)===-1);return R.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Vi)for(let e of t)this.Vi.removeItem(this.Oi(e.clientId))}})}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(t){return!!t&&t.ownerId===this.clientId}Si(t){return this.li?R.resolve(!0):Nr(t).get("owner").next(e=>{if(e!==null&&this.Mi(e.leaseTimestampMs,5e3)&&!this.Ni(e.ownerId)){if(this.vi(e)&&this.networkEnabled)return!0;if(!this.vi(e)){if(!e.allowTabSynchronization)throw new x(b.FAILED_PRECONDITION,ra);return!1}}return!(!this.networkEnabled||!this.inForeground)||$i(t).U().next(n=>this.xi(n,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||a&&u)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&C("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return V(this,null,function*(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),yield this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{let e=new Gr(t,Mt.oe);return this.bi(e).next(()=>this.Ci(e))}),this.Ri.close(),this.qi()})}xi(t,e){return t.filter(n=>this.Mi(n.updateTimeMs,e)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",t=>$i(t).U().next(e=>this.xi(e,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(t,e){return ws.lt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new Xa(t,this.serializer.ct.databaseId)}getDocumentOverlayCache(t){return gs.lt(this.serializer,t)}getBundleCache(){return this.Gr}runTransaction(t,e,n){C("IndexedDbPersistence","Starting transaction:",t);let i=e==="readonly"?"readonly":"readwrite",s=function(c){return c===17?mp:c===16?fp:c===15?cc:c===14?Id:c===13?vd:c===12?dp:c===11?wd:void L()}(this.hi),a;return this.Ri.runTransaction(t,i,s,u=>(a=new Gr(u,this.Qr?this.Qr.next():Mt.oe),e==="readwrite-primary"?this.wi(a).next(c=>!!c||this.Si(a)).next(c=>{if(!c)throw ct(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new x(b.FAILED_PRECONDITION,gd);return n(a)}).next(c=>this.Di(a).next(()=>c)):this.Ki(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ki(t){return Nr(t).get("owner").next(e=>{if(e!==null&&this.Mi(e.leaseTimestampMs,5e3)&&!this.Ni(e.ownerId)&&!this.vi(e)&&!(this.li||this.allowTabSynchronization&&e.allowTabSynchronization))throw new x(b.FAILED_PRECONDITION,ra)})}Di(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Nr(t).put("owner",e)}static D(){return Se.D()}bi(t){let e=Nr(t);return e.get("owner").next(n=>this.vi(n)?(C("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):R.resolve())}Mi(t,e){let n=Date.now();return!(t<n-e)&&(!(t>n)||(ct(`Detected an update time that is in the future: ${t} > ${n}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.Pi=()=>{this.Li();let e=/(?:Version|Mobile)\/1[456]/;Lo()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(t){var e;try{let n=((e=this.Vi)===null||e===void 0?void 0:e.getItem(this.Oi(t)))!==null;return C("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return ct("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(t){ct("Failed to set zombie client id.",t)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function Nr(r){return It(r,"owner")}function $i(r){return It(r,"clientMetadata")}function _c(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}var yu=class r{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.$i=n,this.Ui=i}static Wi(t,e){let n=$(),i=$();for(let s of e.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(t,e.fromCache,n,i)}};var _u=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var As=class{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Lo()?8:pd(Rr())>0?6:4}()}initialize(t,e){this.Ji=t,this.indexManager=e,this.Gi=!0}getDocumentsMatchingQuery(t,e,n,i){let s={result:null};return this.Yi(t,e).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Zi(t,e,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new _u;return this.Xi(t,e,a).next(u=>{if(s.result=u,this.zi)return this.es(t,e,a,u.size)})}).next(()=>s.result)}es(t,e,n,i){return n.documentReadCount<this.ji?(Pn()<=$t.DEBUG&&C("QueryEngine","SDK will not create cache indexes for query:",bn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),R.resolve()):(Pn()<=$t.DEBUG&&C("QueryEngine","Query:",bn(e),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?(Pn()<=$t.DEBUG&&C("QueryEngine","The SDK decides to create cache indexes for query:",bn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,kt(e))):R.resolve())}Yi(t,e){if(Eh(e))return R.resolve(null);let n=kt(e);return this.indexManager.getIndexType(t,n).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=cs(e,null,"F"),n=kt(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(s=>{let a=$(...s);return this.Ji.getDocuments(t,a).next(u=>this.indexManager.getMinOffset(t,n).next(c=>{let d=this.ts(e,u);return this.ns(e,d,a,c.readTime)?this.Yi(t,cs(e,null,"F")):this.rs(t,d,e,c)}))})))}Zi(t,e,n,i){return Eh(e)||i.isEqual(q.min())?R.resolve(null):this.Ji.getDocuments(t,n).next(s=>{let a=this.ts(e,s);return this.ns(e,a,n,i)?R.resolve(null):(Pn()<=$t.DEBUG&&C("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),bn(e)),this.rs(t,a,e,fd(i,-1)).next(u=>u))})}ts(t,e){let n=new nt(Nd(t));return e.forEach((i,s)=>{fi(t,s)&&(n=n.add(s))}),n}ns(t,e,n,i){if(t.limit===null)return!1;if(n.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(t,e,n){return Pn()<=$t.DEBUG&&C("QueryEngine","Using full collection scan to execute query:",bn(e)),this.Ji.getDocumentsMatchingQuery(t,e,qt.min(),n)}rs(t,e,n,i){return this.Ji.getDocumentsMatchingQuery(t,n,i).next(s=>(e.forEach(a=>{s=s.insert(a.key,a)}),s))}};var wu=class{constructor(t,e,n,i){this.persistence=t,this.ss=e,this.serializer=i,this.os=new it(G),this._s=new Zt(s=>on(s),hi),this.us=new Map,this.cs=t.getRemoteDocumentCache(),this.Ur=t.getTargetCache(),this.Gr=t.getBundleCache(),this.ls(n)}ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Is(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.os))}};function gf(r,t,e,n){return new wu(r,t,e,n)}function pf(r,t){return V(this,null,function*(){let e=O(r);return yield e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,e.ls(t),e.mutationQueue.getAllMutationBatches(n))).next(s=>{let a=[],u=[],c=$();for(let d of i){a.push(d.batchId);for(let f of d.mutations)c=c.add(f.key)}for(let d of s){u.push(d.batchId);for(let f of d.mutations)c=c.add(f.key)}return e.localDocuments.getDocuments(n,c).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:u}))})})})}function Qp(r,t){let e=O(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=t.batch.keys(),s=e.cs.newChangeBuffer({trackRemovals:!0});return function(u,c,d,f){let g=d.batch,_=g.keys(),S=R.resolve();return _.forEach(k=>{S=S.next(()=>f.getEntry(c,k)).next(N=>{let D=d.docVersions.get(k);U(D!==null),N.version.compareTo(D)<0&&(g.applyToRemoteDocument(N,d),N.isValidDocument()&&(N.setReadTime(d.commitVersion),f.addEntry(N)))})}),S.next(()=>u.mutationQueue.removeMutationBatch(c,g))}(e,n,t,s).next(()=>s.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=$();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(c=c.add(u.batch.mutations[d].key));return c}(t))).next(()=>e.localDocuments.getDocuments(n,i))})}function yf(r){let t=O(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ur.getLastRemoteSnapshotVersion(e))}function Wp(r,t){let e=O(r),n=t.snapshotVersion,i=e.os;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=e.cs.newChangeBuffer({trackRemovals:!0});i=e.os;let u=[];t.targetChanges.forEach((f,g)=>{let _=i.get(g);if(!_)return;u.push(e.Ur.removeMatchingKeys(s,f.removedDocuments,g).next(()=>e.Ur.addMatchingKeys(s,f.addedDocuments,g)));let S=_.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(g)!==null?S=S.withResumeToken(ft.EMPTY_BYTE_STRING,q.min()).withLastLimboFreeSnapshotVersion(q.min()):f.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(f.resumeToken,n)),i=i.insert(g,S),function(N,D,z){return N.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=3e8?!0:z.addedDocuments.size+z.modifiedDocuments.size+z.removedDocuments.size>0}(_,S,f)&&u.push(e.Ur.updateTargetData(s,S))});let c=Ft(),d=$();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(_f(s,a,t.documentUpdates).next(f=>{c=f.Ps,d=f.Is})),!n.isEqual(q.min())){let f=e.Ur.getLastRemoteSnapshotVersion(s).next(g=>e.Ur.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return R.waitFor(u).next(()=>a.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,c,d)).next(()=>c)}).then(s=>(e.os=i,s))}function _f(r,t,e){let n=$(),i=$();return e.forEach(s=>n=n.add(s)),t.getEntries(r,n).next(s=>{let a=Ft();return e.forEach((u,c)=>{let d=s.get(u);c.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(q.min())?(t.removeEntry(u,c.readTime),a=a.insert(u,c)):!d.isValidDocument()||c.version.compareTo(d.version)>0||c.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(c),a=a.insert(u,c)):C("LocalStore","Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",c.version)}),{Ps:a,Is:i}})}function Hp(r,t){let e=O(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function Qn(r,t){let e=O(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return e.Ur.getTargetData(n,t).next(s=>s?(i=s,R.resolve(i)):e.Ur.allocateTargetId(n).next(a=>(i=new $n(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.Ur.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=e.os.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.os=e.os.insert(n.targetId,n),e._s.set(t,n.targetId)),n})}function Wn(r,t,e){return V(this,null,function*(){let n=O(r),i=n.os.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Me(a))throw a;C("LocalStore",`Failed to update sequence numbers for target ${t}: ${a}`)}n.os=n.os.remove(t),n._s.delete(i.target)})}function Ss(r,t,e){let n=O(r),i=q.min(),s=$();return n.persistence.runTransaction("Execute query","readwrite",a=>function(c,d,f){let g=O(c),_=g._s.get(f);return _!==void 0?R.resolve(g.os.get(_)):g.Ur.getTargetData(d,f)}(n,a,kt(t)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(a,u.targetId).next(c=>{s=c})}).next(()=>n.ss.getDocumentsMatchingQuery(a,t,e?i:q.min(),e?s:$())).next(u=>(If(n,kd(t),u),{documents:u,Ts:s})))}function wf(r,t){let e=O(r),n=O(e.Ur),i=e.os.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,t).next(a=>a?a.target:null))}function vf(r,t){let e=O(r),n=e.us.get(t)||q.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.cs.getAllFromCollectionGroup(i,t,fd(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(If(e,t,i),i))}function If(r,t,e){let n=r.us.get(t)||q.min();e.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.us.set(t,n)}function Jp(r,t,e,n){return V(this,null,function*(){let i=O(r),s=$(),a=Ft();for(let d of e){let f=t.Es(d.metadata.name);d.document&&(s=s.add(f));let g=t.ds(d);g.setReadTime(t.As(d.metadata.readTime)),a=a.insert(f,g)}let u=i.cs.newChangeBuffer({trackRemovals:!0}),c=yield Qn(i,function(f){return kt(nr(J.fromString(`__bundle__/docs/${f}`)))}(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",d=>_f(d,u,a).next(f=>(u.apply(d),f)).next(f=>i.Ur.removeMatchingKeysForTargetId(d,c.targetId).next(()=>i.Ur.addMatchingKeys(d,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,f.Ps,f.Is)).next(()=>f.Ps)))})}function Yp(n,i){return V(this,arguments,function*(r,t,e=$()){let s=yield Qn(r,kt(pc(t.bundledQuery))),a=O(r);return a.persistence.runTransaction("Save named query","readwrite",u=>{let c=ht(t.readTime);if(s.snapshotVersion.compareTo(c)>=0)return a.Gr.saveNamedQuery(u,t);let d=s.withResumeToken(ft.EMPTY_BYTE_STRING,c);return a.os=a.os.insert(d.targetId,d),a.Ur.updateTargetData(u,d).next(()=>a.Ur.removeMatchingKeysForTargetId(u,s.targetId)).next(()=>a.Ur.addMatchingKeys(u,e,s.targetId)).next(()=>a.Gr.saveNamedQuery(u,t))})})}function Yh(r,t){return`firestore_clients_${r}_${t}`}function Xh(r,t,e){let n=`firestore_mutations_${r}_${e}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}function ia(r,t){return`firestore_targets_${r}_${t}`}var Rs=class r{constructor(t,e,n,i){this.user=t,this.batchId=e,this.state=n,this.error=i}static Rs(t,e,n){let i=JSON.parse(n),s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new x(i.error.code,i.error.message))),a?new r(t,e,i.state,s):(ct("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Vs(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},qr=class r{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Rs(t,e){let n=JSON.parse(e),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new x(n.error.code,n.error.message))),s?new r(t,n.state,i):(ct("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Vs(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Ps=class r{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Rs(t,e){let n=JSON.parse(e),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=fc();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=yd(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new r(t,s):(ct("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}},vu=class r{constructor(t,e){this.clientId=t,this.onlineState=e}static Rs(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new r(e.clientId,e.onlineState):(ct("SharedClientState",`Failed to parse online state: ${t}`),null)}},ri=class{constructor(){this.activeTargetIds=fc()}fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Vs(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},Br=class{constructor(t,e,n,i,s){this.window=t,this.ui=e,this.persistenceKey=n,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new it(G),this.started=!1,this.bs=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=Yh(this.persistenceKey,this.ps),this.vs=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new ri),this.Cs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.xs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(t){return!(!t||!t.localStorage)}start(){return V(this,null,function*(){let t=yield this.syncEngine.Qi();for(let n of t){if(n===this.ps)continue;let i=this.getItem(Yh(this.persistenceKey,n));if(i){let s=Ps.Rs(n,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();let e=this.storage.getItem(this.xs);if(e){let n=this.Ls(e);n&&this.Bs(n)}for(let n of this.bs)this.ws(n);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.vs,JSON.stringify(t))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(t){let e=!1;return this.Ss.forEach((n,i)=>{i.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.qs(t,"pending")}updateMutationState(t,e,n){this.qs(t,e,n),this.Qs(t)}addLocalQueryTarget(t,e=!0){let n="not-current";if(this.isActiveQueryTarget(t)){let i=this.storage.getItem(ia(this.persistenceKey,t));if(i){let s=qr.Rs(t,i);s&&(n=s.state)}}return e&&this.Ks.fs(t),this.Ns(),n}removeLocalQueryTarget(t){this.Ks.gs(t),this.Ns()}isLocalQueryTarget(t){return this.Ks.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(ia(this.persistenceKey,t))}updateQueryState(t,e,n){this.$s(t,e,n)}handleUserChange(t,e,n){e.forEach(i=>{this.Qs(i)}),this.currentUser=t,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(t){this.Us(t)}notifyBundleLoaded(t){this.Ws(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return C("SharedClientState","READ",t,e),e}setItem(t,e){C("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){C("SharedClientState","REMOVE",t),this.storage.removeItem(t)}ws(t){let e=t;if(e.storageArea===this.storage){if(C("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Ds)return void ct("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(()=>V(this,null,function*(){if(this.started){if(e.key!==null){if(this.Cs.test(e.key)){if(e.newValue==null){let n=this.Gs(e.key);return this.zs(n,null)}{let n=this.js(e.key,e.newValue);if(n)return this.zs(n.clientId,n)}}else if(this.Fs.test(e.key)){if(e.newValue!==null){let n=this.Hs(e.key,e.newValue);if(n)return this.Js(n)}}else if(this.Ms.test(e.key)){if(e.newValue!==null){let n=this.Ys(e.key,e.newValue);if(n)return this.Zs(n)}}else if(e.key===this.xs){if(e.newValue!==null){let n=this.Ls(e.newValue);if(n)return this.Bs(n)}}else if(e.key===this.vs){let n=function(s){let a=Mt.oe;if(s!=null)try{let u=JSON.parse(s);U(typeof u=="number"),a=u}catch(u){ct("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(e.newValue);n!==Mt.oe&&this.sequenceNumberHandler(n)}else if(e.key===this.Os){let n=this.Xs(e.newValue);yield Promise.all(n.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(e)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(t,e,n){let i=new Rs(this.currentUser,t,e,n),s=Xh(this.persistenceKey,this.currentUser,t);this.setItem(s,i.Vs())}Qs(t){let e=Xh(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Us(t){let e={clientId:this.ps,onlineState:t};this.storage.setItem(this.xs,JSON.stringify(e))}$s(t,e,n){let i=ia(this.persistenceKey,t),s=new qr(t,e,n);this.setItem(i,s.Vs())}Ws(t){let e=JSON.stringify(Array.from(t));this.setItem(this.Os,e)}Gs(t){let e=this.Cs.exec(t);return e?e[1]:null}js(t,e){let n=this.Gs(t);return Ps.Rs(n,e)}Hs(t,e){let n=this.Fs.exec(t),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return Rs.Rs(new pt(s),i,e)}Ys(t,e){let n=this.Ms.exec(t),i=Number(n[1]);return qr.Rs(i,e)}Ls(t){return vu.Rs(t)}Xs(t){return JSON.parse(t)}Js(t){return V(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.no(t.batchId,t.state,t.error);C("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)})}Zs(t){return this.syncEngine.ro(t.targetId,t.state,t.error)}zs(t,e){let n=e?this.Ss.insert(t,e):this.Ss.remove(t),i=this.ks(this.Ss),s=this.ks(n),a=[],u=[];return s.forEach(c=>{i.has(c)||a.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.io(a,u).then(()=>{this.Ss=n})}Bs(t){this.Ss.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}ks(t){let e=fc();return t.forEach((n,i)=>{e=e.unionWith(i.activeTargetIds)}),e}},bs=class{constructor(){this.so=new ri,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.so.fs(t),this.oo[t]||"not-current"}updateQueryState(t,e,n){this.oo[t]=e}removeLocalQueryTarget(t){this.so.gs(t)}isLocalQueryTarget(t){return this.so.activeTargetIds.has(t)}clearQueryState(t){delete this.oo[t]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(t){return this.so.activeTargetIds.has(t)}start(){return this.so=new ri,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Iu=class{_o(t){}shutdown(){}};var Vs=class{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(t){this.ho.push(t)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){C("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.ho)t(0)}lo(){C("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.ho)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ki=null;function sa(){return Ki===null?Ki=function(){return 268435456+Math.round(2147483648*Math.random())}():Ki++,"0x"+Ki.toString(16)}var Xp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Tu=class{constructor(t){this.Io=t.Io,this.To=t.To}Eo(t){this.Ao=t}Ro(t){this.Vo=t}mo(t){this.fo=t}onMessage(t){this.po=t}close(){this.To()}send(t){this.Io(t)}yo(){this.Ao()}wo(){this.Vo()}So(t){this.fo(t)}bo(t){this.po(t)}};var bt="WebChannelConnection",Eu=class extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let n=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+e.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(e,n,i,s,a){let u=sa(),c=this.xo(e,n.toUriEncodedString());C("RestConnection",`Sending RPC '${e}' ${u}:`,c,i);let d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,s,a),this.No(e,c,d,i).then(f=>(C("RestConnection",`Received RPC '${e}' ${u}: `,f),f),f=>{throw oe("RestConnection",`RPC '${e}' ${u} failed with error: `,f,"url: ",c,"request:",i),f})}Lo(e,n,i,s,a,u){return this.Mo(e,n,i,s,a)}Oo(e,n,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+er}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>e[a]=s),i&&i.headers.forEach((s,a)=>e[a]=s)}xo(e,n){let i=Xp[e];return`${this.Do}/v1/${n}:${i}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}No(t,e,n,i){let s=sa();return new Promise((a,u)=>{let c=new Yo;c.setWithCredentials(!0),c.listenOnce(Xo.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Cr.NO_ERROR:let f=c.getResponseJson();C(bt,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(f)),a(f);break;case Cr.TIMEOUT:C(bt,`RPC '${t}' ${s} timed out`),u(new x(b.DEADLINE_EXCEEDED,"Request time out"));break;case Cr.HTTP_ERROR:let g=c.getStatus();if(C(bt,`RPC '${t}' ${s} failed with status:`,g,"response text:",c.getResponseText()),g>0){let _=c.getResponseJson();Array.isArray(_)&&(_=_[0]);let S=_?.error;if(S&&S.status&&S.message){let k=function(D){let z=D.toLowerCase().replace(/_/g,"-");return Object.values(b).indexOf(z)>=0?z:b.UNKNOWN}(S.status);u(new x(k,S.message))}else u(new x(b.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new x(b.UNAVAILABLE,"Connection failed."));break;default:L()}}finally{C(bt,`RPC '${t}' ${s} completed.`)}});let d=JSON.stringify(i);C(bt,`RPC '${t}' ${s} sending request:`,i),c.send(e,"POST",d,n,15)})}Bo(t,e,n){let i=sa(),s=[this.Do,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=ea(),u=ta(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(c.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,e,n),c.encodeInitMessageHeaders=!0;let f=s.join("");C(bt,`Creating RPC '${t}' stream ${i}: ${f}`,c);let g=a.createWebChannel(f,c),_=!1,S=!1,k=new Tu({Io:D=>{S?C(bt,`Not sending because RPC '${t}' stream ${i} is closed:`,D):(_||(C(bt,`Opening RPC '${t}' stream ${i} transport.`),g.open(),_=!0),C(bt,`RPC '${t}' stream ${i} sending:`,D),g.send(D))},To:()=>g.close()}),N=(D,z,j)=>{D.listen(z,B=>{try{j(B)}catch(W){setTimeout(()=>{throw W},0)}})};return N(g,Tn.EventType.OPEN,()=>{S||(C(bt,`RPC '${t}' stream ${i} transport opened.`),k.yo())}),N(g,Tn.EventType.CLOSE,()=>{S||(S=!0,C(bt,`RPC '${t}' stream ${i} transport closed`),k.So())}),N(g,Tn.EventType.ERROR,D=>{S||(S=!0,oe(bt,`RPC '${t}' stream ${i} transport errored:`,D),k.So(new x(b.UNAVAILABLE,"The operation could not be completed")))}),N(g,Tn.EventType.MESSAGE,D=>{var z;if(!S){let j=D.data[0];U(!!j);let B=j,W=B.error||((z=B[0])===null||z===void 0?void 0:z.error);if(W){C(bt,`RPC '${t}' stream ${i} received error:`,W);let Z=W.status,K=function(w){let I=mt[w];if(I!==void 0)return Qd(I)}(Z),v=W.message;K===void 0&&(K=b.INTERNAL,v="Unknown error status: "+Z+" with message "+W.message),S=!0,k.So(new x(K,v)),g.close()}else C(bt,`RPC '${t}' stream ${i} received:`,j),k.bo(j)}}),N(u,Zo.STAT_EVENT,D=>{D.stat===zi.PROXY?C(bt,`RPC '${t}' stream ${i} detected buffering proxy`):D.stat===zi.NOPROXY&&C(bt,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{k.wo()},0),k}};function Tf(){return typeof window<"u"?window:null}function Yi(){return typeof document<"u"?document:null}function mi(r){return new La(r,!0)}var ii=class{constructor(t,e,n=1e3,i=1.5,s=6e4){this.ui=t,this.timerId=e,this.ko=n,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(t){this.cancel();let e=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,e-n);i>0&&C("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),t())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}};var Cs=class{constructor(t,e,n,i,s,a,u,c){this.ui=t,this.Ho=n,this.Jo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new ii(t,e)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return V(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(t){this.u_(),this.stream.send(t)}__(){return V(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(t,e){return V(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,t!==4?this.t_.reset():e&&e.code===b.RESOURCE_EXHAUSTED?(ct(e.toString()),ct("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):e&&e.code===b.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.mo(e)})}l_(){}auth(){this.state=1;let t=this.h_(this.Yo),e=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Yo===e&&this.P_(n,i)},n=>{t(()=>{let i=new x(b.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(i)})})}P_(t,e){let n=this.h_(this.Yo);this.stream=this.T_(t,e),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{n(()=>this.I_(i))}),this.stream.onMessage(i=>{n(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(()=>V(this,null,function*(){this.state=0,this.start()}))}I_(t){return C("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}h_(t){return e=>{this.ui.enqueueAndForget(()=>this.Yo===t?e():(C("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Au=class extends Cs{constructor(t,e,n,i,s,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}T_(t,e){return this.connection.Bo("Listen",t,e)}E_(t){return this.onNext(t)}onNext(t){this.t_.reset();let e=Op(this.serializer,t),n=function(s){if(!("targetChange"in s))return q.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?q.min():a.readTime?ht(a.readTime):q.min()}(t);return this.listener.d_(e,n)}A_(t){let e={};e.database=Ba(this.serializer),e.addTarget=function(s,a){let u,c=a.target;if(u=as(c)?{documents:ef(s,c)}:{query:nf(s,c)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Hd(s,a.resumeToken);let d=Ua(s,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(q.min())>0){u.readTime=Gn(s,a.snapshotVersion.toTimestamp());let d=Ua(s,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,t);let n=Lp(this.serializer,t);n&&(e.labels=n),this.a_(e)}R_(t){let e={};e.database=Ba(this.serializer),e.removeTarget=t,this.a_(e)}},Su=class extends Cs{constructor(t,e,n,i,s,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(t,e){return this.connection.Bo("Write",t,e)}E_(t){return U(!!t.streamToken),this.lastStreamToken=t.streamToken,U(!t.writeResults||t.writeResults.length===0),this.listener.f_()}onNext(t){U(!!t.streamToken),this.lastStreamToken=t.streamToken,this.t_.reset();let e=Mp(t.writeResults,t.commitTime),n=ht(t.commitTime);return this.listener.g_(n,e)}p_(){let t={};t.database=Ba(this.serializer),this.a_(t)}m_(t){let e={streamToken:this.lastStreamToken,writes:t.map(n=>ti(this.serializer,n))};this.a_(e)}};var Ru=class extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new x(b.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(t,e,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Mo(t,qa(e,n),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new x(b.UNKNOWN,s.toString())})}Lo(t,e,n,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Lo(t,qa(e,n),i,a,u,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(b.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}},Pu=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(t){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.C_("Offline")))}set(t){this.x_(),this.S_=0,t==="Online"&&(this.D_=!1),this.C_(t)}C_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}F_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(ct(e),this.D_=!1):C("OnlineStateTracker",e)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}};var bu=class{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(a=>{n.enqueueAndForget(()=>V(this,null,function*(){Le(this)&&(C("RemoteStore","Restarting streams for network reachability change."),yield function(c){return V(this,null,function*(){let d=O(c);d.L_.add(4),yield rr(d),d.q_.set("Unknown"),d.L_.delete(4),yield gi(d)})}(this))}))}),this.q_=new Pu(n,i)}};function gi(r){return V(this,null,function*(){if(Le(r))for(let t of r.B_)yield t(!0)})}function rr(r){return V(this,null,function*(){for(let t of r.B_)yield t(!1)})}function Ys(r,t){let e=O(r);e.N_.has(t.targetId)||(e.N_.set(t.targetId,t),Ic(e)?vc(e):sr(e).r_()&&wc(e,t))}function Hn(r,t){let e=O(r),n=sr(e);e.N_.delete(t),n.r_()&&Ef(e,t),e.N_.size===0&&(n.r_()?n.o_():Le(e)&&e.q_.set("Unknown"))}function wc(r,t){if(r.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(q.min())>0){let e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}sr(r).A_(t)}function Ef(r,t){r.Q_.xe(t),sr(r).R_(t)}function vc(r){r.Q_=new Ma({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>r.N_.get(t)||null,tt:()=>r.datastore.serializer.databaseId}),sr(r).start(),r.q_.v_()}function Ic(r){return Le(r)&&!sr(r).n_()&&r.N_.size>0}function Le(r){return O(r).L_.size===0}function Af(r){r.Q_=void 0}function Zp(r){return V(this,null,function*(){r.q_.set("Online")})}function ty(r){return V(this,null,function*(){r.N_.forEach((t,e)=>{wc(r,t)})})}function ey(r,t){return V(this,null,function*(){Af(r),Ic(r)?(r.q_.M_(t),vc(r)):r.q_.set("Unknown")})}function ny(r,t,e){return V(this,null,function*(){if(r.q_.set("Online"),t instanceof hs&&t.state===2&&t.cause)try{yield function(i,s){return V(this,null,function*(){let a=s.cause;for(let u of s.targetIds)i.N_.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.N_.delete(u),i.Q_.removeTarget(u))})}(r,t)}catch(n){C("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield xs(r,n)}else if(t instanceof Fn?r.Q_.Ke(t):t instanceof ls?r.Q_.He(t):r.Q_.We(t),!e.isEqual(q.min()))try{let n=yield yf(r.localStore);e.compareTo(n)>=0&&(yield function(s,a){let u=s.Q_.rt(a);return u.targetChanges.forEach((c,d)=>{if(c.resumeToken.approximateByteSize()>0){let f=s.N_.get(d);f&&s.N_.set(d,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,d)=>{let f=s.N_.get(c);if(!f)return;s.N_.set(c,f.withResumeToken(ft.EMPTY_BYTE_STRING,f.snapshotVersion)),Ef(s,c);let g=new $n(f.target,c,d,f.sequenceNumber);wc(s,g)}),s.remoteSyncer.applyRemoteEvent(u)}(r,e))}catch(n){C("RemoteStore","Failed to raise snapshot:",n),yield xs(r,n)}})}function xs(r,t,e){return V(this,null,function*(){if(!Me(t))throw t;r.L_.add(1),yield rr(r),r.q_.set("Offline"),e||(e=()=>yf(r.localStore)),r.asyncQueue.enqueueRetryable(()=>V(this,null,function*(){C("RemoteStore","Retrying IndexedDB access"),yield e(),r.L_.delete(1),yield gi(r)}))})}function Sf(r,t){return t().catch(e=>xs(r,e,t))}function ir(r){return V(this,null,function*(){let t=O(r),e=De(t),n=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;ry(t);)try{let i=yield Hp(t.localStore,n);if(i===null){t.O_.length===0&&e.o_();break}n=i.batchId,iy(t,i)}catch(i){yield xs(t,i)}Rf(t)&&Pf(t)})}function ry(r){return Le(r)&&r.O_.length<10}function iy(r,t){r.O_.push(t);let e=De(r);e.r_()&&e.V_&&e.m_(t.mutations)}function Rf(r){return Le(r)&&!De(r).n_()&&r.O_.length>0}function Pf(r){De(r).start()}function sy(r){return V(this,null,function*(){De(r).p_()})}function oy(r){return V(this,null,function*(){let t=De(r);for(let e of r.O_)t.m_(e.mutations)})}function ay(r,t,e){return V(this,null,function*(){let n=r.O_.shift(),i=Na.from(n,t,e);yield Sf(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield ir(r)})}function uy(r,t){return V(this,null,function*(){t&&De(r).V_&&(yield function(n,i){return V(this,null,function*(){if(function(a){return Kd(a)&&a!==b.ABORTED}(i.code)){let s=n.O_.shift();De(n).s_(),yield Sf(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield ir(n)}})}(r,t)),Rf(r)&&Pf(r)})}function Zh(r,t){return V(this,null,function*(){let e=O(r);e.asyncQueue.verifyOperationInProgress(),C("RemoteStore","RemoteStore received new credentials");let n=Le(e);e.L_.add(3),yield rr(e),n&&e.q_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.L_.delete(3),yield gi(e)})}function Vu(r,t){return V(this,null,function*(){let e=O(r);t?(e.L_.delete(2),yield gi(e)):t||(e.L_.add(2),yield rr(e),e.q_.set("Unknown"))})}function sr(r){return r.K_||(r.K_=function(e,n,i){let s=O(e);return s.w_(),new Au(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:Zp.bind(null,r),Ro:ty.bind(null,r),mo:ey.bind(null,r),d_:ny.bind(null,r)}),r.B_.push(t=>V(this,null,function*(){t?(r.K_.s_(),Ic(r)?vc(r):r.q_.set("Unknown")):(yield r.K_.stop(),Af(r))}))),r.K_}function De(r){return r.U_||(r.U_=function(e,n,i){let s=O(e);return s.w_(),new Su(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:sy.bind(null,r),mo:uy.bind(null,r),f_:oy.bind(null,r),g_:ay.bind(null,r)}),r.B_.push(t=>V(this,null,function*(){t?(r.U_.s_(),yield ir(r)):(yield r.U_.stop(),r.O_.length>0&&(C("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))}))),r.U_}var Cu=class r{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new wt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,i,s){let a=Date.now()+n,u=new r(t,e,a,i,s);return u.start(n),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(b.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function or(r,t){if(ct("AsyncQueue",`${t}: ${r}`),Me(r))return new x(b.UNAVAILABLE,`${t}: ${r}`);throw r}var Ds=class r{constructor(t){this.comparator=t?(e,n)=>t(e,n)||M.comparator(e.key,n.key):(e,n)=>M.comparator(e.key,n.key),this.keyedMap=Fr(),this.sortedSet=new it(this.comparator)}static emptySet(t){return new r(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let n=new r;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}};var ks=class{constructor(){this.W_=new it(M.comparator)}track(t){let e=t.doc.key,n=this.W_.get(e);n?t.type!==0&&n.type===3?this.W_=this.W_.insert(e,t):t.type===3&&n.type!==1?this.W_=this.W_.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.W_=this.W_.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.W_=this.W_.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.W_=this.W_.remove(e):t.type===1&&n.type===2?this.W_=this.W_.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.W_=this.W_.insert(e,{type:2,doc:t.doc}):L():this.W_=this.W_.insert(e,t)}G_(){let t=[];return this.W_.inorderTraversal((e,n)=>{t.push(n)}),t}},Jn=class r{constructor(t,e,n,i,s,a,u,c,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,i,s){let a=[];return e.forEach(u=>{a.push({type:0,doc:u})}),new r(t,e,Ds.emptySet(e),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&di(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==n[i].type||!e[i].doc.isEqual(n[i].doc))return!1;return!0}};var xu=class{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(t=>t.J_())}},Du=class{constructor(){this.queries=td(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(e,n){let i=O(e),s=i.queries;i.queries=td(),s.forEach((a,u)=>{for(let c of u.j_)c.onError(n)})})(this,new x(b.ABORTED,"Firestore shutting down"))}};function td(){return new Zt(r=>Dd(r),di)}function Tc(r,t){return V(this,null,function*(){let e=O(r),n=3,i=t.query,s=e.queries.get(i);s?!s.H_()&&t.J_()&&(n=2):(s=new xu,n=t.J_()?0:1);try{switch(n){case 0:s.z_=yield e.onListen(i,!0);break;case 1:s.z_=yield e.onListen(i,!1);break;case 2:yield e.onFirstRemoteStoreListen(i)}}catch(a){let u=or(a,`Initialization of query '${bn(t.query)}' failed`);return void t.onError(u)}e.queries.set(i,s),s.j_.push(t),t.Z_(e.onlineState),s.z_&&t.X_(s.z_)&&Ac(e)})}function Ec(r,t){return V(this,null,function*(){let e=O(r),n=t.query,i=3,s=e.queries.get(n);if(s){let a=s.j_.indexOf(t);a>=0&&(s.j_.splice(a,1),s.j_.length===0?i=t.J_()?0:1:!s.H_()&&t.J_()&&(i=2))}switch(i){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}})}function cy(r,t){let e=O(r),n=!1;for(let i of t){let s=i.query,a=e.queries.get(s);if(a){for(let u of a.j_)u.X_(i)&&(n=!0);a.z_=i}}n&&Ac(e)}function ly(r,t,e){let n=O(r),i=n.queries.get(t);if(i)for(let s of i.j_)s.onError(e);n.queries.delete(t)}function Ac(r){r.Y_.forEach(t=>{t.next()})}var ku,ed;(ed=ku||(ku={})).ea="default",ed.Cache="cache";var si=class{constructor(t,e,n){this.query=t,this.ta=e,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(t){if(!this.options.includeMetadataChanges){let n=[];for(let i of t.docChanges)i.type!==3&&n.push(i);t=new Jn(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.na?this.ia(t)&&(this.ta.next(t),e=!0):this.sa(t,this.onlineState)&&(this.oa(t),e=!0),this.ra=t,e}onError(t){this.ta.error(t)}Z_(t){this.onlineState=t;let e=!1;return this.ra&&!this.na&&this.sa(this.ra,t)&&(this.oa(this.ra),e=!0),e}sa(t,e){if(!t.fromCache||!this.J_())return!0;let n=e!=="Offline";return(!this.options._a||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}ia(t){if(t.docChanges.length>0)return!0;let e=this.ra&&this.ra.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}oa(t){t=Jn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.na=!0,this.ta.next(t)}J_(){return this.options.source!==ku.Cache}};var Nu=class{constructor(t,e){this.aa=t,this.byteLength=e}ua(){return"metadata"in this.aa}};var Ns=class{constructor(t){this.serializer=t}Es(t){return Ht(this.serializer,t)}ds(t){return t.metadata.exists?tf(this.serializer,t.document,!1):yt.newNoDocument(this.Es(t.metadata.name),this.As(t.metadata.readTime))}As(t){return ht(t)}},Fu=class{constructor(t,e,n){this.ca=t,this.localStore=e,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=bf(t)}la(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.aa.namedQuery)this.queries.push(t.aa.namedQuery);else if(t.aa.documentMetadata){this.documents.push({metadata:t.aa.documentMetadata}),t.aa.documentMetadata.exists||++e;let n=J.fromString(t.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.aa.document&&(this.documents[this.documents.length-1].document=t.aa.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}ha(t){let e=new Map,n=new Ns(this.serializer);for(let i of t)if(i.metadata.queries){let s=n.Es(i.metadata.name);for(let a of i.metadata.queries){let u=(e.get(a)||$()).add(s);e.set(a,u)}}return e}complete(){return V(this,null,function*(){let t=yield Jp(this.localStore,new Ns(this.serializer),this.documents,this.ca.id),e=this.ha(this.documents);for(let n of this.queries)yield Yp(this.localStore,n,e.get(n.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:t}})}};function bf(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var Fs=class{constructor(t){this.key=t}},Os=class{constructor(t){this.key=t}},Ms=class{constructor(t,e){this.query=t,this.Ta=e,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=$(),this.mutatedKeys=$(),this.Aa=Nd(t),this.Ra=new Ds(this.Aa)}get Va(){return this.Ta}ma(t,e){let n=e?e.fa:new ks,i=e?e.Ra:this.Ra,s=e?e.mutatedKeys:this.mutatedKeys,a=i,u=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((f,g)=>{let _=i.get(f),S=fi(this.query,g)?g:null,k=!!_&&this.mutatedKeys.has(_.key),N=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations),D=!1;_&&S?_.data.isEqual(S.data)?k!==N&&(n.track({type:3,doc:S}),D=!0):this.ga(_,S)||(n.track({type:2,doc:S}),D=!0,(c&&this.Aa(S,c)>0||d&&this.Aa(S,d)<0)&&(u=!0)):!_&&S?(n.track({type:0,doc:S}),D=!0):_&&!S&&(n.track({type:1,doc:_}),D=!0,(c||d)&&(u=!0)),D&&(S?(a=a.add(S),s=N?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ra:a,fa:n,ns:u,mutatedKeys:s}}ga(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,i){let s=this.Ra;this.Ra=t.Ra,this.mutatedKeys=t.mutatedKeys;let a=t.fa.G_();a.sort((f,g)=>function(S,k){let N=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L()}};return N(S)-N(k)}(f.type,g.type)||this.Aa(f.doc,g.doc)),this.pa(n),i=i!=null&&i;let u=e&&!i?this.ya():[],c=this.da.size===0&&this.current&&!i?1:0,d=c!==this.Ea;return this.Ea=c,a.length!==0||d?{snapshot:new Jn(this.query,t.Ra,s,a,t.mutatedKeys,c===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new ks,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(t){return!this.Ta.has(t)&&!!this.Ra.has(t)&&!this.Ra.get(t).hasLocalMutations}pa(t){t&&(t.addedDocuments.forEach(e=>this.Ta=this.Ta.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ta=this.Ta.delete(e)),this.current=t.current)}ya(){if(!this.current)return[];let t=this.da;this.da=$(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});let e=[];return t.forEach(n=>{this.da.has(n)||e.push(new Os(n))}),this.da.forEach(n=>{t.has(n)||e.push(new Fs(n))}),e}ba(t){this.Ta=t.Ts,this.da=$();let e=this.ma(t.documents);return this.applyChanges(e,!0)}Da(){return Jn.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}},Ou=class{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}},Mu=class{constructor(t){this.key=t,this.va=!1}},Lu=class{constructor(t,e,n,i,s,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new Zt(u=>Dd(u),di),this.Ma=new Map,this.xa=new Set,this.Oa=new it(M.comparator),this.Na=new Map,this.La=new ni,this.Ba={},this.ka=new Map,this.qa=Kn.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}};function hy(r,t,e=!0){return V(this,null,function*(){let n=Xs(r),i,s=n.Fa.get(t);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield Vf(n,t,e,!0),i})}function dy(r,t){return V(this,null,function*(){let e=Xs(r);yield Vf(e,t,!0,!1)})}function Vf(r,t,e,n){return V(this,null,function*(){let i=yield Qn(r.localStore,kt(t)),s=i.targetId,a=r.sharedClientState.addLocalQueryTarget(s,e),u;return n&&(u=yield Sc(r,t,s,a==="current",i.resumeToken)),r.isPrimaryClient&&e&&Ys(r.remoteStore,i),u})}function Sc(r,t,e,n,i){return V(this,null,function*(){r.Ka=(g,_,S)=>function(N,D,z,j){return V(this,null,function*(){let B=D.view.ma(z);B.ns&&(B=yield Ss(N.localStore,D.query,!1).then(({documents:v})=>D.view.ma(v,B)));let W=j&&j.targetChanges.get(D.targetId),Z=j&&j.targetMismatches.get(D.targetId)!=null,K=D.view.applyChanges(B,N.isPrimaryClient,W,Z);return Uu(N,D.targetId,K.wa),K.snapshot})}(r,g,_,S);let s=yield Ss(r.localStore,t,!0),a=new Ms(t,s.Ts),u=a.ma(s.documents),c=Xr.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",i),d=a.applyChanges(u,r.isPrimaryClient,c);Uu(r,e,d.wa);let f=new Ou(t,e,a);return r.Fa.set(t,f),r.Ma.has(e)?r.Ma.get(e).push(t):r.Ma.set(e,[t]),d.snapshot})}function fy(r,t,e){return V(this,null,function*(){let n=O(r),i=n.Fa.get(t),s=n.Ma.get(i.targetId);if(s.length>1)return n.Ma.set(i.targetId,s.filter(a=>!di(a,t))),void n.Fa.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Wn(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),e&&Hn(n.remoteStore,i.targetId),Yn(n,i.targetId)}).catch(Oe))):(Yn(n,i.targetId),yield Wn(n.localStore,i.targetId,!0))})}function my(r,t){return V(this,null,function*(){let e=O(r),n=e.Fa.get(t),i=e.Ma.get(n.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),Hn(e.remoteStore,n.targetId))})}function gy(r,t,e){return V(this,null,function*(){let n=Vc(r);try{let i=yield function(a,u){let c=O(a),d=lt.now(),f=u.reduce((S,k)=>S.add(k.key),$()),g,_;return c.persistence.runTransaction("Locally write mutations","readwrite",S=>{let k=Ft(),N=$();return c.cs.getEntries(S,f).next(D=>{k=D,k.forEach((z,j)=>{j.isValidDocument()||(N=N.add(z))})}).next(()=>c.localDocuments.getOverlayedDocuments(S,k)).next(D=>{g=D;let z=[];for(let j of u){let B=Vp(j,g.get(j.key).overlayedDocument);B!=null&&z.push(new Gt(j.key,B,Sd(B.value.mapValue),ut.exists(!0)))}return c.mutationQueue.addMutationBatch(S,d,z,u)}).next(D=>{_=D;let z=D.applyToLocalDocumentSet(g,N);return c.documentOverlayCache.saveOverlays(S,D.batchId,z)})}).then(()=>({batchId:_.batchId,changes:Od(g)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,c){let d=a.Ba[a.currentUser.toKey()];d||(d=new it(G)),d=d.insert(u,c),a.Ba[a.currentUser.toKey()]=d}(n,i.batchId,e),yield de(n,i.changes),yield ir(n.remoteStore)}catch(i){let s=or(i,"Failed to persist write");e.reject(s)}})}function Cf(r,t){return V(this,null,function*(){let e=O(r);try{let n=yield Wp(e.localStore,t);t.targetChanges.forEach((i,s)=>{let a=e.Na.get(s);a&&(U(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.va=!0:i.modifiedDocuments.size>0?U(a.va):i.removedDocuments.size>0&&(U(a.va),a.va=!1))}),yield de(e,n,t)}catch(n){yield Oe(n)}})}function nd(r,t,e){let n=O(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){let i=[];n.Fa.forEach((s,a)=>{let u=a.view.Z_(t);u.snapshot&&i.push(u.snapshot)}),function(a,u){let c=O(a);c.onlineState=u;let d=!1;c.queries.forEach((f,g)=>{for(let _ of g.j_)_.Z_(u)&&(d=!0)}),d&&Ac(c)}(n.eventManager,t),i.length&&n.Ca.d_(i),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}function py(r,t,e){return V(this,null,function*(){let n=O(r);n.sharedClientState.updateQueryState(t,"rejected",e);let i=n.Na.get(t),s=i&&i.key;if(s){let a=new it(M.comparator);a=a.insert(s,yt.newNoDocument(s,q.min()));let u=$().add(s),c=new Yr(q.min(),new Map,new it(G),a,u);yield Cf(n,c),n.Oa=n.Oa.remove(s),n.Na.delete(t),bc(n)}else yield Wn(n.localStore,t,!1).then(()=>Yn(n,t,e)).catch(Oe)})}function yy(r,t){return V(this,null,function*(){let e=O(r),n=t.batch.batchId;try{let i=yield Qp(e.localStore,t);Pc(e,n,null),Rc(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),yield de(e,i)}catch(i){yield Oe(i)}})}function _y(r,t,e){return V(this,null,function*(){let n=O(r);try{let i=yield function(a,u){let c=O(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return c.mutationQueue.lookupMutationBatch(d,u).next(g=>(U(g!==null),f=g.keys(),c.mutationQueue.removeMutationBatch(d,g))).next(()=>c.mutationQueue.performConsistencyCheck(d)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(d,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>c.localDocuments.getDocuments(d,f))})}(n.localStore,t);Pc(n,t,e),Rc(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),yield de(n,i)}catch(i){yield Oe(i)}})}function wy(r,t){return V(this,null,function*(){let e=O(r);Le(e.remoteStore)||C("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(a){let u=O(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(e.localStore);if(n===-1)return void t.resolve();let i=e.ka.get(n)||[];i.push(t),e.ka.set(n,i)}catch(n){let i=or(n,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}})}function Rc(r,t){(r.ka.get(t)||[]).forEach(e=>{e.resolve()}),r.ka.delete(t)}function Pc(r,t,e){let n=O(r),i=n.Ba[n.currentUser.toKey()];if(i){let s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),n.Ba[n.currentUser.toKey()]=i}}function Yn(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(let n of r.Ma.get(t))r.Fa.delete(n),e&&r.Ca.$a(n,e);r.Ma.delete(t),r.isPrimaryClient&&r.La.gr(t).forEach(n=>{r.La.containsKey(n)||xf(r,n)})}function xf(r,t){r.xa.delete(t.path.canonicalString());let e=r.Oa.get(t);e!==null&&(Hn(r.remoteStore,e),r.Oa=r.Oa.remove(t),r.Na.delete(e),bc(r))}function Uu(r,t,e){for(let n of e)n instanceof Fs?(r.La.addReference(n.key,t),vy(r,n)):n instanceof Os?(C("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,t),r.La.containsKey(n.key)||xf(r,n.key)):L()}function vy(r,t){let e=t.key,n=e.path.canonicalString();r.Oa.get(e)||r.xa.has(n)||(C("SyncEngine","New document in limbo: "+e),r.xa.add(n),bc(r))}function bc(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){let t=r.xa.values().next().value;r.xa.delete(t);let e=new M(J.fromString(t)),n=r.qa.next();r.Na.set(n,new Mu(e)),r.Oa=r.Oa.insert(e,n),Ys(r.remoteStore,new $n(kt(nr(e.path)),n,"TargetPurposeLimboResolution",Mt.oe))}}function de(r,t,e){return V(this,null,function*(){let n=O(r),i=[],s=[],a=[];n.Fa.isEmpty()||(n.Fa.forEach((u,c)=>{a.push(n.Ka(c,t,e).then(d=>{var f;if((d||e)&&n.isPrimaryClient){let g=d?!d.fromCache:(f=e?.targetChanges.get(c.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(c.targetId,g?"current":"not-current")}if(d){i.push(d);let g=yu.Wi(c.targetId,d);s.push(g)}}))}),yield Promise.all(a),n.Ca.d_(i),yield function(c,d){return V(this,null,function*(){let f=O(c);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>R.forEach(d,_=>R.forEach(_.$i,S=>f.persistence.referenceDelegate.addReference(g,_.targetId,S)).next(()=>R.forEach(_.Ui,S=>f.persistence.referenceDelegate.removeReference(g,_.targetId,S)))))}catch(g){if(!Me(g))throw g;C("LocalStore","Failed to update sequence numbers: "+g)}for(let g of d){let _=g.targetId;if(!g.fromCache){let S=f.os.get(_),k=S.snapshotVersion,N=S.withLastLimboFreeSnapshotVersion(k);f.os=f.os.insert(_,N)}}})}(n.localStore,s))})}function Iy(r,t){return V(this,null,function*(){let e=O(r);if(!e.currentUser.isEqual(t)){C("SyncEngine","User change. New user:",t.toKey());let n=yield pf(e.localStore,t);e.currentUser=t,function(s,a){s.ka.forEach(u=>{u.forEach(c=>{c.reject(new x(b.CANCELLED,a))})}),s.ka.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),yield de(e,n.hs)}})}function Ty(r,t){let e=O(r),n=e.Na.get(t);if(n&&n.va)return $().add(n.key);{let i=$(),s=e.Ma.get(t);if(!s)return i;for(let a of s){let u=e.Fa.get(a);i=i.unionWith(u.view.Va)}return i}}function Ey(r,t){return V(this,null,function*(){let e=O(r),n=yield Ss(e.localStore,t.query,!0),i=t.view.ba(n);return e.isPrimaryClient&&Uu(e,t.targetId,i.wa),i})}function Ay(r,t){return V(this,null,function*(){let e=O(r);return vf(e.localStore,t).then(n=>de(e,n))})}function Sy(r,t,e,n){return V(this,null,function*(){let i=O(r),s=yield function(u,c){let d=O(u),f=O(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.Mn(g,c).next(_=>_?d.localDocuments.getDocuments(g,_):R.resolve(null)))}(i.localStore,t);s!==null?(e==="pending"?yield ir(i.remoteStore):e==="acknowledged"||e==="rejected"?(Pc(i,t,n||null),Rc(i,t),function(u,c){O(O(u).mutationQueue).On(c)}(i.localStore,t)):L(),yield de(i,s)):C("SyncEngine","Cannot apply mutation batch with id: "+t)})}function Ry(r,t){return V(this,null,function*(){let e=O(r);if(Xs(e),Vc(e),t===!0&&e.Qa!==!0){let n=e.sharedClientState.getAllActiveQueryTargets(),i=yield rd(e,n.toArray());e.Qa=!0,yield Vu(e.remoteStore,!0);for(let s of i)Ys(e.remoteStore,s)}else if(t===!1&&e.Qa!==!1){let n=[],i=Promise.resolve();e.Ma.forEach((s,a)=>{e.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(Yn(e,a),Wn(e.localStore,a,!0))),Hn(e.remoteStore,a)}),yield i,yield rd(e,n),function(a){let u=O(a);u.Na.forEach((c,d)=>{Hn(u.remoteStore,d)}),u.La.pr(),u.Na=new Map,u.Oa=new it(M.comparator)}(e),e.Qa=!1,yield Vu(e.remoteStore,!1)}})}function rd(r,t,e){return V(this,null,function*(){let n=O(r),i=[],s=[];for(let a of t){let u,c=n.Ma.get(a);if(c&&c.length!==0){u=yield Qn(n.localStore,kt(c[0]));for(let d of c){let f=n.Fa.get(d),g=yield Ey(n,f);g.snapshot&&s.push(g.snapshot)}}else{let d=yield wf(n.localStore,a);u=yield Qn(n.localStore,d),yield Sc(n,Df(d),a,!1,u.resumeToken)}i.push(u)}return n.Ca.d_(s),i})}function Df(r){return xd(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Py(r){return function(e){return O(O(e).persistence).Qi()}(O(r).localStore)}function by(r,t,e,n){return V(this,null,function*(){let i=O(r);if(i.Qa)return void C("SyncEngine","Ignoring unexpected query state notification.");let s=i.Ma.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{let a=yield vf(i.localStore,kd(s[0])),u=Yr.createSynthesizedRemoteEventForCurrentChange(t,e==="current",ft.EMPTY_BYTE_STRING);yield de(i,a,u);break}case"rejected":yield Wn(i.localStore,t,!0),Yn(i,t,n);break;default:L()}})}function Vy(r,t,e){return V(this,null,function*(){let n=Xs(r);if(n.Qa){for(let i of t){if(n.Ma.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){C("SyncEngine","Adding an already active target "+i);continue}let s=yield wf(n.localStore,i),a=yield Qn(n.localStore,s);yield Sc(n,Df(s),a.targetId,!1,a.resumeToken),Ys(n.remoteStore,a)}for(let i of e)n.Ma.has(i)&&(yield Wn(n.localStore,i,!1).then(()=>{Hn(n.remoteStore,i),Yn(n,i)}).catch(Oe))}})}function Xs(r){let t=O(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=Cf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ty.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=py.bind(null,t),t.Ca.d_=cy.bind(null,t.eventManager),t.Ca.$a=ly.bind(null,t.eventManager),t}function Vc(r){let t=O(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=yy.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=_y.bind(null,t),t}function Cy(r,t,e){let n=O(r);(function(s,a,u){return V(this,null,function*(){try{let c=yield a.getMetadata();if(yield function(S,k){let N=O(S),D=ht(k.createTime);return N.persistence.runTransaction("hasNewerBundle","readonly",z=>N.Gr.getBundleMetadata(z,k.id)).then(z=>!!z&&z.createTime.compareTo(D)>=0)}(s.localStore,c))return yield a.close(),u._completeWith(function(S){return{taskState:"Success",documentsLoaded:S.totalDocuments,bytesLoaded:S.totalBytes,totalDocuments:S.totalDocuments,totalBytes:S.totalBytes}}(c)),Promise.resolve(new Set);u._updateProgress(bf(c));let d=new Fu(c,s.localStore,a.serializer),f=yield a.Ua();for(;f;){let _=yield d.la(f);_&&u._updateProgress(_),f=yield a.Ua()}let g=yield d.complete();return yield de(s,g.Ia,void 0),yield function(S,k){let N=O(S);return N.persistence.runTransaction("Save bundle","readwrite",D=>N.Gr.saveBundleMetadata(D,k))}(s.localStore,c),u._completeWith(g.progress),Promise.resolve(g.Pa)}catch(c){return oe("SyncEngine",`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}})})(n,t,e).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}var qu=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return V(this,null,function*(){this.serializer=mi(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),yield this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)})}ja(e,n){return null}Ha(e,n){return null}za(e){return gf(this.persistence,new As,e.initialUser,this.serializer)}Ga(e){return new Ts(Es.Zr,this.serializer)}Wa(e){return new bs}terminate(){return V(this,null,function*(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})();var Ls=class r extends qu{constructor(t,e,n){super(),this.Ja=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(t){return V(this,null,function*(){yield xo(r.prototype,this,"initialize").call(this,t),yield this.Ja.initialize(this,t),yield Vc(this.Ja.syncEngine),yield ir(this.Ja.remoteStore),yield this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}za(t){return gf(this.persistence,new As,t.initialUser,this.serializer)}ja(t,e){let n=this.persistence.referenceDelegate.garbageCollector;return new eu(n,t.asyncQueue,e)}Ha(t,e){let n=new _a(e,this.persistence);return new ya(t.asyncQueue,n)}Ga(t){let e=_c(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Ut.withCacheSize(this.cacheSizeBytes):Ut.DEFAULT;return new pu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Tf(),Yi(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(t){return new bs}},Bu=class r extends Ls{constructor(t,e){super(t,e,!1),this.Ja=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return V(this,null,function*(){yield xo(r.prototype,this,"initialize").call(this,t);let e=this.Ja.syncEngine;this.sharedClientState instanceof Br&&(this.sharedClientState.syncEngine={no:Sy.bind(null,e),ro:by.bind(null,e),io:Vy.bind(null,e),Qi:Py.bind(null,e),eo:Ay.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.yi(n=>V(this,null,function*(){yield Ry(this.Ja.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}Wa(t){let e=Tf();if(!Br.D(e))throw new x(b.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=_c(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Br(e,t.asyncQueue,n,t.clientId,t.initialUser)}},Cc=(()=>{class r{initialize(e,n){return V(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>nd(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=Iy.bind(null,this.syncEngine),yield Vu(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Du}()}createDatastore(e){let n=mi(e.databaseInfo.databaseId),i=function(a){return new Eu(a)}(e.databaseInfo);return function(a,u,c,d){return new Ru(a,u,c,d)}(e.authCredentials,e.appCheckCredentials,i,n)}createRemoteStore(e){return function(i,s,a,u,c){return new bu(i,s,a,u,c)}(this.localStore,this.datastore,e.asyncQueue,n=>nd(this.syncEngine,n,0),function(){return Vs.D()?new Vs:new Iu}())}createSyncEngine(e,n){return function(s,a,u,c,d,f,g){let _=new Lu(s,a,u,c,d,f);return g&&(_.Qa=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}terminate(){return V(this,null,function*(){var e,n;yield function(s){return V(this,null,function*(){let a=O(s);C("RemoteStore","RemoteStore shutting down."),a.L_.add(5),yield rr(a),a.k_.shutdown(),a.q_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return r.provider={build:()=>new r},r})();function id(r,t=10240){let e=0;return{read(){return V(this,null,function*(){if(e<r.byteLength){let i={value:r.slice(e,e+t),done:!1};return e+=t,i}return{done:!0}})},cancel(){return V(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Xn=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ya(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ya(this.observer.error,t):ct("Uncaught Error in snapshot listener:",t.toString()))}Za(){this.muted=!0}Ya(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var zu=class{constructor(t,e){this.Xa=t,this.serializer=e,this.metadata=new wt,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.aa)}`))},n=>this.metadata.reject(n))}close(){return this.Xa.cancel()}getMetadata(){return V(this,null,function*(){return this.metadata.promise})}Ua(){return V(this,null,function*(){return yield this.getMetadata(),this.tu()})}tu(){return V(this,null,function*(){let t=yield this.nu();if(t===null)return null;let e=this.eu.decode(t),n=Number(e);isNaN(n)&&this.ru(`length string (${e}) is not valid number`);let i=yield this.iu(n);return new Nu(JSON.parse(i),t.length+n)})}su(){return this.buffer.findIndex(t=>t===123)}nu(){return V(this,null,function*(){for(;this.su()<0&&!(yield this.ou()););if(this.buffer.length===0)return null;let t=this.su();t<0&&this.ru("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}iu(t){return V(this,null,function*(){for(;this.buffer.length<t;)(yield this.ou())&&this.ru("Reached the end of bundle when more is expected.");let e=this.eu.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}ru(t){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${t}`)}ou(){return V(this,null,function*(){let t=yield this.Xa.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var ju=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return V(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new x(b.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(i,s){return V(this,null,function*(){let a=O(i),u={documents:s.map(g=>Zr(a.serializer,g))},c=yield a.Lo("BatchGetDocuments",a.serializer.databaseId,J.emptyPath(),u,s.length),d=new Map;c.forEach(g=>{let _=Fp(a.serializer,g);d.set(_.key.toString(),_)});let f=[];return s.forEach(g=>{let _=d.get(g.toString());U(!!_),f.push(_)}),f})}(this.datastore,t);return e.forEach(n=>this.recordVersion(n)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(t.toString())}delete(t){this.write(new xe(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return V(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,n)=>{let i=M.fromPath(n);this.mutations.push(new Wr(i,this.precondition(i)))}),yield function(n,i){return V(this,null,function*(){let s=O(n),a={writes:i.map(u=>ti(s.serializer,u))};yield s.Mo("Commit",s.serializer.databaseId,J.emptyPath(),a)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw L();e=q.min()}let n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new x(b.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(q.min())?ut.exists(!1):ut.updateTime(e):ut.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(q.min()))throw new x(b.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ut.updateTime(e)}return ut.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var Gu=class{constructor(t,e,n,i,s){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=i,this.deferred=s,this._u=n.maxAttempts,this.t_=new ii(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(()=>V(this,null,function*(){let t=new ju(this.datastore),e=this.cu(t);e&&e.then(n=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(n)}).catch(i=>{this.lu(i)}))}).catch(n=>{this.lu(n)})}))}cu(t){try{let e=this.updateFunction(t);return!li(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}lu(t){this._u>0&&this.hu(t)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(t)}hu(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!Kd(e)}return!1}};var $u=class{constructor(t,e,n,i,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=pt.UNAUTHENTICATED,this.clientId=Zi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,a=>V(this,null,function*(){C("FirestoreClient","Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,a=>(C("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new wt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>V(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let n=or(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}};function oa(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),C("FirestoreClient","Initializing OfflineComponentProvider");let e=r.configuration;yield t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(i=>V(this,null,function*(){n.isEqual(i)||(yield pf(t.localStore,i),n=i)})),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t})}function sd(r,t){return V(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let e=yield xc(r);C("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>Zh(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>Zh(t.remoteStore,i)),r._onlineComponents=t})}function xc(r){return V(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){C("FirestoreClient","Using user provided OfflineComponentProvider");try{yield oa(r,r._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!function(i){return i.name==="FirebaseError"?i.code===b.FAILED_PRECONDITION||i.code===b.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(e))throw e;oe("Error using user provided cache. Falling back to memory cache: "+e),yield oa(r,new qu)}}else C("FirestoreClient","Using default OfflineComponentProvider"),yield oa(r,new qu);return r._offlineComponents})}function Zs(r){return V(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(C("FirestoreClient","Using user provided OnlineComponentProvider"),yield sd(r,r._uninitializedComponentsProvider._online)):(C("FirestoreClient","Using default OnlineComponentProvider"),yield sd(r,new Cc))),r._onlineComponents})}function kf(r){return xc(r).then(t=>t.persistence)}function Dc(r){return xc(r).then(t=>t.localStore)}function Nf(r){return Zs(r).then(t=>t.remoteStore)}function kc(r){return Zs(r).then(t=>t.syncEngine)}function xy(r){return Zs(r).then(t=>t.datastore)}function Zn(r){return V(this,null,function*(){let t=yield Zs(r),e=t.eventManager;return e.onListen=hy.bind(null,t.syncEngine),e.onUnlisten=fy.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=dy.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=my.bind(null,t.syncEngine),e})}function Dy(r){return r.asyncQueue.enqueue(()=>V(this,null,function*(){let t=yield kf(r),e=yield Nf(r);return t.setNetworkEnabled(!0),function(i){let s=O(i);return s.L_.delete(0),gi(s)}(e)}))}function ky(r){return r.asyncQueue.enqueue(()=>V(this,null,function*(){let t=yield kf(r),e=yield Nf(r);return t.setNetworkEnabled(!1),function(i){return V(this,null,function*(){let s=O(i);s.L_.add(0),yield rr(s),s.q_.set("Offline")})}(e)}))}function Ny(r,t){let e=new wt;return r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(i,s,a){return V(this,null,function*(){try{let u=yield function(d,f){let g=O(d);return g.persistence.runTransaction("read document","readonly",_=>g.localDocuments.getDocument(_,f))}(i,s);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new x(b.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let c=or(u,`Failed to get document '${s} from cache`);a.reject(c)}})}(yield Dc(r),t,e)})),e.promise}function Ff(r,t,e={}){let n=new wt;return r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(s,a,u,c,d){let f=new Xn({next:_=>{f.Za(),a.enqueueAndForget(()=>Ec(s,g));let S=_.docs.has(u);!S&&_.fromCache?d.reject(new x(b.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&_.fromCache&&c&&c.source==="server"?d.reject(new x(b.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new si(nr(u.path),f,{includeMetadataChanges:!0,_a:!0});return Tc(s,g)}(yield Zn(r),r.asyncQueue,t,e,n)})),n.promise}function Fy(r,t){let e=new wt;return r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(i,s,a){return V(this,null,function*(){try{let u=yield Ss(i,s,!0),c=new Ms(s,u.Ts),d=c.ma(u.documents),f=c.applyChanges(d,!1);a.resolve(f.snapshot)}catch(u){let c=or(u,`Failed to execute query '${s} against cache`);a.reject(c)}})}(yield Dc(r),t,e)})),e.promise}function Of(r,t,e={}){let n=new wt;return r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(s,a,u,c,d){let f=new Xn({next:_=>{f.Za(),a.enqueueAndForget(()=>Ec(s,g)),_.fromCache&&c.source==="server"?d.reject(new x(b.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new si(u,f,{includeMetadataChanges:!0,_a:!0});return Tc(s,g)}(yield Zn(r),r.asyncQueue,t,e,n)})),n.promise}function Oy(r,t){let e=new Xn(t);return r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(i,s){O(i).Y_.add(s),s.next()}(yield Zn(r),e)})),()=>{e.Za(),r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return function(i,s){O(i).Y_.delete(s)}(yield Zn(r),e)}))}}function My(r,t,e,n){let i=function(a,u){let c;return c=typeof a=="string"?Wd().encode(a):a,function(f,g){return new zu(f,g)}(function(f,g){if(f instanceof Uint8Array)return id(f,g);if(f instanceof ArrayBuffer)return id(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),u)}(e,mi(t));r.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){Cy(yield kc(r),i,n)}))}function Ly(r,t){return r.asyncQueue.enqueue(()=>V(this,null,function*(){return function(n,i){let s=O(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.Gr.getNamedQuery(a,i))}(yield Dc(r),t)}))}function Mf(r){let t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}var od=new Map;function Nc(r,t,e){if(!e)throw new x(b.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function Uy(r,t,e,n){if(t===!0&&n===!0)throw new x(b.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function ad(r){if(!M.isDocumentKey(r))throw new x(b.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function ud(r){if(M.isDocumentKey(r))throw new x(b.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function to(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let t=function(n){return n.constructor?n.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":L()}function X(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new x(b.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=to(r);throw new x(b.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function Lf(r,t){if(t<=0)throw new x(b.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${t}.`)}var Us=class{constructor(t){var e,n;if(t.host===void 0){if(t.ssl!==void 0)throw new x(b.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new x(b.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Uy("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Mf((n=t.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new x(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new x(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new x(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},ln=class{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Us({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(b.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new x(b.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Us(t),t.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new aa;switch(n.type){case"firstParty":return new ha(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new x(b.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return V(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let n=od.get(e);n&&(C("ComponentProvider","Removing Datastore"),od.delete(e),n.terminate())}(this),Promise.resolve()}};function qy(r,t,e,n={}){var i;let s=(r=X(r,ln))._getSettings(),a=`${t}:${e}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&oe("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,c;if(typeof n.mockUserToken=="string")u=n.mockUserToken,c=pt.MOCK_USER;else{u=Wl(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let d=n.mockUserToken.sub||n.mockUserToken.user_id;if(!d)throw new x(b.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new pt(d)}r._authCredentials=new ua(new Xi(u,c))}}var Et=class r{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new r(this.firestore,t,this._query)}},dt=class r{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Jt(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new r(this.firestore,t,this._key)}},Jt=class r extends Et{constructor(t,e,n){super(t,e,nr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new dt(this.firestore,null,new M(t))}withConverter(t){return new r(this.firestore,t,this._path)}};function jw(r,t,...e){if(r=_t(r),Nc("collection","path",t),r instanceof ln){let n=J.fromString(t,...e);return ud(n),new Jt(r,null,n)}{if(!(r instanceof dt||r instanceof Jt))throw new x(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(J.fromString(t,...e));return ud(n),new Jt(r.firestore,null,n)}}function Gw(r,t){if(r=X(r,ln),Nc("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new x(b.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Et(r,null,function(n){return new jt(J.emptyPath(),n)}(t))}function By(r,t,...e){if(r=_t(r),arguments.length===1&&(t=Zi.newId()),Nc("doc","path",t),r instanceof ln){let n=J.fromString(t,...e);return ad(n),new dt(r,null,new M(n))}{if(!(r instanceof dt||r instanceof Jt))throw new x(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(J.fromString(t,...e));return ad(n),new dt(r.firestore,r instanceof Jt?r.converter:null,new M(n))}}function $w(r,t){return r=_t(r),t=_t(t),(r instanceof dt||r instanceof Jt)&&(t instanceof dt||t instanceof Jt)&&r.firestore===t.firestore&&r.path===t.path&&r.converter===t.converter}function zy(r,t){return r=_t(r),t=_t(t),r instanceof Et&&t instanceof Et&&r.firestore===t.firestore&&di(r._query,t._query)&&r.converter===t.converter}var qs=class{constructor(t=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new ii(this,"async_queue_retry"),this.Vu=()=>{let n=Yi();n&&C("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=t;let e=Yi();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.fu(),this.gu(t)}enterRestrictedMode(t){if(!this.Iu){this.Iu=!0,this.Au=t||!1;let e=Yi();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.Vu)}}enqueue(t){if(this.fu(),this.Iu)return new Promise(()=>{});let e=new wt;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Pu.push(t),this.pu()))}pu(){return V(this,null,function*(){if(this.Pu.length!==0){try{yield this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(t){if(!Me(t))throw t;C("AsyncQueue","Operation failed with retryable error: "+t)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}})}gu(t){let e=this.mu.then(()=>(this.du=!0,t().catch(n=>{this.Eu=n,this.du=!1;let i=function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),u}(n);throw ct("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.du=!1,n))));return this.mu=e,e}enqueueAfterDelay(t,e,n){this.fu(),this.Ru.indexOf(t)>-1&&(e=0);let i=Cu.createAndSchedule(this,t,e,n,s=>this.yu(s));return this.Tu.push(i),i}fu(){this.Eu&&L()}verifyOperationInProgress(){}wu(){return V(this,null,function*(){let t;do t=this.mu,yield t;while(t!==this.mu)})}Su(t){for(let e of this.Tu)if(e.timerId===t)return!0;return!1}bu(t){return this.wu().then(()=>{this.Tu.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(let e of this.Tu)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.wu()})}Du(t){this.Ru.push(t)}yu(t){let e=this.Tu.indexOf(t);this.Tu.splice(e,1)}};function Ku(r){return function(e,n){if(typeof e!="object"||e===null)return!1;let i=e;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}var Qu=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new wt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var Kw=-1,ot=class extends ln{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new qs,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return V(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new qs(t),this._firestoreClient=void 0,yield t}})}};function Qw(r,t){let e=typeof r=="object"?r:Fi(),n=typeof r=="string"?r:t||"(default)",i=th(e,"firestore").getImmediate({identifier:n});if(!i._initialized){let s=Ql("firestore");s&&qy(i,...s)}return i}function Nt(r){if(r._terminated)throw new x(b.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||Uf(r),r._firestoreClient}function Uf(r){var t,e,n;let i=r._freezeSettings(),s=function(u,c,d,f){return new wa(u,c,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Mf(f.experimentalLongPollingOptions),f.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new $u(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(u){let c=u?._online.build();return{_offline:u?._offline.build(c),_online:c}}(r._componentsProvider))}function Ww(r,t){oe("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=r._freezeSettings();return qf(r,Cc.provider,{build:n=>new Ls(n,e.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}function Hw(r){return V(this,null,function*(){oe("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings();qf(r,Cc.provider,{build:e=>new Bu(e,t.cacheSizeBytes)})})}function qf(r,t,e){if((r=X(r,ot))._firestoreClient||r._terminated)throw new x(b.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new x(b.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:t,_offline:e},Uf(r)}function Jw(r){if(r._initialized&&!r._terminated)throw new x(b.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new wt;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>V(this,null,function*(){try{yield function(n){return V(this,null,function*(){if(!Se.D())return Promise.resolve();let i=n+"main";yield Se.delete(i)})}(_c(r._databaseId,r._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function Yw(r){return function(e){let n=new wt;return e.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return wy(yield kc(e),n)})),n.promise}(Nt(r=X(r,ot)))}function Xw(r){return Dy(Nt(r=X(r,ot)))}function Zw(r){return ky(Nt(r=X(r,ot)))}function tv(r,t){let e=Nt(r=X(r,ot)),n=new Qu;return My(e,r._databaseId,t,n),n}function ev(r,t){return Ly(Nt(r=X(r,ot)),t).then(e=>e?new Et(r,null,e.query):null)}var tr=class r{constructor(t){this._byteString=t}static fromBase64String(t){try{return new r(ft.fromBase64String(t))}catch(e){throw new x(b.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new r(ft.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var ke=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new x(b.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new vt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var le=class{constructor(t){this._methodName=t}};var oi=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new x(b.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new x(b.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return G(this._lat,t._lat)||G(this._long,t._long)}};var ai=class{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,t._values)}};var jy=/^__.*__$/,Wu=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new Gt(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ce(t,this.data,e,this.fieldTransforms)}},Bs=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Gt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function Bf(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}var zs=class r{constructor(t,e,n,i,s,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(t){return new r(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.Fu({path:n,xu:!1});return i.Ou(t),i}Nu(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.Fu({path:n,xu:!1});return i.vu(),i}Lu(t){return this.Fu({path:void 0,xu:!0})}Bu(t){return js(t,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}vu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Ou(this.path.get(t))}Ou(t){if(t.length===0)throw this.Bu("Document fields must not be empty");if(Bf(this.Cu)&&jy.test(t))throw this.Bu('Document fields cannot begin and end with "__"')}},Hu=class{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||mi(t)}Qu(t,e,n,i=!1){return new zs({Cu:t,methodName:e,qu:n,path:vt.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function mn(r){let t=r._freezeSettings(),e=mi(r._databaseId);return new Hu(r._databaseId,!!t.ignoreUndefinedProperties,e)}function eo(r,t,e,n,i,s={}){let a=r.Qu(s.merge||s.mergeFields?2:0,t,e,i);Mc("Data must be an object, but it was:",a,n);let u=Gf(n,a),c,d;if(s.merge)c=new Lt(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let f=[];for(let g of s.mergeFields){let _=tc(t,g,e);if(!a.contains(_))throw new x(b.INVALID_ARGUMENT,`Field '${_}' is specified in your field mask but missing from your input data.`);Kf(f,_)||f.push(_)}c=new Lt(f),d=a.fieldTransforms.filter(g=>c.covers(g.field))}else c=null,d=a.fieldTransforms;return new Wu(new Vt(u),c,d)}var ui=class r extends le{_toFieldTransform(t){if(t.Cu!==2)throw t.Cu===1?t.Bu(`${this._methodName}() can only appear at the top level of your update data`):t.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof r}};function zf(r,t,e){return new zs({Cu:3,qu:t.settings.qu,methodName:r._methodName,xu:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var Ju=class r extends le{_toFieldTransform(t){return new an(t.path,new be)}isEqual(t){return t instanceof r}},Yu=class r extends le{constructor(t,e){super(t),this.Ku=e}_toFieldTransform(t){let e=zf(this,t,!0),n=this.Ku.map(s=>gn(s,e)),i=new ue(n);return new an(t.path,i)}isEqual(t){return t instanceof r&&Uo(this.Ku,t.Ku)}},Xu=class r extends le{constructor(t,e){super(t),this.Ku=e}_toFieldTransform(t){let e=zf(this,t,!0),n=this.Ku.map(s=>gn(s,e)),i=new ce(n);return new an(t.path,i)}isEqual(t){return t instanceof r&&Uo(this.Ku,t.Ku)}},Zu=class r extends le{constructor(t,e){super(t),this.$u=e}_toFieldTransform(t){let e=new Ve(t.serializer,Ud(t.serializer,this.$u));return new an(t.path,e)}isEqual(t){return t instanceof r&&this.$u===t.$u}};function Fc(r,t,e,n){let i=r.Qu(1,t,e);Mc("Data must be an object, but it was:",i,n);let s=[],a=Vt.empty();fn(n,(c,d)=>{let f=Lc(t,c,e);d=_t(d);let g=i.Nu(f);if(d instanceof ui)s.push(f);else{let _=gn(d,g);_!=null&&(s.push(f),a.set(f,_))}});let u=new Lt(s);return new Bs(a,u,i.fieldTransforms)}function Oc(r,t,e,n,i,s){let a=r.Qu(1,t,e),u=[tc(t,n,e)],c=[i];if(s.length%2!=0)throw new x(b.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let _=0;_<s.length;_+=2)u.push(tc(t,s[_])),c.push(s[_+1]);let d=[],f=Vt.empty();for(let _=u.length-1;_>=0;--_)if(!Kf(d,u[_])){let S=u[_],k=c[_];k=_t(k);let N=a.Nu(S);if(k instanceof ui)d.push(S);else{let D=gn(k,N);D!=null&&(d.push(S),f.set(S,D))}}let g=new Lt(d);return new Bs(f,g,a.fieldTransforms)}function jf(r,t,e,n=!1){return gn(e,r.Qu(n?4:3,t))}function gn(r,t){if($f(r=_t(r)))return Mc("Unsupported field value:",t,r),Gf(r,t);if(r instanceof le)return function(n,i){if(!Bf(i.Cu))throw i.Bu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.xu&&t.Cu!==4)throw t.Bu("Nested arrays are not supported");return function(n,i){let s=[],a=0;for(let u of n){let c=gn(u,i.Lu(a));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}}(r,t)}return function(n,i){if((n=_t(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Ud(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=lt.fromDate(n);return{timestampValue:Gn(i.serializer,s)}}if(n instanceof lt){let s=new lt(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Gn(i.serializer,s)}}if(n instanceof oi)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof tr)return{bytesValue:Hd(i.serializer,n._byteString)};if(n instanceof dt){let s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:gc(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof ai)return function(a,u){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(c=>{if(typeof c!="number")throw u.Bu("VectorValues must only contain numeric values.");return mc(u.serializer,c)})}}}}}}(n,i);throw i.Bu(`Unsupported field value: ${to(n)}`)}(r,t)}function Gf(r,t){let e={};return Td(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):fn(r,(n,i)=>{let s=gn(i,t.Mu(n));s!=null&&(e[n]=s)}),{mapValue:{fields:e}}}function $f(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof lt||r instanceof oi||r instanceof tr||r instanceof dt||r instanceof le||r instanceof ai)}function Mc(r,t,e){if(!$f(e)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(e)){let n=to(e);throw n==="an object"?t.Bu(r+" a custom object"):t.Bu(r+" "+n)}}function tc(r,t,e){if((t=_t(t))instanceof ke)return t._internalPath;if(typeof t=="string")return Lc(r,t);throw js("Field path arguments must be of type string or ",r,!1,void 0,e)}var Gy=new RegExp("[~\\*/\\[\\]]");function Lc(r,t,e){if(t.search(Gy)>=0)throw js(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new ke(...t.split("."))._internalPath}catch{throw js(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function js(r,t,e,n,i){let s=n&&!n.isEmpty(),a=i!==void 0,u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${n}`),a&&(c+=` in document ${i}`),c+=")"),new x(b.INVALID_ARGUMENT,u+r+c)}function Kf(r,t){return r.some(e=>e.isEqual(t))}var hn=class{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new dt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new ec(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(no("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},ec=class extends hn{data(){return super.data()}};function no(r,t){return typeof t=="string"?Lc(r,t):t instanceof ke?t._internalPath:t._delegate._internalPath}function Qf(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new x(b.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ci=class{},dn=class extends ci{};function nv(r,t,...e){let n=[];t instanceof ci&&n.push(t),n=n.concat(e),function(s){let a=s.filter(c=>c instanceof nc).length,u=s.filter(c=>c instanceof Gs).length;if(a>1||a>0&&u>0)throw new x(b.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}var Gs=class r extends dn{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=this._parse(t);return Hf(t._query,e),new Et(t.firestore,t.converter,Da(t._query,e))}_parse(t){let e=mn(t.firestore);return function(s,a,u,c,d,f,g){let _;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new x(b.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){ld(g,f);let S=[];for(let k of g)S.push(cd(c,s,k));_={arrayValue:{values:S}}}else _=cd(c,s,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||ld(g,f),_=jf(u,a,g,f==="in"||f==="not-in");return Q.create(d,f,_)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function rv(r,t,e){let n=t,i=no("where",r);return Gs._create(i,n,e)}var nc=class r extends ci{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new r(t,e)}_parse(t){let e=this._queryConstraints.map(n=>n._parse(t)).filter(n=>n.getFilters().length>0);return e.length===1?e[0]:tt.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(i,s){let a=i,u=s.getFlattenedFilters();for(let c of u)Hf(a,c),a=Da(a,c)}(t._query,e),new Et(t.firestore,t.converter,Da(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var rc=class r extends dn{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new r(t,e)}_apply(t){let e=function(i,s,a){if(i.startAt!==null)throw new x(b.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new x(b.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new sn(s,a)}(t._query,this._field,this._direction);return new Et(t.firestore,t.converter,function(i,s){let a=i.explicitOrderBy.concat([s]);return new jt(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(t._query,e))}};function iv(r,t="asc"){let e=t,n=no("orderBy",r);return rc._create(n,e)}var $s=class r extends dn{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){return new Et(t.firestore,t.converter,cs(t._query,this._limit,this._limitType))}};function sv(r){return Lf("limit",r),$s._create("limit",r,"F")}function ov(r){return Lf("limitToLast",r),$s._create("limitToLast",r,"L")}var Ks=class r extends dn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Wf(t,this.type,this._docOrFields,this._inclusive);return new Et(t.firestore,t.converter,function(i,s){return new jt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(t._query,e))}};function av(...r){return Ks._create("startAt",r,!0)}function uv(...r){return Ks._create("startAfter",r,!1)}var Qs=class r extends dn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Wf(t,this.type,this._docOrFields,this._inclusive);return new Et(t.firestore,t.converter,function(i,s){return new jt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(t._query,e))}};function cv(...r){return Qs._create("endBefore",r,!1)}function lv(...r){return Qs._create("endAt",r,!0)}function Wf(r,t,e,n){if(e[0]=_t(e[0]),e[0]instanceof hn)return function(s,a,u,c,d){if(!c)throw new x(b.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let g of Nn(s))if(g.field.isKeyField())f.push(rn(a,c.key));else{let _=c.data.field(g.field);if(Hs(_))throw new x(b.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(_===null){let S=g.field.canonicalString();throw new x(b.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${S}' (used as the orderBy) does not exist.`)}f.push(_)}return new Xt(f,d)}(r._query,r.firestore._databaseId,t,e[0]._document,n);{let i=mn(r.firestore);return function(a,u,c,d,f,g){let _=a.explicitOrderBy;if(f.length>_.length)throw new x(b.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let S=[];for(let k=0;k<f.length;k++){let N=f[k];if(_[k].field.isKeyField()){if(typeof N!="string")throw new x(b.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof N}`);if(!dc(a)&&N.indexOf("/")!==-1)throw new x(b.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${N}' contains a slash.`);let D=a.path.child(J.fromString(N));if(!M.isDocumentKey(D))throw new x(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${D}' is not because it contains an odd number of segments.`);let z=new M(D);S.push(rn(u,z))}else{let D=jf(c,d,N);S.push(D)}}return new Xt(S,g)}(r._query,r.firestore._databaseId,i,t,e,n)}}function cd(r,t,e){if(typeof(e=_t(e))=="string"){if(e==="")throw new x(b.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!dc(t)&&e.indexOf("/")!==-1)throw new x(b.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let n=t.path.child(J.fromString(e));if(!M.isDocumentKey(n))throw new x(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return rn(r,new M(n))}if(e instanceof dt)return rn(r,e._key);throw new x(b.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${to(e)}.`)}function ld(r,t){if(!Array.isArray(r)||r.length===0)throw new x(b.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Hf(r,t){let e=function(i,s){for(let a of i)for(let u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new x(b.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new x(b.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var Ws=class{convertValue(t,e="none"){switch(nn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return st(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Re(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw L()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let n={};return fn(t,(i,s)=>{n[i]=this.convertValue(s,e)}),n}convertVectorValue(t){var e,n,i;let s=(i=(n=(e=t.fields)===null||e===void 0?void 0:e.value.arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(a=>st(a.doubleValue));return new ai(s)}convertGeoPoint(t){return new oi(st(t.latitude),st(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":let n=lc(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp($r(t));default:return null}}convertTimestamp(t){let e=ae(t);return new lt(e.seconds,e.nanos)}convertDocumentKey(t,e){let n=J.fromString(t);U(af(n));let i=new Un(n.get(1),n.get(3)),s=new M(n.popFirst(5));return i.isEqual(e)||ct(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function ro(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}var ic=class extends Ws{constructor(t){super(),this.firestore=t}convertBytes(t){return new tr(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new dt(this.firestore,null,e)}};var se=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Ne=class extends hn{constructor(t,e,n,i,s,a){super(t,e,n,i,a),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new On(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let n=this._document.data.field(no("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}},On=class extends Ne{data(t={}){return super.data(t)}},Fe=class{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new se(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new On(this._firestore,this._userDataWriter,n.key,n,new se(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new x(b.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let c=new On(i._firestore,i._userDataWriter,u.doc.key,u.doc,new se(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let c=new On(i._firestore,i._userDataWriter,u.doc.key,u.doc,new se(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,f=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:$y(u.type),doc:c,oldIndex:d,newIndex:f}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function $y(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}function hv(r,t){return r instanceof Ne&&t instanceof Ne?r._firestore===t._firestore&&r._key.isEqual(t._key)&&(r._document===null?t._document===null:r._document.isEqual(t._document))&&r._converter===t._converter:r instanceof Fe&&t instanceof Fe&&r._firestore===t._firestore&&zy(r.query,t.query)&&r.metadata.isEqual(t.metadata)&&r._snapshot.isEqual(t._snapshot)}function dv(r){r=X(r,dt);let t=X(r.firestore,ot);return Ff(Nt(t),r._key).then(e=>Uc(t,r,e))}var he=class extends Ws{constructor(t){super(),this.firestore=t}convertBytes(t){return new tr(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new dt(this.firestore,null,e)}};function fv(r){r=X(r,dt);let t=X(r.firestore,ot),e=Nt(t),n=new he(t);return Ny(e,r._key).then(i=>new Ne(t,n,r._key,i,new se(i!==null&&i.hasLocalMutations,!0),r.converter))}function mv(r){r=X(r,dt);let t=X(r.firestore,ot);return Ff(Nt(t),r._key,{source:"server"}).then(e=>Uc(t,r,e))}function gv(r){r=X(r,Et);let t=X(r.firestore,ot),e=Nt(t),n=new he(t);return Qf(r._query),Of(e,r._query).then(i=>new Fe(t,n,r,i))}function pv(r){r=X(r,Et);let t=X(r.firestore,ot),e=Nt(t),n=new he(t);return Fy(e,r._query).then(i=>new Fe(t,n,r,i))}function yv(r){r=X(r,Et);let t=X(r.firestore,ot),e=Nt(t),n=new he(t);return Of(e,r._query,{source:"server"}).then(i=>new Fe(t,n,r,i))}function _v(r,t,e){r=X(r,dt);let n=X(r.firestore,ot),i=ro(r.converter,t,e);return io(n,[eo(mn(n),"setDoc",r._key,i,r.converter!==null,e).toMutation(r._key,ut.none())])}function wv(r,t,e,...n){r=X(r,dt);let i=X(r.firestore,ot),s=mn(i),a;return a=typeof(t=_t(t))=="string"||t instanceof ke?Oc(s,"updateDoc",r._key,t,e,n):Fc(s,"updateDoc",r._key,t),io(i,[a.toMutation(r._key,ut.exists(!0))])}function vv(r){return io(X(r.firestore,ot),[new xe(r._key,ut.none())])}function Iv(r,t){let e=X(r.firestore,ot),n=By(r),i=ro(r.converter,t);return io(e,[eo(mn(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,ut.exists(!1))]).then(()=>n)}function Tv(r,...t){var e,n,i;r=_t(r);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof t[a]!="object"||Ku(t[a])||(s=t[a],a++);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Ku(t[a])){let g=t[a];t[a]=(e=g.next)===null||e===void 0?void 0:e.bind(g),t[a+1]=(n=g.error)===null||n===void 0?void 0:n.bind(g),t[a+2]=(i=g.complete)===null||i===void 0?void 0:i.bind(g)}let c,d,f;if(r instanceof dt)d=X(r.firestore,ot),f=nr(r._key.path),c={next:g=>{t[a]&&t[a](Uc(d,r,g))},error:t[a+1],complete:t[a+2]};else{let g=X(r,Et);d=X(g.firestore,ot),f=g._query;let _=new he(d);c={next:S=>{t[a]&&t[a](new Fe(d,_,g,S))},error:t[a+1],complete:t[a+2]},Qf(r._query)}return function(_,S,k,N){let D=new Xn(N),z=new si(S,D,k);return _.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return Tc(yield Zn(_),z)})),()=>{D.Za(),_.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return Ec(yield Zn(_),z)}))}}(Nt(d),f,u,c)}function Ev(r,t){return Oy(Nt(r=X(r,ot)),Ku(t)?t:{next:t})}function io(r,t){return function(n,i){let s=new wt;return n.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){return gy(yield kc(n),i,s)})),s.promise}(Nt(r),t)}function Uc(r,t,e){let n=e.docs.get(t._key),i=new he(r);return new Ne(r,i,t._key,n,new se(e.hasPendingWrites,e.fromCache),t.converter)}var Ky={maxAttempts:5};var hd=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=mn(t)}set(t,e,n){this._verifyNotCommitted();let i=Te(t,this._firestore),s=ro(i.converter,e,n),a=eo(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(a.toMutation(i._key,ut.none())),this}update(t,e,n,...i){this._verifyNotCommitted();let s=Te(t,this._firestore),a;return a=typeof(e=_t(e))=="string"||e instanceof ke?Oc(this._dataReader,"WriteBatch.update",s._key,e,n,i):Fc(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(a.toMutation(s._key,ut.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=Te(t,this._firestore);return this._mutations=this._mutations.concat(new xe(e._key,ut.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new x(b.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Te(r,t){if((r=_t(r)).firestore!==t)throw new x(b.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var sc=class extends class{constructor(e,n){this._firestore=e,this._transaction=n,this._dataReader=mn(e)}get(e){let n=Te(e,this._firestore),i=new ic(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||s.length!==1)return L();let a=s[0];if(a.isFoundDocument())return new hn(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new hn(this._firestore,i,n._key,null,n.converter);throw L()})}set(e,n,i){let s=Te(e,this._firestore),a=ro(s.converter,n,i),u=eo(this._dataReader,"Transaction.set",s._key,a,s.converter!==null,i);return this._transaction.set(s._key,u),this}update(e,n,i,...s){let a=Te(e,this._firestore),u;return u=typeof(n=_t(n))=="string"||n instanceof ke?Oc(this._dataReader,"Transaction.update",a._key,n,i,s):Fc(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(e){let n=Te(e,this._firestore);return this._transaction.delete(n._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=Te(t,this._firestore),n=new he(this._firestore);return super.get(t).then(i=>new Ne(this._firestore,n,e._key,i._document,new se(!1,!1),e.converter))}};function Sv(r,t,e){r=X(r,ot);let n=Object.assign(Object.assign({},Ky),e);return function(s){if(s.maxAttempts<1)throw new x(b.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){let c=new wt;return s.asyncQueue.enqueueAndForget(()=>V(this,null,function*(){let d=yield xy(s);new Gu(s.asyncQueue,d,u,a,c).au()})),c.promise}(Nt(r),i=>t(new sc(r,i)),n)}function Rv(){return new ui("deleteField")}function Pv(){return new Ju("serverTimestamp")}function bv(...r){return new Yu("arrayUnion",r)}function Vv(...r){return new Xu("arrayRemove",r)}function Cv(r){return new Zu("increment",r)}(function(t,e=!0){(function(i){er=i})(eh),Zl(new Yl("firestore",(n,{instanceIdentifier:i,options:s})=>{let a=n.getProvider("app").getImmediate(),u=new ot(new ca(n.getProvider("auth-internal")),new fa(n.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new x(b.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Un(d.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:e},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),zt(uh,"4.7.3",t),zt(uh,"4.7.3","esm2017")})();export{Pr as a,rh as b,$o as c,Mi as d,Ui as e,Nm as f,Ke as g,Qe as h,br as i,d_ as j,f_ as k,Vr as l,Qo as m,ow as n,aw as o,uw as p,cw as q,lw as r,vw as s,Iw as t,Tw as u,Ew as v,Aw as w,Mw as x,oe as y,Lw as z,x as A,lt as B,vt as C,M as D,qw as E,Un as F,Uy as G,X as H,qy as I,dt as J,jw as K,Gw as L,By as M,$w as N,zy as O,Kw as P,Qw as Q,Nt as R,Ww as S,Hw as T,Jw as U,Yw as V,Xw as W,Zw as X,tv as Y,ev as Z,tr as _,ke as $,oi as aa,nv as ba,rv as ca,iv as da,sv as ea,ov as fa,av as ga,uv as ha,cv as ia,lv as ja,Ws as ka,Ne as la,On as ma,Fe as na,hv as oa,dv as pa,fv as qa,mv as ra,gv as sa,pv as ta,yv as ua,_v as va,wv as wa,vv as xa,Iv as ya,Tv as za,Ev as Aa,io as Ba,hd as Ca,Sv as Da,Rv as Ea,Pv as Fa,bv as Ga,Vv as Ha,Cv as Ia};
